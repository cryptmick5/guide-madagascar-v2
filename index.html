<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description"
        content="Le guide ultime pour voyager à Madagascar - Spots locaux authentiques, carte interactive offline, expressions malgaches">
    <meta name="theme-color" content="#C13535">
    <meta name="color-scheme" content="light dark">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>MG Guide Voyage Madagascar - Le guide que seuls les Malgaches connaissent</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/png" href="images/logo/favicon.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="shortcut icon" href="icons/favicon.ico">

    <!-- Fonts (Non-blocking) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;600;700;800&family=Roboto+Mono:wght@400;500&display=swap"
        rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;600;700;800&family=Roboto+Mono:wght@400;500&display=swap"
            rel="stylesheet">
    </noscript>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="css/styles-premium.css?v=1765726000">
    <link rel="stylesheet" href="css/cards-2026.css?v=2026.GRID.1">


    <style>
        /* ============================================
           VARIABLES CSS & RESET
           ============================================ */
        :root {
            /* Couleurs principales (identité malgache préservée) */
            --laterite: #b03030;
            /* Légèrement plus profond pour le premium */
            --foret: #2d4a2d;
            /* Plus profond/élégant */
            --sable: #D8B48F;
            --creme: #FAF9F6;
            /* Off-white plus pur */
            --noir: #1A1A1A;
            /* Noir moins dur */

            /* Statuts */
            --gratuit: #16A34A;
            --abordable: #F59E0B;
            --premium: #DC2626;

            /* UI Premium */
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --radius: 16px;
            /* Plus moderne */
            --radius-sm: 8px;

            /* Typographie Premium */
            --font-display: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            --font-mono: 'Roboto Mono', monospace;

            /* Mode clair (défaut) */
            --bg-primary: var(--creme);
            --bg-secondary: #FFFFFF;
            --text-primary: var(--noir);
            --text-secondary: #525252;
            /* Gris plus chaud */
            --border-color: #E5E5E5;
        }

        [data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --text-primary: #EDE9E4;
            --text-secondary: #A3A3A3;
            --border-color: #262626;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Apply to HTML/ROOT to ensure scrollbars and native inputs are affected */
        html.dark-mode,
        body.dark-mode {
            color-scheme: dark;
        }

        /* ============================================
           HEADER PREMIUM (NON SCROLLABLE)
           ============================================ */
        .header-premium {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--laterite) 0%, var(--foret) 100%);
            color: white;
            padding: 16px 20px;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            flex-direction: column;
            gap: 12px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            gap: 16px;
        }

        .header-left {
            flex: 1;
        }

        .header-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge-premium {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: var(--noir);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }



        .btn-locate {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            background: white;
            color: var(--laterite);
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease;
        }

        .btn-locate:hover {
            transform: scale(1.05);
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        /* ============================================
           NAVIGATION SCROLLABLE
           ============================================ */
        .nav-container {
            position: sticky;
            top: 80px;
            z-index: 999;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav-container::-webkit-scrollbar {
            display: none;
        }

        .main-nav {
            display: flex;
            gap: 8px;
            padding: 12px 20px;
            min-width: max-content;
        }

        .nav-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 24px;
            padding: 10px 20px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn:hover {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            font-weight: 600;
        }

        /* ============================================
           MAIN CONTENT
           ============================================ */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ============================================
           CARTE INTERACTIVE
           ============================================ */
        #map {
            height: 500px;
            width: 100%;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
        }

        .map-filters {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .filter-group {
            margin-bottom: 16px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-checkbox {
            display: none;
        }

        .filter-label {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .filter-checkbox:checked+.filter-label {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            font-weight: 500;
        }

        .filter-label:hover {
            border-color: var(--laterite);
        }

        /* ============================================
           SHORTCUTS RAPIDES
           ============================================ */
        /* Shortcuts styles defined later in the file for map page specificity */


        .shortcut-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .shortcut-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--laterite);
        }

        .shortcut-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .shortcut-title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .shortcut-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ============================================
           FILTRES PREMIUM (VILLE DÉTAIL)
           ============================================ */
        .filter-scroll-container {
            overflow-x: auto;
            white-space: nowrap;
            padding: 10px 4px;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            /* Firefox */
        }

        .filter-scroll-container::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #F3F4F6;
            /* Gris très clair */
            color: var(--noir);
            border: 1px solid transparent;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 10px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .filter-chip:last-child {
            margin-right: 0;
        }

        .filter-chip svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            transition: transform 0.3s ease;
        }

        .filter-chip:hover {
            background-color: #E5E7EB;
        }

        .filter-chip.active {
            background-color: var(--text-primary);
            color: var(--bg-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
        }

        .filter-chip.active svg {
            transform: scale(1.1);
        }

        /* Animation Fade pour le filtrage */
        .lieu-card.fade-in {
            animation: cardFadeIn 0.4s ease forwards;
        }

        @keyframes cardFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Bannière Agenda (Invisible par défaut) */
        .agenda-banner {
            display: none;
            /* Caché par défaut */
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            align-items: center;
            gap: 12px;
            animation: slideDown 0.4s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .agenda-icon {
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        /* ============================================
           CARDS LIEUX
           ============================================ */
        .lieux-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .lieu-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .lieu-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--laterite);
        }

        .lieu-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--sable);
        }

        .lieu-content {
            padding: 16px;
        }

        .lieu-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .lieu-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .badge-spot {
            background: var(--laterite);
            color: white;
            padding: 6px 24px;
            /* Plus large / En longueur */
            border-radius: 50px;
            /* Pill shape */
            font-size: 0.75rem;
            font-weight: 700;
            white-space: nowrap;
            flex-shrink: 0;
            text-align: center;
            min-width: 110px;
            /* Ensure minimum length */
            letter-spacing: 0.5px;
        }

        .badge-type {
            background: rgba(46, 125, 50, 0.1);
            /* Soft Green bg */
            color: #2E7D32;
            padding: 4px 10px;
            border-radius: 6px;
            /* Pill but slightly squared */
            font-size: 0.75rem;
            font-weight: 700;
            white-space: nowrap;
            letter-spacing: 0.3px;
        }

        /* NEW CARD STYLES */
        .card-image-badge-city {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            /* no-blur */
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .lieu-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 10px;
        }

        .lieu-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            line-height: 1.3;
        }

        .lieu-meta-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .lieu-note {
            font-weight: 700;
            color: #FFD700;
            /* Gold */
            font-size: 0.9rem;
            background: rgba(255, 215, 0, 0.1);
            padding: 2px 6px;
            border-radius: 6px;
            white-space: nowrap;
        }

        .btn-details.full-width {
            width: 100%;
            margin-top: 12px;
            border-radius: 8px;
            padding: 10px;
            font-weight: 600;
            background: var(--laterite);
            /* Red */
        }

        .btn-details.full-width:hover {
            background: #b03030;
        }



        /* PREMIUM SEGMENTED CONTROL */
        .segmented-control-container {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
            padding: 0 16px;
        }

        .segmented-control {
            display: flex;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 320px;
            position: relative;
        }

        .segment-btn {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 40px;
            font-family: var(--font-body);
            /* Inter */
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .segment-btn.active {
            background: var(--laterite);
            color: white;
            box-shadow: 0 2px 8px rgba(176, 48, 48, 0.25);
        }

        .lieu-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .lieu-prix {
            font-family: var(--font-mono);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .lieu-prix.gratuit {
            color: var(--gratuit);
        }

        .lieu-prix.abordable {
            color: var(--abordable);
        }

        .lieu-prix.premium {
            color: var(--premium);
        }

        .lieu-note {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .lieu-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .btn-details {
            width: 100%;
            background: var(--laterite);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 12px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-website {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
            padding: 12px;
            border-radius: var(--radius);
            font-weight: 600;
            text-decoration: none;
            margin-top: 15px;
            transition: transform 0.2s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-website:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-details:hover {
            background: #A12929;
            transform: scale(1.02);
        }

        .btn-details:active {
            transform: scale(0.98);
        }

        /* ============================================
           MODAL DÉTAILS
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            overflow-y: auto;
            animation: fadeIn 0.2s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        .modal-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--laterite);
        }

        .modal-section-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .modal-info-item {
            background: var(--bg-primary);
            padding: 12px;
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--laterite);
        }

        .modal-info-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .modal-info-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ============================================
           LANGUE - ACCORDÉONS
           ============================================ */
        .langue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--border-color);
            border-radius: 24px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--laterite);
            box-shadow: 0 0 0 3px rgba(193, 53, 53, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .accordion-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .accordion-item {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }

        .accordion-item.open {
            border-color: var(--laterite);
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            user-select: none;
            background: var(--bg-secondary);
            transition: background 0.2s ease;
        }

        .accordion-header:hover {
            background: var(--bg-primary);
        }

        .accordion-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .accordion-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .accordion-item.open .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .accordion-item.open .accordion-body {
            max-height: 2000px;
        }

        .accordion-content {
            padding: 0 20px 20px 20px;
        }

        .phrase-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .phrase-item:hover {
            background: var(--bg-secondary);
            transform: translateX(4px);
        }

        .phrase-content {
            flex: 1;
        }

        .phrase-fr {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .phrase-mg {
            color: var(--laterite);
            font-weight: 600;
            margin-bottom: 2px;
        }

        .phrase-phonetic {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-style: italic;
        }

        .phrase-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            background: var(--laterite);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background: #A12929;
            transform: scale(1.1);
        }

        .btn-icon:active {
            transform: scale(0.9);
        }

        .btn-icon.favorite.active {
            background: #FFD700;
            color: var(--noir);
        }

        /* Fix pour l'alignement de l'étoile dans la liste */
        .phrase-actions .btn-favorite {
            position: static;
            background: var(--laterite);
            color: white;
            width: 36px;
            height: 36px;
            box-shadow: none;
        }

        .phrase-actions .btn-favorite.active {
            background: #FFD700;
            color: var(--noir);
        }

        /* ============================================
           OUTILS
           ============================================ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tool-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .tool-title {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .converter-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .converter-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .converter-input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 500;
            background: var(--bg-primary);
            color: var(--text-primary);
            text-align: center;
        }

        .converter-input:focus {
            outline: none;
            border-color: var(--laterite);
        }

        .converter-label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 50px;
        }

        .rate-info {
            text-align: center;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .btn-modify {
            margin-top: 12px;
            background: var(--foret);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 10px 16px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-modify:hover {
            background: #2D4A2D;
        }

        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checklist-item:hover {
            background: var(--bg-secondary);
            transform: translateX(4px);
        }

        .checklist-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .checklist-item.checked .checklist-checkbox {
            background: var(--gratuit);
            border-color: var(--gratuit);
        }

        .checklist-checkbox::after {
            content: '✓';
            color: white;
            font-weight: bold;
            display: none;
        }

        .checklist-item.checked .checklist-checkbox::after {
            display: block;
        }

        .checklist-label {
            flex: 1;
            color: var(--text-primary);
        }

        .checklist-item.checked .checklist-label {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .seasonal-advice {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .advice-item {
            padding: 16px;
            border-radius: var(--radius-sm);
            border-left: 4px solid;
        }

        .advice-item.good {
            background: rgba(22, 163, 74, 0.1);
            border-color: var(--gratuit);
        }

        .advice-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--abordable);
        }

        .advice-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .advice-list {
            color: var(--text-secondary);
            font-size: 0.9rem;
            list-style-position: inside;
        }

        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .contact-group-title {
            font-weight: 600;
            color: var(--laterite);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
        }

        .contact-name {
            color: var(--text-primary);
        }

        .contact-number {
            font-family: var(--font-mono);
            color: var(--laterite);
            font-weight: 500;
        }

        /* ============================================
           MAP STYLES
           ============================================ */
        /* ============================================
           CARTE & FILTRES PREMIUM (Design Expert)
           ============================================ */
        #page-carte {
            /* display set by active class */
            position: relative;
            height: auto;
            /* REMOVED min-height: 100vh - was causing shortcuts to float inside */
            position: relative;
            padding: 0;
            margin: 0 -20px 0 -20px;
            padding-bottom: 0;
            /* Reduced from 80px */
        }

        #map-container {
            /* Fixed height block - increased for better visibility */
            height: 75vh;
            min-height: 450px;
            max-height: 800px;
            width: 100%;
            position: relative;
            z-index: 1;
            overflow: hidden;
            /* CRITIQUE: empêche la carte Leaflet de déborder */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            /* Positive margin to force shortcuts down */
            margin-bottom: 20px;
            border-bottom: 8px solid var(--bg-primary);
            /* Physical separator */
        }

        #map {
            height: 100%;
            width: 100%;
            border-radius: 0;
            z-index: 1;
        }

        /* ============================================
           PREMIUM UI COMPONENTS (Added via Refactor)
           ============================================ */

        /* Accordéons Premium (Glassmorphism) */
        .premium-section-header,
        .logistique-header,
        .premium-accordion-header {
            background: rgba(255, 255, 255, 0.7);
            /* no-blur */

            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .premium-section-header,
        [data-theme="dark"] .logistique-header,
        [data-theme="dark"] .premium-accordion-header {
            background: rgba(45, 45, 45, 0.95);
            /* Plus opaque pour contraste */
            /* no-blur */
            border: 1px solid rgba(255, 255, 255, 0.15);
            /* Bordure plus visible */
            color: var(--text-primary);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .premium-section-header:hover,
        .logistique-header:hover,
        .premium-accordion-header:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .premium-section-header:hover,
        [data-theme="dark"] .logistique-header:hover {
            background: rgba(40, 40, 40, 0.8);
        }

        /* BANNIERE CIRCUITS (Harmonized) */
        .premium-banner-circuits {
            background: linear-gradient(135deg, #0F2027, #203A43, #2C5364);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border-radius: 0 0 24px 24px;
            margin-bottom: 24px;
            padding: 32px 20px 40px;
            color: white;
            text-align: center;
        }

        /* Titres Accordéons */
        .logistique-title,
        .premium-accordion-title,
        .premium-section-header h3,
        .logistique-header h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
        }

        /* DARK MODE TEXT FIX - GLOBAL */
        [data-theme="dark"] .logistique-header h3,
        [data-theme="dark"] .premium-accordion-header h3,
        [data-theme="dark"] .logistique-header i,
        [data-theme="dark"] .premium-accordion-header i {
            color: #FFFFFF !important;
            /* Forces White Title and Icon */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Remove Yellow on Icons - Use Primary Color or White in Dark Mode */
        .logistique-header i,
        .premium-accordion-header i {
            color: var(--laterite);
            /* Primary color instead of Gold */
            margin-right: 10px;
        }

        /* CONTENU ACCORDEON - PREMIUM RENDERING */
        .logistique-content,
        .premium-accordion-content {
            background: white;
            border-radius: 0 0 16px 16px;
            padding: 24px;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.05);
            /* Inset shadow for depth */
            margin-top: -10px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: none;
            color: var(--text-secondary);
            /* Default dark grey text */
        }

        .logistique-content.active,
        .premium-accordion-content.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        /* DARK MODE CONTENT FIX - CRITICAL */
        [data-theme="dark"] .logistique-content,
        [data-theme="dark"] .premium-accordion-content {
            background: #2D2D2D;
            /* Solid dark grey background, no transparency issues */
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #E0E0E0 !important;
            /* Force Light Text */
        }

        [data-theme="dark"] .logistique-content strong,
        [data-theme="dark"] .premium-accordion-content strong {
            color: #FFFFFF;
            /* Highlight bold text */
        }

        [data-theme="dark"] .logistique-label {
            color: var(--lagon);
            /* Light Blue/Green for labels in Dark Mode */
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        /* FIX: Logistique Item styling to replace "Yellow" border */
        .logistique-item {
            padding-left: 12px;
            border-left: 3px solid var(--laterite);
            /* Harmony: Use theme color */
            margin-bottom: 16px;
        }

        /* FIX: Logistique Text visibility in Dark Mode */
        .logistique-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        [data-theme="dark"] .logistique-text {
            color: #E0E0E0 !important;
            /* Force readable text */
        }

        [data-theme="dark"] .logistique-item {
            border-left-color: var(--lagon);
            /* Use Lagon or generic theme color in dark mode? User asked for harmony. Lagon matches the banner? Or Laterite matches the brand? Let's use Laterite for brand consistency or Lagon for the 'Diego' vibe. User said 'yellow ... clashes'. Let's stick to Laterite (Red/Rust) as it is the main brand color, or maybe White/Grey? Laterite is safe. Actually, let's use var(--text-primary) or just keep Laterite. */
            border-left-color: var(--laterite);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Circuits Header (Dark Mode Fix) */
        .itinerary-header {
            background: var(--surface-card);
            /* Utilise la variable thème */
            border-bottom: 1px solid var(--border-color);
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .itinerary-header:hover {
            background: var(--bg-secondary);
        }

        /* ============================================
           NEW: PROVINCE FILTER BAR (Sticky & Native)
           ============================================ */
        .province-filter-container {
            position: sticky;
            top: 68px;
            /* Below Header */
            z-index: 900;
            background: rgba(255, 255, 255, 0.95);
            /* no-blur */
            padding: 12px 20px;
            margin: 0 -20px 20px -20px;
            /* Full width mobile */
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            /* Hide scrollbar Firefox */
        }

        [data-theme="dark"] .province-filter-container {
            background: rgba(18, 18, 18, 0.95);
        }

        .province-filter-container::-webkit-scrollbar {
            display: none;
            /* Hide scrollbar Chrome/Safari */
        }

        .filter-pill {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0 32px;
            /* Wide padding */
            height: 60px;
            /* Distinctly larger than 48px */
            border-radius: 50px;
            font-size: 1.05rem;
            /* Larger text */
            font-weight: 700;
            /* Bolder */
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .filter-pill:hover {
            border-color: var(--laterite);
            color: var(--laterite);
        }

        .filter-pill.active {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            box-shadow: 0 4px 10px rgba(176, 48, 48, 0.3);
        }

        /* ============================================
           NEW: BUDGET BADGES (Integrated in Cards)
           ============================================ */
        .badge-budget {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 8px;
            letter-spacing: 0.5px;
        }

        .budget-low {
            background: rgba(22, 163, 74, 0.1);
            color: #16A34A;
            /* Green / Eco */
            border: 1px solid rgba(22, 163, 74, 0.2);
        }

        .budget-mid {
            background: rgba(176, 48, 48, 0.1);
            color: var(--laterite);
            /* Standard Brand Color */
            border: 1px solid rgba(176, 48, 48, 0.2);
        }

        .budget-high {
            background: rgba(212, 175, 55, 0.1);
            color: #D4AF37;
            /* Gold / Premium */
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        /* Dark mode adj for badges */
        [data-theme="dark"] .budget-low {
            background: rgba(22, 163, 74, 0.2);
        }

        [data-theme="dark"] .budget-mid {
            background: rgba(176, 48, 48, 0.2);
        }

        [data-theme="dark"] .budget-high {
            background: rgba(212, 175, 55, 0.2);
        }

        /* Integrated placement in card header row */
        .lieu-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        /* Segment Control (Switcher Diego/Nosy Be) - Refined */
        .segmented-control-container {
            margin-bottom: 16px;
            /* Reduced spacing */
        }

        .segmented-control {
            background: var(--bg-secondary);
            border-radius: 50px;
            padding: 6px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            max-width: 340px;
            /* Larger but harmonious */
            margin: 0 auto;
        }

        .segmented-control-container {
            display: flex;
            justify-content: center;
            /* Center the badges */
            margin: 0 0 24px 0;
            /* Remove top margin, keep bottom */
            width: 100%;
        }

        .segmented-control {
            display: inline-flex;
            gap: 12px;
            /* Space between buttons */
            align-items: center;
        }

        .segment-btn {
            padding: 12px 28px;
            /* Larger comfortable click area */
            font-size: 1.0rem;
            /* Readable text */
            border-radius: 40px;
            font-weight: 600;
            white-space: nowrap;
            /* FORCE HORIZONTAL */
            text-transform: uppercase;
            /* Match Premium Look */
            letter-spacing: 0.5px;
        }

        /* BANNIERES PREMIUM */
        .premium-banner-tout {
            background: linear-gradient(135deg, var(--laterite), #A12929);
            box-shadow: 0 4px 15px rgba(161, 41, 41, 0.3);
            border-radius: 0 0 24px 24px;
            margin-bottom: 24px;
            padding: 32px 20px 40px;
            color: white;
            text-align: center;
        }

        .premium-banner-explorer {
            background: linear-gradient(135deg, var(--lagon), #047857);
            box-shadow: 0 4px 15px rgba(4, 120, 87, 0.3);
            border-radius: 0 0 24px 24px;
            margin-bottom: 24px;
            padding: 32px 20px 20px;
            color: white;
            text-align: center;
        }

        .premium-banner-diego {
            background: linear-gradient(135deg, #00C9FF, #92FE9D);
            /* Lagon / Turquoise vibe */
            box-shadow: 0 4px 15px rgba(0, 201, 255, 0.3);
            border-radius: 0 0 24px 24px;
            margin-bottom: 24px;
            padding: 32px 20px 40px;
            color: white;
            text-align: center;
        }

        .premium-banner-diego .city-title {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            color: white;
            /* Ensure text is white */
        }

        .premium-banner-diego .city-desc {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
        }

        .premium-banner-tout .city-title,
        .premium-banner-explorer .city-title {
            color: white;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .premium-banner-tout .city-desc,
        .premium-banner-explorer .city-desc {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        /* EXPLORER FILTERS */
        .explorer-filters-container {
            padding: 0 16px;
            margin-top: -10px;
            position: relative;
            z-index: 10;
        }

        .explorer-filters-container .nav-pills {
            justify-content: center;
        }

        /* FILTRES FLOTTANTS ÉPURÉS */
        .map-filters-overlay {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px;
            z-index: 900;
            display: flex;
            justify-content: center;
            pointer-events: none;
        }

        .filter-row {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px 8px;
            pointer-events: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            background: rgba(255, 255, 255, 0.9);
            /* no-blur */
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            max-width: 100%;
        }

        .filter-chip-map {
            background: transparent;
            border: 1px solid transparent;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-chip-map:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .filter-chip-map.active {
            background: var(--laterite);
            color: white;
            box-shadow: 0 2px 8px rgba(217, 79, 4, 0.3);
        }

        /* BOUTON LOCALISATION */
        /* FORCE VISIBILITY FOR PROVINCE HEADERS */
        #page-antsiranana .city-header,
        #page-mahajanga .city-header,
        #page-toamasina .city-header,
        #page-toliara .city-header,
        #page-fianarantsoa .city-header,
        #page-antananarivo .city-header,
        .city-header {
            position: relative;
            height: 300px;
            min-height: 300px !important;
            /* Force visible */
            background-color: #2c3e50 !important;
            /* Force fallback */
            display: flex !important;
            /* Force layout */
            visibility: visible !important;
            /* Force render */
            align-items: flex-end;
            padding: 30px;
            color: white;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: -40px;
            z-index: 10;
        }

        .btn-locate {
            position: absolute;
            bottom: 24px;
            right: 24px;
            z-index: 900;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: white;
            color: var(--laterite);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .btn-locate span {
            display: none;
        }

        /* ============================================
           MODALE FICHE LIEU (FIX STYLES)
           ============================================ */
        #lieuModal .modal-content {
            padding: 0;
            /* Cover image goes to edge */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 85vh;
        }

        .modal-header-image {
            width: 100%;
            height: 250px;
            position: relative;
            background: #eee;
        }

        .modal-header-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-badge-type {
            position: absolute;
            bottom: 16px;
            left: 16px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            /* no-blur */
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 12px;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .modal-meta-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .meta-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: var(--bg-primary);
            padding: 6px 12px;
            border-radius: 8px;
        }

        .meta-tag::before {
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }

        .meta-tag.price::before {
            content: "\f53a";
            color: var(--laterite);
        }

        /* Money Bill */
        .meta-tag.duration::before {
            content: "\f017";
            color: var(--laterite);
        }

        /* Clock */
        .meta-tag.access::before {
            content: "\f3c5";
            color: var(--laterite);
        }

        /* Map Marker */
        .custom-marker {
            font-size: 3rem;
            /* 48px - Plus grand comme demandé */
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            /* Pop effect */
        }

        .custom-marker:hover {
            transform: scale(1.2) translateY(-4px);
            z-index: 1000 !important;
        }

        .modal-description {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .modal-advice-box {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid #FFD700;
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 24px;
        }

        .advice-title {
            font-weight: 700;
            color: #b59802;
            margin-bottom: 8px;
        }

        .btn-action-primary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px;
            background: var(--laterite);
            color: white;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: transform 0.2s;
        }

        .btn-action-primary:hover {
            transform: translateY(-2px);
            background: #c04000;
        }


        /* SHORTCUTS RAPIDES (High Visibility) */
        /* SHORTCUTS RAPIDES (High Visibility) */
        .shortcuts-grid {
            /* Clear separation */
            margin-top: 20px;
            position: relative;
            z-index: 10;
            clear: both;
            /* Ensure no floating issues */
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            padding: 20px;
            background: var(--bg-primary);
        }

        .shortcut-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 16px;
            /* Plus compact */
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            /* Plus subtil */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            height: 100%;
        }

        .shortcut-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--laterite);
        }

        .shortcut-icon {
            font-size: 2rem;
            /* Plus compact */
            margin-bottom: 8px;
            display: block;
        }

        .shortcut-title {
            font-size: 1.1rem;
            /* Plus compact */
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .shortcut-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            .shortcuts-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .shortcut-card {
                padding: 20px;
            }
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 768px) {
            .header-title {
                font-size: 1.2rem;
            }

            .header-tagline {
                font-size: 0.8rem;
            }

            .theme-toggle {
                width: 44px;
                height: 44px;
            }

            .nav-container {
                top: 72px;
            }

            .main-nav {
                padding: 10px 16px;
                gap: 6px;
            }

            .nav-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }

            .main-content {
                padding: 16px;
            }

            #map {
                height: 400px;
            }

            .shortcuts-grid {
                grid-template-columns: 1fr;
            }

            .lieux-grid {
                grid-template-columns: 1fr;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 10px;
            }

            .modal-title {
                font-size: 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            #map {
                height: 600px;
            }
        }

        /* ============================================
           UTILITAIRES
           ============================================ */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        /* Leaflet popup customization */
        /* Leaflet popup customization - Premium */
        .leaflet-popup-content-wrapper {
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            padding: 0;
            overflow: hidden;
            border: 2px solid var(--laterite);
            background: var(--bg-primary);
        }

        .leaflet-popup-content {
            margin: 0;
            width: 280px !important;
        }

        .popup-image-container {
            height: 140px;
            width: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .btn-favorite-popup-overlay {
            position: absolute;
            top: 10px;
            right: 10px;

            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;

            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);

            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            color: #4b5563;
            font-size: 1.1rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-favorite-popup-overlay:hover {
            transform: scale(1.1);
            background: #ffffff;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .btn-favorite-popup-overlay:active {
            transform: scale(0.95);
        }

        .btn-favorite-popup-overlay.active {
            color: var(--premium);
        }

        .popup-body {
            padding: 12px 16px 16px 16px;
        }

        .popup-title {
            font-family: var(--font-display);
            font-weight: 700;
            font-size: 1.15rem;
            color: var(--text-primary);
            line-height: 1.3;
            margin: 0 0 4px 0;
        }

        .popup-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .popup-type-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            /* no-blur */
        }

        .popup-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .popup-price {
            font-family: var(--font-mono);
            font-weight: 700;
            color: var(--laterite);
            font-size: 1rem;
            background: rgba(217, 79, 4, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .popup-rating {
            font-size: 0.9rem;
            color: #F59E0B;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-popup-details {
            display: block;
            width: 100%;
            padding: 12px;
            background: var(--laterite);
            color: white;
            text-align: center;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            margin-top: 12px;
            box-shadow: 0 4px 6px rgba(217, 79, 4, 0.2);
        }

        .btn-popup-details:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(217, 79, 4, 0.3);
            background: #c2410b;
        }

        .btn-favorite-popup {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #ccc;
            transition: all 0.2s;
            flex-shrink: 0;
            box-shadow: var(--shadow);
        }

        .btn-favorite-popup.active {
            color: var(--premium);
            border-color: var(--premium);
            background: #fff9e6;
        }

        .btn-favorite-popup:hover {
            transform: scale(1.1);
        }

        /* Installation prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--laterite);
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }

        .install-prompt.active {
            display: flex;
        }

        .install-btn {
            background: white;
            color: var(--laterite);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .install-btn:hover {
            transform: scale(1.05);
        }

        .install-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            margin-left: 8px;
        }

        /* FAVORITES STYLES */
        /* FAVORITES STYLES */
        .btn-favorite {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 10;

            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;

            background: rgba(255, 255, 255, 0.95);
            /* Quasi opaque pour contraste max */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
            /* Ombre marquée pour détacher du fond */

            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

            color: #4b5563;
            /* Gris foncé neutre par défaut */
            font-size: 1.1rem;
        }

        .btn-favorite:hover {
            transform: scale(1.1);
            background: #ffffff;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .btn-favorite:active {
            transform: scale(0.95);
        }

        .btn-favorite.active {
            color: var(--premium);
        }

        /* --- Outil Taxi-Brousse Premium --- */
        .taxi-calculator {
            margin-bottom: 24px;
            background: var(--surface);
            padding: 20px;
            border-radius: 16px;
            /* Ne pas doubler le background si tool-card l'a déjà, mais ajuster le padding interne */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        .taxi-form {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 20px;
        }

        /* Specific Fix for Map Container Pattern */
        #map {
            height: calc(100vh - 120px) !important;
            width: 100%;
            min-height: 400px;
            z-index: 1;
        }

        /* Absolute Positioning for Filters to ensure Overlap */
        .province-filter-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 20;
            transform: translateY(50%);
            /* Half overlap downwards */
            margin-top: 0 !important;
            display: flex;
            justify-content: center;
            /* Center the scrollable area if possible, or left */
            padding-bottom: 20px;
            /* Touch target area */
            background: transparent;
            pointer-events: none;
            /* Let clicks pass through container but catch on buttons */
        }

        .province-filter-container button,
        .province-filter-container .nav-pill {
            pointer-events: auto;
            /* Re-enable clicks */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            /* Stronger shadow for floating effect */
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 0.02em;
        }

        .form-group-icon {
            font-size: 1.2rem;
            color: var(--laterite);
            background: rgba(176, 48, 48, 0.1);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-top: 24px;
            /* Align with inputs */
        }

        .taxi-select {
            width: 100%;
            padding: 12px 34px 12px 12px;
            /* Less vertical, more right padding for icon */
            border-radius: 12px;
            border: 1px solid var(--border);
            background-color: var(--background);
            /* Explicit color for inheritance */
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            /* Slightly smaller to fit Antananarivo */
            font-weight: 500;
            appearance: none;
            -webkit-appearance: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            transition: all 0.2s ease;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23b03030' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

        /* Force dark option background in Dark Mode */
        body.dark-mode .taxi-select {
            color-scheme: dark;
            background-color: #000000 !important;
            color: #ffffff !important;
            border-color: #555;
        }

        body.dark-mode .taxi-select option {
            background-color: #000000 !important;
            color: #ffffff !important;
            text-shadow: none;
        }

        .taxi-select:focus {
            border-color: var(--laterite);
            outline: none;
            box-shadow: 0 0 0 3px rgba(176, 48, 48, 0.15);
        }

        .btn-action-primary {
            background: linear-gradient(135deg, var(--laterite) 0%, #d64d4d 100%);
            color: white;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            letter-spacing: 0.5px;
            border: none;
            box-shadow: 0 4px 12px rgba(176, 48, 48, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-action-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(176, 48, 48, 0.4);
        }

        .taxi-result {
            background: linear-gradient(135deg, rgba(176, 48, 48, 0.08), rgba(255, 255, 255, 0.02));
            /* no-blur */
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(176, 48, 48, 0.15);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .taxi-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--laterite);
            opacity: 0.8;
        }

        .price-tiers-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 15px 0;
        }

        .tier-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .tier-row {
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .tier-name {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .tier-price {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            color: var(--laterite);
            font-size: 1.1rem;
        }

        .result-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 12px;
        }

        .result-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .result-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .result-value {
            font-family: 'Outfit', sans-serif;
            /* Plus stylisé pour les chiffres */
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--laterite);
            line-height: 1.2;
        }

        .result-note {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
            opacity: 0.8;
        }

        .companies-section {
            margin-top: 24px;
            animation: fadeIn 0.4s ease-out;
        }

        .companies-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 16px;
        }

        .company-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .company-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.06);
            border-color: var(--laterite);
        }

        .company-info strong {
            display: block;
            color: var(--text-primary);
            font-size: 1.05rem;
            margin-bottom: 6px;
            font-family: 'Outfit', sans-serif;
        }

        .company-badge.premium {
            background: linear-gradient(90deg, var(--laterite), #d64d4d);
            color: white;
            border: none;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(176, 48, 48, 0.25);
        }

        .company-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon-small {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background);
            border: 1px solid var(--border);
            transition: all 0.2s;
            font-size: 1.1rem;
            text-decoration: none;
        }

        .btn-icon-small:hover {
            background: var(--laterite);
            color: white;
            border-color: var(--laterite);
            transform: scale(1.1);
        }

        /* --- Styles pour Cartes Raccourcis --- */
        /* Optionnel: fond légèrement teinté */
        /* background: #fff5f5; */


        .btn-favorite.active i {
            /* Anime l'icône si besoin */
            mix-blend-mode: normal;
        }

        /* CONVERTER STYLES */
        .converter-select {
            flex: 1;
            padding: 8px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: var(--font-body);
        }

        .btn-icon-small {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.manual {
            background: #F59E0B;
            color: white;
        }

        .status-badge.live {
            background: #10B981;
            color: white;
        }

        .btn-text-action {
            background: none;
            border: none;
            color: var(--laterite);
            font-size: 0.8rem;
            text-decoration: underline;
            cursor: pointer;
            margin-left: 10px;
        }

        /* ============================================
           FILTRES INTELLIGENTS (PREMIUM UI)
           ============================================ */
        .nav-pills {
            display: flex;
            gap: 12px;
            padding: 4px 4px 12px 4px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            margin-bottom: 24px;
            align-items: center;
        }

        .nav-pills::-webkit-scrollbar {
            display: none;
        }

        .nav-pill {
            background: var(--bg-secondary);
            border: 1px solid rgba(0, 0, 0, 0.08);
            /* Plus subtil */
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 50px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            /* Ombre douce initiale */
            display: flex;
            align-items: center;
            gap: 8px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            color: var(--text-primary);
            background: white;
            border-color: rgba(0, 0, 0, 0.05);
        }

        .nav-pill:active {
            transform: scale(0.96);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .nav-pill.active {
            background: linear-gradient(135deg, var(--laterite) 0%, #A12929 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 6px 15px rgba(217, 79, 4, 0.4);
            /* Glow rouge */
        }

        /* ICON STYLES */
        .nav-pill i,
        .nav-btn i,
        .filter-chip-map i {
            font-size: 1.1em;
            /* Légèrement plus grand */
            margin-right: 2px;
        }

        .nav-btn i {
            margin-bottom: 2px;
            /* Alignement optique */
        }

        /* PREMIUM BANNERS */
        .premium-banner-tout,
        .premium-banner-explorer,
        .premium-banner-circuits {
            padding: 24px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--laterite) 0%, #8a2424 100%);
            /* Worked Premium Red */
            color: white;
            transition: all 0.3s ease;
        }

        /* Banner Text */
        .city-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .city-desc {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* Dark Mode Override for Banners - Black with Red Accent */
        [data-theme="dark"] .premium-banner-tout,
        [data-theme="dark"] .premium-banner-explorer,
        [data-theme="dark"] .premium-banner-circuits {
            background: #1A1A1A;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-left: 4px solid var(--laterite);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        /* Accordion Style Adjustment (Inline Override if needed) */
        /* See styles-premium.css for main styles */
        /* Badge Ville sur Image (Updated Request) */
        .card-image-badge-city {
            background: rgba(0, 0, 0, 0.65);
            /* More transparent/discreet */
            color: white;
            padding: 4px 10px;
            /* Ultra Compact */
            border-radius: 50px;
            font-size: 0.75rem;
            /* ~12px */
            font-weight: 600;
            /* no-blur */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            white-space: nowrap;
            letter-spacing: 0.3px;
        }
    </style>
    <link rel="stylesheet" href="css/styles-premium.css?v=1765726000">
</head>

<body>
    <!-- CRITICAL DIAGNOSTIC LAYER -->
    <div id="diagnostic-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:99999; color:white; padding:20px; font-family:monospace; white-space:pre-wrap; overflow:auto;">
        <h2 style="color:red; border-bottom:1px solid red;">CRITICAL STARTUP ERROR</h2>
        <div id="error-log"></div>
        <button onclick="window.location.reload()"
            style="padding:10px; margin-top:20px; background:white; color:black; border:none;">RELOAD</button>
        <button
            onclick="navigator.serviceWorker.getRegistrations().then(gam => gam.forEach(r => r.unregister())); localStorage.clear(); setTimeout(() => window.location.reload(true), 100);"
            style="padding:10px; margin-top:20px; background:red; color:white; border:none; border-radius: 8px; font-weight: bold; cursor: pointer; display: block; width: 100%;">
            🚨 RESET RESET (CLIQUEZ ICI) 🚨
        </button>
    </div>
    <script>
        window.onerror = function (msg, url, line, col, error) {
            document.getElementById('diagnostic-overlay').style.display = 'block';
            document.getElementById('error-log').innerText += `\n[CRASH] ${msg}\nAt: ${url}:${line}:${col}\nStack: ${error ? error.stack : 'N/A'}\n`;
            console.error("Critical Error Trap:", msg, error);
            return false; // Let default handler run too
        };
        window.addEventListener('unhandledrejection', function (event) {
            document.getElementById('diagnostic-overlay').style.display = 'block';
            document.getElementById('error-log').innerText += `\n[PROMISE] Reason: ${event.reason}\n`;
        });
    </script>
    <header class="header-premium">
        <div class="header-content">
            <div class="header-top">
                <div>
                    <h1 class="header-title">
                        🌍 Gasikara Explorer
                        <span class="badge-premium">PREMIUM</span>
                    </h1>
                    <p class="header-tagline">Le guide connecté des terres rouges</p>
                </div>
                <button id="themeToggle" class="theme-toggle">☀️</button>
            </div>


        </div>
    </header>
    <nav class="nav-container">
        <div class="main-nav">
            <button class="nav-btn active" data-page="accueil"><i class="fa-solid fa-house"></i> Accueil</button>
            <button class="nav-btn" data-page="itineraires"><i class="fa-solid fa-route"></i> Circuits</button>
            <button class="nav-btn" data-page="carte"><i class="fa-solid fa-map"></i> Carte</button>
            <button class="nav-btn" onclick="navigateToPage('spots')" data-page="spots"><i class="fa-solid fa-fire"></i>
                Spots</button>
            <div style="width: 1px; background: rgba(0,0,0,0.1); margin: 0 4px;"></div>
            <button class="nav-btn" onclick="navigateToPage('outils')" data-page="outils"><i
                    class="fa-solid fa-toolbox"></i> Outils</button>
            <button class="nav-btn" onclick="navigateToPage('langue')" data-page="langue"><i
                    class="fa-solid fa-comments"></i> Langue</button>
        </div>
    </nav>

    <!-- Main Content -->
    <!-- Main Content -->
    <main class="main-content">
        <!-- ACCUEIL (Tout) -->
        <section id="page-accueil" class="page-section active">

            <!-- Banner -->
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(135deg, #1a1a1a 0%, #2c3e50 100%); border-left: 4px solid var(--laterite); overflow: visible !important;">
                <div class="banner-content" style="width: 100%;">
                    <h2 class="city-title">Escale en Terres Rouges</h2>
                    <p class="city-desc">Votre guide expert pour explorer les terres rouges.</p>

                    <!-- Global Search Bar Premium 2026 -->
                    <div class="search-container-2026">
                        <div class="search-wrapper-2026">
                            <i class="fas fa-search search-icon-left"></i>
                            <input type="text" id="globalSearchInput" class="search-input-2026"
                                placeholder="Rechercher une destination, un hôtel..." autocomplete="off">
                            <button class="search-btn-2026">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>

                        <!-- Search Results Dropdown -->
                        <div id="searchResults" class="search-results-2026">
                            <!-- Results injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div style="display: grid; gap: 20px; padding-bottom: 80px;">

                <!-- 0. Seasonal Widget (Expert Feature) -->
                <div id="seasonal-widget"
                    style="background: linear-gradient(135deg, #2c3e50, #4ca1af); border-radius: 16px; padding: 20px; color: white; border-left: 4px solid #f1c40f; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span
                            style="font-size:0.75rem; text-transform:uppercase; font-weight:700; background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:4px; letter-spacing:0.5px;">📅
                            L'Instant Voyage</span>
                        <i class="fas fa-star" style="color: #f1c40f;"></i>
                    </div>
                    <h3 id="seasonal-title"
                        style="font-family: var(--font-display); font-size: 1.3rem; margin-bottom: 5px;">En ce moment...
                    </h3>
                    <p id="seasonal-desc" style="opacity: 0.95; font-size: 0.95rem; margin-bottom: 0; line-height:1.4;">
                        Un conseil d'expert pour votre voyage.</p>
                </div>

                <!-- 0.5 Map Discovery Card (Re-added per user request) -->
                <div onclick="navigateToPage('carte')"
                    style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('images/spots/parc-isalo.jpg'); background-size: cover; background-position: center; border-radius: 16px; padding: 24px; color: white; cursor: pointer; display:flex; align-items:center; justify-content:space-between; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <div
                            style="font-size:0.8rem; font-weight:700; text-transform:uppercase; color:#f1c40f; margin-bottom:4px;">
                            Exploration</div>
                        <h3 style="font-family: var(--font-display); font-size: 1.4rem; margin:0;">Carte Interactive 🗺️
                        </h3>
                    </div>
                    <div
                        style="background:white; color:var(--text-primary); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>

                <!-- 1. Hero Grid: Les 6 Provinces -->
                <div id="home-destinations">
                    <h3
                        style="font-size: 1.2rem; margin-bottom: 16px; color: var(--text-primary); font-weight: 800; margin-left:8px; display:flex; align-items:center; gap:8px;">
                        <i class="fa-solid fa-map-location-dot" style="color:var(--laterite);"></i> Nos Destinations
                    </h3>

                    <div class="lieux-grid-hero">
                        <!-- Diego (Antsiranana) -->
                        <div onclick="navigateToPage('antsiranana')" class="province-card-2026">
                            <img src="images/pain_de_sucre_premium.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>

                            <!-- Optional Badge Count for 'Wow' effect (REMOVED) -->

                            <div class="province-content-2026">
                                <span class="province-label-2026">Nord</span>
                                <h3 class="province-title-2026">Diego Suarez</h3>
                            </div>
                        </div>

                        <!-- Nosy Be -->
                        <div onclick="navigateToPage('nosybe')" class="province-card-2026">
                            <img src="images/iles/nosy-komba.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Archipel</span>
                                <h3 class="province-title-2026">Nosy Be</h3>
                            </div>
                        </div>

                        <!-- Antananarivo -->
                        <div onclick="navigateToPage('antananarivo')" class="province-card-2026">
                            <img src="images/villes/palais-reine.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Hautes Terres</span>
                                <h3 class="province-title-2026">Antananarivo</h3>
                            </div>
                        </div>

                        <!-- Mahajanga -->
                        <div onclick="navigateToPage('mahajanga')" class="province-card-2026">
                            <img src="images/spots/cirque-rouge.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Ouest</span>
                                <h3 class="province-title-2026">Mahajanga</h3>
                            </div>
                        </div>

                        <!-- Toamasina -->
                        <div onclick="navigateToPage('toamasina')" class="province-card-2026">
                            <img src="images/spots/andasibe-mantadia.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Est</span>
                                <h3 class="province-title-2026">Toamasina</h3>
                            </div>
                        </div>

                        <!-- Fianarantsoa -->
                        <div onclick="navigateToPage('fianarantsoa')" class="province-card-2026">
                            <img src="images/fianarantsoa/fianar_gare_fce.png" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Hautes Terres</span>
                                <h3 class="province-title-2026">Fianarantsoa</h3>
                            </div>
                        </div>

                        <!-- Toliara -->
                        <div onclick="navigateToPage('toliara')" class="province-card-2026">
                            <img src="images/spots/parc-isalo.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Sud</span>
                                <h3 class="province-title-2026">Toliara</h3>
                            </div>
                        </div>

                        <!-- Sainte Marie (New) -->
                        <div onclick="navigateToPage('saintemarie')" class="province-card-2026">
                            <img src="images/iles/ile-aux-nattes.jpg" class="province-image-2026"
                                onerror="this.src='images/placeholders/default.jpg'" loading="lazy" decoding="async"
                                width="400" height="300">
                            <div class="province-overlay-2026"></div>
                            <div class="province-content-2026">
                                <span class="province-label-2026">Est</span>
                                <h3 class="province-title-2026">Sainte Marie</h3>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Tools Teaser - UX System 1: Monochrome Latérite Premium (Compact) -->
                    <div class="tools-grid-2026">
                        <!-- Outils Terrain -->
                        <div onclick="navigateToPage('outils')"
                            style="background: #2a2a2a; padding: 16px; border-radius: 16px; display: flex; flex-direction: column; gap: 12px; cursor: pointer; border: 1px solid #3a3a3a; box-shadow: var(--shadow); transition: transform 0.2s ease, box-shadow 0.2s ease;"
                            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.3)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow)'">
                            <div
                                style="background: rgba(176, 48, 48, 0.15); width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 12px; color: #b03030;">
                                <i class="fas fa-compass" style="font-size: 1.2rem;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px; color: #b03030;">
                                    Outils Terrain</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Convertisseur devises,
                                    checklist voyage, numéros utiles</div>
                            </div>
                        </div>

                        <!-- Spots Locaux - Gradient Hero -->
                        <div onclick="navigateToPage('spots')"
                            style="background: linear-gradient(135deg, #e63946 0%, #b03030 100%); padding: 16px; border-radius: 16px; display: flex; flex-direction: column; gap: 12px; cursor: pointer; box-shadow: 0 8px 24px rgba(230, 57, 70, 0.3); transition: transform 0.2s ease, box-shadow 0.2s ease;"
                            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 32px rgba(230, 57, 70, 0.4)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 24px rgba(230, 57, 70, 0.3)'">
                            <div
                                style="background: rgba(255, 255, 255, 0.2); width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 12px; color: #fff;">
                                <i class="fas fa-fire-flame-curved" style="font-size: 1.2rem;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px; color: #fff;">Spots
                                    Locaux</div>
                                <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.9);">9 lieux secrets
                                    accessibles uniquement via contact local</div>
                            </div>
                        </div>

                        <!-- Expressions Malgaches -->
                        <div onclick="navigateToPage('langue')"
                            style="background: #2a2a2a; padding: 16px; border-radius: 16px; display: flex; flex-direction: column; gap: 12px; cursor: pointer; border: 1px solid #3a3a3a; box-shadow: var(--shadow); transition: transform 0.2s ease, box-shadow 0.2s ease;"
                            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.3)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow)'">
                            <div
                                style="background: rgba(230, 57, 70, 0.15); width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 12px; color: #e63946;">
                                <i class="fas fa-language" style="font-size: 1.2rem;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px; color: #e63946;">50+
                                    Expressions</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Phrases essentielles en
                                    malgache avec prononciation audio</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                // Expert Seasonal Logic
                (function () {
                    const month = new Date().getMonth();
                    const tips = [
                        { m: "Janvier", t: "Saison des Pluies", d: "Les orchidées fleurissent. Privilégiez les hauts plateaux." },
                        { m: "Février", t: "Cyclones & Chaleur", d: "Météo capricieuse. Nosy Be reste une valeur sûre entre deux averses." },
                        { m: "Mars", t: "Fin des Pluies", d: "La nature est luxuriante et verte. Le Nord redevient accessible." },
                        { m: "Avril", t: "Le Renouveau", d: "Saison idéale pour le trekking. Ni trop chaud, ni trop sec." },
                        { m: "Mai", t: "Début de la Fraîcheur", d: "Parfait pour Nosy Be et les Tsingy qui ouvrent leurs pistes." },
                        { m: "Juin", t: "L'Hiver Austral", d: "Les nuits sont fraîches à Tana. Cap sur les plages du Nord !" },
                        { m: "Juillet", t: "Les Baleines sont là !", d: "Cap sur Sainte-Marie pour le spectacle des baleines à bosse." },
                        { m: "Août", t: "Haute Saison", d: "Tout est accessible. Idéal pour la descente de la Nationale 7." },
                        { m: "Septembre", t: "Douceur Tropicale", d: "Les oiseaux sont actifs. Le Nord est splendide et sec." },
                        { m: "Octobre", t: "Les Jacarandas", d: "Tana se pare de mauve. Le Sud chauffe fort." },
                        { m: "Novembre", t: "Avant la Pluie", d: "Il fait chaud ! Plongez dans les eaux de Nosy Be." },
                        { m: "Décembre", t: "Letchis & Fêtes", d: "C'est la saison des letchis sur la côte Est ! Ambiance festive assurée." }
                    ];
                    const t = tips[month];
                    if (t) {
                        try {
                            document.getElementById('seasonal-title').textContent = "En " + t.m + " : " + t.t;
                            document.getElementById('seasonal-desc').textContent = t.d;
                        } catch (e) { }
                    }
                })();
            </script>

            <!-- Hidden Containers for JS compat -->
            <div id="all-lieux-container" style="display:none;"></div>
            <div id="explorer-container" style="display:none;"></div>

        </section>

        <!-- EXPLORER REMOVED (Merged into Dashboard) -->


        <!-- ITINERAIRES -->
        <section id="page-itineraires" class="page-section">
            <div id="itineraires-list" class="circuits-grid">
                <div class="city-header premium-banner-tout" style="grid-column: 1 / -1; margin-bottom: 30px;">
                    <div class="banner-content">
                        <h2 class="city-title">🗺️ Circuits Sur Mesure</h2>
                        <p class="city-desc">Des itinéraires clés en main, testés et approuvés pour tous les budgets.
                            Laissez-vous guider étape par étape.</p>
                    </div>
                </div>
                <!-- Injected via JS -->
            </div>
            <div id="itineraire-detail" style="display:none;">
                <button onclick="backToItineraries()" class="btn-back-circuits">
                    <i class="fas fa-arrow-left"></i> Retour aux circuits
                </button>
                <div id="itineraire-content"></div>
            </div>
        </section>

        <!-- Page Carte -->
        <section id="page-carte" class="page-section">

            <!-- Context Back Button (Hidden by default) -->
            <div id="btn-back-context-container"
                style="position:absolute; top:80px; left:20px; z-index:1000; display:none;">
                <button onclick="window.navigateBack()" class="btn-back-map">
                    <i class="fas fa-arrow-left"></i> <span id="btn-back-context-label">Retour</span>
                </button>
            </div>

            <!-- Filtres -->
            <!-- Map Container with Overlay Filters -->
            <!-- Map Container with Overlay Filters -->
            <div id="map-container">
                <div id="map"></div>

                <!-- Filters Overlay (Smart Bar Harmonized) -->
                <div class="map-filters-overlay">
                    <div class="filter-row">
                        <!-- Villes (Navigation Rapide) -->
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'antananarivo')">
                            <input type="checkbox" id="filter-antananarivo" class="filter-checkbox" checked>
                            <i class="fa-solid fa-landmark"></i> Tana
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'antsiranana')">
                            <input type="checkbox" id="filter-antsiranana" class="filter-checkbox" checked>
                            <i class="fa-solid fa-anchor"></i> Diego
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'nosybe')">
                            <input type="checkbox" id="filter-nosybe" class="filter-checkbox" checked>
                            <i class="fa-solid fa-water"></i> Nosy Be
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'mahajanga')">
                            <input type="checkbox" id="filter-mahajanga" class="filter-checkbox" checked>
                            <i class="fa-solid fa-umbrella-beach"></i> Majunga
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'toamasina')">
                            <input type="checkbox" id="filter-toamasina" class="filter-checkbox" checked>
                            <i class="fa-solid fa-ship"></i> Tamatave
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'fianarantsoa')">
                            <input type="checkbox" id="filter-fianarantsoa" class="filter-checkbox" checked>
                            <i class="fa-solid fa-train"></i> Fianar
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'toliara')">
                            <input type="checkbox" id="filter-toliara" class="filter-checkbox" checked>
                            <i class="fa-solid fa-sun"></i> Tuléar
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'saintemarie')">
                            <input type="checkbox" id="filter-saintemarie" class="filter-checkbox" checked>
                            <i class="fa-solid fa-fish"></i> Ste Marie
                        </div>

                        <div
                            style="width:1px; background:rgba(0,0,0,0.1); margin:0 4px; height:20px; align-self:center;">
                        </div>

                        <!-- Catégories Standardisées -->
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'explorer')">
                            <input type="checkbox" id="filter-explorer" class="filter-checkbox" checked>
                            <i class="fa-solid fa-binoculars"></i> Explorer
                        </div>
                        <div
                            style="width:1px; background:rgba(0,0,0,0.1); margin:0 4px; height:20px; align-self:center;">
                        </div>

                        <!-- Budget - New Filters -->
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'budget1')">
                            <input type="checkbox" id="filter-budget1" class="filter-checkbox" checked>
                            <span style="font-weight:700;">€</span>
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'budget2')">
                            <input type="checkbox" id="filter-budget2" class="filter-checkbox" checked>
                            <span style="font-weight:700;">€€</span>
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'budget3')">
                            <input type="checkbox" id="filter-budget3" class="filter-checkbox" checked>
                            <span style="font-weight:700;">€€€</span>
                        </div>

                        <div
                            style="width:1px; background:rgba(0,0,0,0.1); margin:0 4px; height:20px; align-self:center;">
                        </div>

                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'manger')">
                            <input type="checkbox" id="filter-manger" class="filter-checkbox" checked>
                            <i class="fa-solid fa-utensils"></i> Manger
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'dodo')">
                            <input type="checkbox" id="filter-dodo" class="filter-checkbox" checked>
                            <i class="fa-solid fa-bed"></i> Dormir
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'sortir')">
                            <input type="checkbox" id="filter-sortir" class="filter-checkbox" checked>
                            <i class="fa-solid fa-martini-glass-citrus"></i> Sortir
                        </div>
                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'spot')">
                            <input type="checkbox" id="filter-spot" class="filter-checkbox" checked>
                            <i class="fa-solid fa-map-pin"></i> Spots
                        </div>

                        <div
                            style="width:1px; background:rgba(0,0,0,0.1); margin:0 4px; height:20px; align-self:center;">
                        </div>

                        <div class="filter-chip-map active" onclick="toggleFilter(this, 'favorites')">
                            <input type="checkbox" id="filter-favorites" class="filter-checkbox">
                            <i class="fa-solid fa-heart"></i> Favoris
                        </div>
                    </div>
                </div>

                <button id="btnLocateMe" class="btn-locate" title="Autour de moi">
                    <i class="fas fa-location-crosshairs"></i>
                </button>
            </div>

            <!-- Shortcuts -->
            <div class="shortcuts-grid">
                <div class="shortcut-card" data-goto="spots">
                    <div class="shortcut-icon">🔥</div>
                    <h3 class="shortcut-title">Spots Locaux</h3>
                    <p class="shortcut-desc">9 lieux secrets accessibles uniquement via contact local</p>
                </div>

                <div class="shortcut-card" data-goto="langue">
                    <div class="shortcut-icon">🗣️</div>
                    <h3 class="shortcut-title">50+ Expressions</h3>
                    <p class="shortcut-desc">Phrases essentielles en malgache avec prononciation audio</p>
                </div>

                <div class="shortcut-card" data-goto="outils">
                    <div class="shortcut-icon">🧰</div>
                    <h3 class="shortcut-title">Outils Terrain</h3>
                    <p class="shortcut-desc">Convertisseur devises, checklist voyage, numéros utiles</p>
                </div>
            </div>
        </section>




        <!-- Pages Provinces (Contenu Riche) -->

        <!-- Antananarivo -->
        <section id="page-antananarivo" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/tana/tana_ambohimanga_royal_hill_1765475311821.png'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Antananarivo</h2>
                    <p class="city-desc">Capitale historique et culturelle.</p>
                </div>
            </div>
            <!-- Filter Menu -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('antananarivo', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('antananarivo', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('antananarivo', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('antananarivo', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('antananarivo', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('antananarivo', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div class="sep-vertical"></div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('antananarivo', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('antananarivo', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('antananarivo', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Antananarivo" style="padding: 0 20px; margin-bottom: 20px;"></div>
            <div id="grid-Antananarivo" class="lieux-grid" style="padding:20px;">
                <!-- Hydrated -->
            </div>
        </section>

        <!-- Antsiranana (Diego) -->
        <section id="page-antsiranana" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/villes/diego-suarez.jpg'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Diego-Suarez</h2>
                    <p class="city-desc">Merveilles du Nord et Tsingy.</p>
                </div>
            </div>

            <!-- Filters -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('antsiranana', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('antsiranana', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('antsiranana', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('antsiranana', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('antsiranana', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('antsiranana', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div class="sep-vertical"></div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('antsiranana', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('antsiranana', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('antsiranana', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Antsiranana" style="padding: 0 20px; margin-bottom: 20px;"></div>

            <div id="grid-Antsiranana" class="lieux-grid" style="padding:20px;">
                <!-- Hydrated -->
            </div>
        </section>

        <!-- Nosy Be (NEW INDEPENDENT PAGE) -->
        <section id="page-nosybe" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/iles/nosy-komba.jpg'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Nosy Be</h2>
                    <p class="city-desc">L'île aux Parfums & Archipel.</p>
                </div>
            </div>

            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('nosybe', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('nosybe', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('nosybe', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('nosy be', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('nosybe', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('nosybe', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div class="sep-vertical"></div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('nosybe', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('nosybe', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('nosybe', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-NosyBe" style="padding: 0 20px; margin-bottom: 20px;"></div>

            <div id="grid-NosyBe" class="lieux-grid" style="padding:20px;">
                <!-- Hydrated -->
            </div>
        </section>

        <!-- Fianarantsoa -->
        <section id="page-fianarantsoa" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/fianarantsoa/fianar_haute_ville.png'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Fianarantsoa</h2>
                    <p class="city-desc">La route des vins et du thé.</p>
                </div>
            </div>
            <!-- Filter Menu -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('fianarantsoa', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('fianarantsoa', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('fianarantsoa', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('fianarantsoa', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('fianarantsoa', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('fianarantsoa', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div style="width:1px; background:rgba(255,255,255,0.1); margin:0 5px; height:20px; align-self:center;">
                </div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('fianarantsoa', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('fianarantsoa', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('fianarantsoa', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Fianarantsoa" style="padding: 0 20px; margin-bottom: 20px;"></div>
            <div id="grid-Fianarantsoa" class="lieux-grid" style="padding:20px;">
                <div class="shortcut-card" style="padding:20px; text-align:center;">
                    <h3>🚂 Train FCE</h3>
                    <p>Une aventure ferroviaire mythique.</p>
                </div>
            </div>
        </section>

        <!-- Mahajanga -->
        <section id="page-mahajanga" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/mahajanga/mahajanga_baobab_tree_1765470123908.png'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Mahajanga</h2>
                    <p class="city-desc">La cité des fleurs et des baobabs.</p>
                </div>
            </div>
            <!-- Filter Menu -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('mahajanga', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('mahajanga', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('mahajanga', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('mahajanga', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('mahajanga', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('mahajanga', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div style="width:1px; background:rgba(255,255,255,0.1); margin:0 5px; height:20px; align-self:center;">
                </div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('mahajanga', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('mahajanga', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('mahajanga', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Mahajanga" style="padding: 0 20px; margin-bottom: 20px;"></div>
            <div id="grid-Mahajanga" class="lieux-grid" style="padding:20px;">
                <div class="shortcut-card" style="padding:20px; text-align:center;">
                    <h3>🌳 Baobab Centenaire</h3>
                    <p>Symbole de la ville.</p>
                </div>
            </div>
        </section>

        <!-- Toamasina -->
        <section id="page-toamasina" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/iles/ile-aux-nattes.jpg'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Toamasina</h2>
                    <p class="city-desc">Port principal et Canal des Pangalanes.</p>
                </div>
            </div>
            <!-- Filter Menu -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('toamasina', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('toamasina', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('toamasina', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('toamasina', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('toamasina', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('toamasina', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div style="width:1px; background:rgba(255,255,255,0.1); margin:0 5px; height:20px; align-self:center;">
                </div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('toamasina', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('toamasina', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('toamasina', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Toamasina" style="padding: 0 20px; margin-bottom: 20px;"></div>
            <div id="grid-Toamasina" class="lieux-grid" style="padding:20px;">
                <div class="shortcut-card" style="padding:20px; text-align:center;">
                    <h3>⛵ Canal des Pangalanes</h3>
                    <p>Navigation fluviale unique.</p>
                </div>
            </div>
        </section>

        <!-- Toliara -->
        <section id="page-toliara" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/toliara_placeholder.png'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Toliara</h2>
                    <p class="city-desc">Le grand Sud et ses lagons.</p>
                </div>
            </div>
            <!-- Filter Menu -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('toliara', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('toliara', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('toliara', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('toliara', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('toliara', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('toliara', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div style="width:1px; background:rgba(255,255,255,0.1); margin:0 5px; height:20px; align-self:center;">
                </div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('toliara', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('toliara', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('toliara', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Toliara" style="padding: 0 20px; margin-bottom: 20px;"></div>
            <div id="grid-Toliara" class="lieux-grid" style="padding:20px;">
                <div class="shortcut-card" style="padding:20px; text-align:center;">
                    <h3>🏖️ Ifaty & Anakao</h3>
                    <p>Plages paradisiaques.</p>
                </div>
            </div>
        </section>

        <!-- Sainte Marie (New Page) -->
        <section id="page-saintemarie" class="page-section">
            <div class="city-header premium-banner-tout"
                style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('images/iles/ile-aux-nattes.jpg'); background-size: cover; background-position: center; min-height: 300px !important; display: flex !important;">
                <div class="banner-content">
                    <button onclick="navigateToHomeDestinations()" class="btn-back-2026">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <h2 class="city-title">Sainte Marie</h2>
                    <p class="city-desc">L'île des Pirates & Baleines.</p>
                </div>
            </div>
            <!-- Filter Menu -->
            <div class="province-filter-container">
                <button class="nav-pill active" onclick="filterProvinceItems('saintemarie', 'all', this)"><i
                        class="fas fa-layer-group"></i> Tout</button>
                <button class="nav-pill" onclick="filterProvinceItems('saintemarie', 'explorer', this)"><i
                        class="fas fa-binoculars"></i> Explorer</button>
                <button class="nav-pill" onclick="filterProvinceItems('saintemarie', 'manger', this)"><i
                        class="fas fa-utensils"></i> Manger</button>
                <button class="nav-pill" onclick="filterProvinceItems('saintemarie', 'dormir', this)"><i
                        class="fas fa-bed"></i> Dormir</button>
                <button class="nav-pill" onclick="filterProvinceItems('saintemarie', 'sortir', this)"><i
                        class="fas fa-glass-martini-alt"></i> Sortir</button>
                <button class="nav-pill" onclick="filterProvinceItems('saintemarie', 'spot', this)"><i
                        class="fas fa-map-pin"></i> Spots</button>
                <div style="width:1px; background:rgba(255,255,255,0.1); margin:0 5px; height:20px; align-self:center;">
                </div>
                <button class="nav-pill" data-level="1" onclick="toggleProvinceBudget('saintemarie', '1', this)"
                    data-level="1">€</button>
                <button class="nav-pill" data-level="2" onclick="toggleProvinceBudget('saintemarie', '2', this)"
                    data-level="2">€€</button>
                <button class="nav-pill" data-level="3" onclick="toggleProvinceBudget('saintemarie', '3', this)"
                    data-level="3">€€€</button>
            </div>
            <!-- Premium Info Container (Logistics) -->
            <div id="premium-container-Saintemarie" style="padding: 0 20px; margin-bottom: 20px;"></div>
            <div id="grid-Saintemarie" class="lieux-grid" style="padding:20px;">
                <!-- Hydrated by JS -->
            </div>
        </section>

        <!-- Page Spots Locaux -->
        <section id="page-spots" class="page-section">
            <h2 class="page-title"
                style="font-family: var(--font-display); font-size: 2rem; margin-bottom: 20px; color: var(--laterite);">
                🔥 Spots Locaux Authentiques</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 1.1rem;">
                Ces lieux sont <strong>inaccessibles sans contact humain local</strong>. Non référencés sur Google
                Maps,
                absents des guides touristiques traditionnels.
            </p>

            <!-- Filters for Spots Page -->
            <div class="province-filter-container"
                style="margin-bottom: 24px; justify-content: start; overflow-x: auto; padding-bottom: 8px;">
                <button class="nav-pill active" onclick="window.filterSpotsByRegion('all', this)">
                    <i class="fas fa-layer-group"></i> Tout
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Antananarivo', this)">
                    <i class="fas fa-landmark"></i> Tana
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Diego-Suarez', this)">
                    <i class="fas fa-anchor"></i> Diego
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Nosy Be', this)">
                    <i class="fas fa-umbrella-beach"></i> Nosy Be
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Mahajanga', this)">
                    <i class="fas fa-umbrella-beach"></i> Majunga
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Toamasina', this)">
                    <i class="fas fa-ship"></i> Tamatave
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Toliara', this)">
                    <i class="fas fa-sun"></i> Tuléar
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Fianarantsoa', this)">
                    <i class="fas fa-train"></i> Fianar
                </button>
                <button class="nav-pill" onclick="window.filterSpotsByRegion('Sainte-Marie', this)">
                    <i class="fas fa-fish"></i> Ste Marie
                </button>
            </div>
            <div id="spotsContainer" class="lieux-grid"></div>
        </section>

        <!-- Page Langue -->
        <section id="page-langue" class="page-section">
            <div class="langue-header">
                <h2
                    style="font-family: var(--font-display); font-size: 2rem; color: var(--text-primary); margin-bottom: 20px;">
                    🗣️
                    Expressions Malgaches</h2>
            </div>

            <div id="accordionContainer" class="accordion-container"></div>
        </section>

        <!-- Page Outils -->
        <section id="page-outils" class="page-section">
            <h2
                style="font-family: var(--font-display); font-size: 2rem; margin-bottom: 30px; color: var(--text-primary);">
                🧰 Outils Terrain</h2>

            <div class="tools-grid">
                <!-- Convertisseur -->
                <!-- Convertisseur Avancé -->
                <div class="tool-card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 class="tool-title" style="margin:0;">💱 Convertisseur</h3>
                        <div id="converterStatus" class="status-badge manual">Mode Manuel</div>
                    </div>

                    <div class="converter-controls" style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <select id="currencySelector" class="converter-select">
                            <option value="EUR" selected>🇪🇺 Euro (€)</option>
                            <option value="USD">🇺🇸 Dollar ($)</option>
                            <option value="GBP">🇬🇧 Livre (£)</option>
                            <option value="CHF">🇨🇭 Franc Suisse</option>
                            <option value="ZAR">🇿🇦 Rand (R)</option>
                        </select>
                        <button id="btnRefreshRate" class="btn-icon-small" title="Actualiser taux officiel">🔄</button>
                    </div>

                    <div class="converter-inputs" id="converterInputsContainer">
                        <div class="converter-row" id="rowForeign">
                            <span class="converter-label" id="foreignLabel">€</span>
                            <input type="number" id="inputForeign" class="converter-input" value="10" min="0"
                                step="0.01">
                        </div>

                        <div class="converter-actions" style="display:flex; justify-content:center; margin: 10px 0;">
                            <button id="btnInvert" class="btn-icon-small" title="Inverser le sens"
                                style="transform: rotate(90deg);">⇄</button>
                        </div>

                        <div class="converter-row" id="rowLocal">
                            <span class="converter-label">Ar</span>
                            <input type="number" id="inputLocal" class="converter-input" value="50000" min="0">
                        </div>
                    </div>

                    <div class="rate-info">
                        <span id="rateText">1 € = 5000 Ar</span>
                        <button id="btnEditRate" class="btn-text-action">Modifier manuellement</button>
                    </div>
                </div>

                <!-- Checklist -->
                <div class="tool-card">
                    <h3 class="tool-title">✅ Checklist Voyage</h3>
                    <div class="checklist-items" id="checklistContainer"></div>
                </div>

                <!-- Conseils Saisonniers -->
                <div class="tool-card">
                    <h3 class="tool-title">📅 Conseils Saisonniers</h3>
                    <div class="seasonal-advice">
                        <div class="advice-item good">
                            <div class="advice-title">🌞 Meilleure période : MAI à OCTOBRE</div>
                            <ul class="advice-list">
                                <li>Météo stable, routes praticables</li>
                                <li>Observation lémuriens optimale</li>
                                <li>Températures agréables (20-25°C)</li>
                            </ul>
                        </div>
                        <div class="advice-item warning">
                            <div class="advice-title">⚠️ À éviter : JANVIER à MARS</div>
                            <ul class="advice-list">
                                <li>Saison des pluies (cyclones possibles)</li>
                                <li>Routes coupées, parcs fermés</li>
                                <li>Forte humidité</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Paramètres -->
                <div class="tool-card">
                    <h3 class="tool-title">⚙️ Maintenance</h3>
                    <p style="color:var(--text-secondary); margin-bottom:15px; font-size:0.9rem;">Si l'application
                        semble lente ou buggée, vous pouvez réinitialiser les données.</p>
                    <button onclick="resetApp()" class="btn-action-secondary"
                        style="width:100%; border:1px solid #e74c3c; color:#e74c3c; background:rgba(231, 76, 60, 0.1);">
                        <i class="fas fa-trash-alt"></i> Réinitialiser l'application
                    </button>
                    <div
                        style="text-align:center; margin-top:10px; font-size:0.75rem; color:var(--text-secondary); opacity:0.6;">
                        Version 2.4.0 (Premium)
                    </div>
                </div>

                <!-- Numéros Utiles -->
                <div class="tool-card">
                    <h3 class="tool-title">📞 Numéros Utiles</h3>
                    <div class="contacts-list">
                        <div>
                            <div class="contact-group-title">🚨 Urgences</div>
                            <div class="contact-item">
                                <span class="contact-name">Police</span>
                                <span class="contact-number">117</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Pompiers</span>
                                <span class="contact-number">118</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Ambulance</span>
                                <span class="contact-number">119</span>
                            </div>
                        </div>

                        <div>
                            <div class="contact-group-title">🏛️ Ambassades</div>
                            <div class="contact-item">
                                <span class="contact-name">France</span>
                                <span class="contact-number">+261 20 22 399 98</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Belgique</span>
                                <span class="contact-number">+261 20 22 241 69</span>
                            </div>
                        </div>

                        <div>
                            <div class="contact-group-title">📶 Opérateurs</div>
                            <div class="contact-item">
                                <span class="contact-name">Telma</span>
                                <span class="contact-number">*111#</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Airtel</span>
                                <span class="contact-number">*121#</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outil Taxi-Brousse -->
                <div class="tool-card" id="tool-taxi">
                    <h3 class="tool-title"
                        style="font-family: 'Playfair Display', serif; font-size: 1.8rem; margin-bottom: 20px;">
                        <i class="fa-solid fa-van-shuttle" style="color: var(--laterite); margin-right: 10px;"></i>
                        Taxi-Brousse & Transports
                    </h3>

                    <div class="taxi-calculator">
                        <div class="taxi-form">
                            <div class="form-group">
                                <label>De</label>
                                <select id="taxiFrom" class="taxi-select">
                                    <!-- Populated by JS -->
                                </select>
                            </div>

                            <div class="form-group-icon">
                                <i class="fa-solid fa-arrow-right-arrow-left"></i>
                            </div>

                            <div class="form-group">
                                <label>Vers</label>
                                <select id="taxiTo" class="taxi-select">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>

                        <button id="btnCalcTaxi" class="btn-action-primary"
                            style="width: 100%; padding: 16px; border-radius: 12px; margin-top: 10px;">
                            Estimer Trajet
                        </button>

                        <div id="taxiResult" class="taxi-result hidden">
                            <div class="result-row">
                                <div class="result-item">
                                    <span class="result-label">Durée Estimée</span>
                                    <span class="result-value" id="resDuration">--</span>
                                </div>
                            </div>

                            <div class="result-divider"
                                style="height: 1px; background: rgba(0,0,0,0.1); margin: 15px 0;"></div>

                            <div id="resPriceContainer" class="price-tiers-container">
                                <!-- Populated by JS -->
                            </div>

                            <div class="mt-20">
                                <span class="result-note">⚠️ Tarifs indicatifs (Lite / Premium / VIP)</span>
                            </div>

                            <div id="companiesSection" class="companies-section hidden">
                                <h4
                                    style="font-family: 'Playfair Display', serif; color: var(--text-primary); margin-bottom: 15px;">
                                    Compagnies Recommandées</h4>
                                <div id="companiesList" class="companies-list">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
        </section>
    </main>

    <!-- Modal Détails -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">×</button>
            <img id="modalImage" class="modal-image" src="" alt="" loading="lazy">
            <div class="modal-body">
                <h2 id="modalTitle" class="modal-title"></h2>
                <div id="modalBadges" style="margin-bottom: 16px;"></div>
                <div id="modalInfoGrid" class="modal-info-grid"></div>
                <div id="modalSections"></div>
            </div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <span>📱 Installer l'app pour un accès offline</span>
        <button class="install-btn" id="installBtn">Installer</button>
        <button class="install-close" id="installClose">×</button>
    </div>

    <!-- SCRIPTS -->
    <!-- GSAP Animation Library -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/Flip.min.js"></script>

    <!-- Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <!-- CORE DATA -->
    <script src="data/lieux.js?v=FIX_STD_COMPLETE_1"></script>
    <script src="data/itineraires.js?v=Force_RELOAD"></script>
    <script src="data/phrases.js?v=1767094000"></script>

    <!-- App Logic -->
    <script src="js/app-data.js?v=FIX_INIT_DATA"></script>
    <script src="js/app.js?v=2026.PERF.1"></script>
    <!-- script src="js/map-logic.js?v=FORCE_DEBUG"></script> REMOVED FOR MODULES -->

    <!-- GSAP Animations -->
    <script src="js/gsap-config.js"></script>
    <script src="js/animations.js"></script>


    <!-- MODALE FICHE LIEU (CARTE - Fix) -->
    <div id="lieuModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>

            <div class="modal-header-image">
                <img id="modal-image" src="" alt="Lieu">
                <span id="modal-type" class="modal-badge-type"></span>
            </div>

            <div class="modal-body">
                <h2 id="modal-title" class="modal-title"></h2>

                <div class="modal-meta-row">
                    <span id="modal-price" class="meta-tag price"></span>
                    <span id="modal-duration" class="meta-tag duration"></span>
                    <span id="modal-access" class="meta-tag access"></span>
                </div>

                <div class="modal-description" id="modal-desc"></div>

                <div id="modal-advice-section" class="modal-advice-box">
                    <div class="advice-title">💡 Le conseil du local</div>
                    <p id="modal-advice"></p>
                </div>

                <a id="modal-link-btn" href="#" target="_blank" class="btn-action-primary">
                    <i class="fas fa-globe"></i> Visiter le site web
                </a>
            </div>
        </div>
    </div>



    <!-- FOOTER PREMIUM -->
    <footer
        style="text-align: center; padding: 24px 20px 40px; color: var(--text-secondary); font-size: 0.85rem; border-top: 1px solid var(--border-color); margin-top: 0;">
        <p style="margin-bottom: 8px;">&copy; 2026 Gasikara Explorer. Tous droits réservés.</p>
        <p style="opacity: 0.7; font-size: 0.75rem;">Les prix et les photos sont indicatifs et non contractuels.</p>
    </footer>
</body>

</html>