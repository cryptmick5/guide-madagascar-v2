console.log("üöÄ APP.JS LOADED - STARTING INIT"),window.currentTheme="light",window.exchangeRate=4250,window.favorites=[],window.checklist=[],window.initData=function(){return new Promise(e=>{if("undefined"!=typeof LIEUX_DATA&&"undefined"!=typeof ITINERAIRES_DATA){window.LIEUX_DATA=LIEUX_DATA,window.ITINERAIRES_DATA=ITINERAIRES_DATA,window.PHRASES_DATA="undefined"!=typeof PHRASES_DATA?PHRASES_DATA:{},window.CHECKLIST_ITEMS="undefined"!=typeof CHECKLIST_ITEMS?CHECKLIST_ITEMS:[{id:"passeport",text:"Passeport (validit√© 6 mois)"},{id:"visa",text:"Visa (√† l'arriv√©e ou e-visa)"},{id:"billet",text:"Billets d'avion imprim√©s"},{id:"cash",text:"Euros en esp√®ces (pour le change)"},{id:"vete_leger",text:"V√™tements l√©gers (coton/lin)"},{id:"pull",text:"Un pull l√©ger (soir√©es/avion)"},{id:"chaussure",text:"Chaussures de marche confortables"},{id:"maillot",text:"Maillot de bain & Serviette"},{id:"pharmacie",text:"Trousse √† pharmacie (base + antipalu)"},{id:"moustique",text:"R√©pulsif moustique (Zone Tropiques)"},{id:"creme",text:"Cr√®me solaire (SPF 50)"},{id:"lunettes",text:"Lunettes de soleil & Chapeau"},{id:"adaptateur",text:"Adaptateur universel (optionnel)"},{id:"batterie",text:"Batterie externe (Powerbank)"},{id:"lampe",text:"Lampe torche / Frontale (coupures)"}];try{"undefined"!=typeof localStorage&&(window.currentTheme=localStorage.getItem("theme")||"light",window.exchangeRate=parseFloat(localStorage.getItem("exchangeRate"))||4250,window.favorites=JSON.parse(localStorage.getItem("favorites"))||[],window.checklist=JSON.parse(localStorage.getItem("checklist"))||[])}catch(e){console.warn("LS Error",e)}window.MapModule&&window.MapModule.init(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("‚úÖ SW registered:",e.scope),setInterval(()=>e.update(),36e5)}).catch(e=>console.error("‚ùå SW registration failed:",e))}),e()}else console.error("Critical Data Missing!")})},window.initTheme=function(){console.log("üåì Theme initialized via Native Event Handlers.")},window.toggleTheme=function(){const e=document.documentElement,t=document.getElementById("themeToggle"),n="light"===(e.getAttribute("data-theme")||"light")?"dark":"light";e.setAttribute("data-theme",n),localStorage.setItem("theme",n),t&&(t.innerHTML="light"===n?"üåô":"‚òÄÔ∏è",t.setAttribute("aria-label","Activer le mode "+("light"===n?"nuit":"jour"))),console.log("Theme toggled to:",n)},document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e);const t=document.getElementById("themeToggle");t&&(t.innerHTML="light"===e?"üåô":"‚òÄÔ∏è")}),window.isFavorite=function(e){return window.favorites.includes(e)},window.toggleLieuFavorite=function(e,t,n){n&&n.stopPropagation();const i=window.favorites.indexOf(e);-1===i?(window.favorites.push(e),t&&(t.innerHTML='<i class="fa-solid fa-bookmark"></i>'),t&&t.classList.add("active"),navigator.vibrate&&navigator.vibrate(10)):(window.favorites.splice(i,1),t&&(t.innerHTML='<i class="fa-regular fa-bookmark"></i>'),t&&t.classList.remove("active")),localStorage.setItem("favorites",JSON.stringify(window.favorites))},window.navigateToHomeDestinations=function(){console.log("üîÑ Navigation Fluide: Retour Destinations..."),document.querySelectorAll(".page-section").forEach(e=>{e.style.display="none",e.classList.remove("active");const t=e.querySelector("video");t&&t.pause()});const e=document.getElementById("page-accueil");e&&(e.style.display="block",e.classList.add("active"),setTimeout(()=>{const e=document.getElementById("home-destinations");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},10)),document.querySelectorAll(".nav-btn").forEach(e=>e.classList.remove("active"));const t=document.querySelector('.nav-btn[data-page="accueil"]');t&&t.classList.add("active")},window.initNavigation=function(){const e=document.querySelectorAll(".nav-btn"),t=document.querySelectorAll(".shortcut-card");e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.page;navigateToPage(t)})}),t.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.goto;navigateToPage(t)})})},window.previousPageContext=null,window.navigateToPage=async function(e){if(console.log("üîÑ navigateToPage called with:",e),!e)return;let t=e;t.startsWith("page-")||(t="page-"+e);const n=document.querySelector(".page-section.active");if(n){const e=n.id;"page-carte"!==e&&"page-accueil"!==e&&e.startsWith("page-")?window.previousPageContext=e:"page-accueil"===e&&(window.previousPageContext=null)}document.querySelectorAll(".page-section").forEach(e=>{e.classList.remove("active"),e.style.display="none";const t=e.querySelector("video");t&&t.pause()}),document.querySelectorAll(".nav-btn").forEach(e=>e.classList.remove("active"));const i=document.getElementById(t);if(i){if(i.style.display="block",setTimeout(()=>i.classList.add("active"),10),window.scrollTo({top:0,behavior:"smooth"}),"carte"===e){window.leafletMap&&setTimeout(()=>{window.leafletMap&&window.leafletMap.invalidateSize()},300);const e=document.getElementById("btn-back-context-container"),t=document.getElementById("btn-back-context-label");if(window.previousPageContext&&e&&t){let n="Province";window.previousPageContext.includes("antsiranana")?n="Diego":window.previousPageContext.includes("nosybe")?n="Nosy Be":window.previousPageContext.includes("mahajanga")?n="Majunga":window.previousPageContext.includes("toamasina")?n="Tamatave":window.previousPageContext.includes("toliara")?n="Tul√©ar":window.previousPageContext.includes("fianarantsoa")?n="Fianar":window.previousPageContext.includes("antananarivo")?n="Tana":window.previousPageContext.includes("saintemarie")&&(n="Ste Marie"),t.innerText=`Retour √† ${n}`,e.style.display="block"}else e&&(e.style.display="none")}setTimeout(()=>{window.GasikaraAnimations&&window.GasikaraAnimations.refresh()},100)}const a=e.replace("page-",""),o=document.querySelector(`.nav-btn[data-page="${a}"]`);o&&o.classList.add("active"),window._modulesLoaded||(window._modulesLoaded={});try{"carte"!==a||window._modulesLoaded.map||(console.log("Lazy Loading: Map Module..."),await import("./modules/map.js"),"function"==typeof window.initMap&&window.initMap(),window._modulesLoaded.map=!0),["antsiranana","nosybe","mahajanga","toamasina","toliara","fianarantsoa","antananarivo","saintemarie"].some(e=>a.includes(e))&&!window._modulesLoaded.cities&&(console.log("Lazy Loading: Cities Module..."),await import("./modules/cities.js"),"function"==typeof window.initCityPages&&window.initCityPages(),window._modulesLoaded.cities=!0),"itineraires"!==a||window._modulesLoaded.itineraires||(console.log("Lazy Loading: Itineraries Module..."),await import("./modules/itineraries.js"),"function"==typeof window.initItinerariesPage&&window.initItinerariesPage(),window._modulesLoaded.itineraires=!0),"spots"!==a||window._modulesLoaded.spots||(console.log("Lazy Loading: Spots Module..."),await import("./modules/spots.js"),"function"==typeof window.initSpotsPage&&window.initSpotsPage(),window._modulesLoaded.spots=!0),"outils"!==a||window._modulesLoaded.outils||(console.log("Lazy Loading: Tools Module..."),await import("./modules/tools.js"),"function"==typeof window.initOutilsPage&&window.initOutilsPage(),window._modulesLoaded.outils=!0),"langue"!==a||window._modulesLoaded.langue||("function"==typeof window.initLanguePage&&window.initLanguePage(),window._modulesLoaded.langue=!0)}catch(e){console.error("Module Load Error:",e)}},window.navigateBack=function(){if(window.previousPageContext){const e=window.previousPageContext.replace("page-","");window.navigateToPage(e)}else window.navigateToPage("accueil")},window.showSection=window.navigateToPage,window.initItinerariesPage=function(){const e=document.getElementById("itineraires-list");if(!e)return;const t=window.ITINERAIRES_DATA?Object.values(window.ITINERAIRES_DATA):[],n={"circuit-nord":"circuits/epopee-grand-nord.html","circuit-cacao":"circuits/route-du-cacao.html","circuit-vanille":"circuits/cote-de-la-vanille.html","circuit-nosybe":"circuits/archipel-nosy-be.html"};e.innerHTML=t.map((e,t)=>`\n        <div class="lieu-card fade-in-up hover-lift" style="animation-delay: ${.1*t}s;">\n             <div class="lieu-image" style="${e.image?`background-image: url('${e.image}'); background-size: cover; background-position: center;`:"background: linear-gradient(to bottom right, var(--laterite), var(--foret)); display:flex; align-items:center; justify-content:center; color:white; font-size:3rem;"}">\n                ${e.image?"":'<i class="fas fa-route"></i>'}\n             </div>\n             <div class="lieu-content">\n                <h3 class="lieu-title">${e.nom}</h3>\n                <div class="lieu-meta"><span class="badge-type">${e.duree}</span><span class="lieu-prix">${e.budget||"Variable"}</span></div>\n                <p class="lieu-desc">${e.description}</p>\n                <a href="${n[e.id]||"#"}" class="btn-details">Voir le d√©tail</a>\n             </div>\n        </div>\n    `).join("")},window.showItineraryDetail=function(e){const t=document.getElementById("itineraires-list"),n=document.getElementById("itineraire-detail"),i=document.getElementById("itineraire-content"),a=document.querySelector("#page-itineraires > .premium-banner-tout"),o=window.ITINERAIRES_DATA||{};let s=Object.values(o).find(t=>t.id===e);if(!s)return;t.style.display="none",a&&(a.style.display="none"),n.style.display="block";let r=`\n        <div class="circuit-detail-banner city-header" style="background-image: url('${s.image}');">\n            <div class="banner-overlay"></div>\n            <div class="banner-content">\n                <h2 class="city-title" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);">${s.nom}</h2>\n                <p class="city-desc" style="text-shadow: 0 1px 2px rgba(0,0,0,0.3); opacity: 0.9;">${s.description}</p>\n            </div>\n            <button onclick="backToItineraries()" class="btn-back-floating"><i class="fas fa-arrow-left"></i></button>\n        </div>\n\n        <div style="padding: 20px; max-width: 800px; margin: 0 auto;">\n            \x3c!-- META INFO --\x3e\n            <div style="display:flex; gap:15px; margin-bottom:25px; flex-wrap:wrap; justify-content: center;">\n                <span class="meta-tag"><i class="far fa-clock"></i> ${s.duree}</span>\n                <span class="meta-tag"><i class="fas fa-shield-alt"></i> S√©curit√©: ${s.infos.securite_level}</span>\n                <span class="meta-tag"><i class="fas fa-sun"></i> ${(s.logistique_generale||{}).saison_ideale||"Toute ann√©e"}</span>\n            </div>\n\n            \x3c!-- LE MOT DU GUIDE (COLLAPSIBLE) --\x3e\n            <div class="logistique-container" style="margin-top:0;">\n                 ${Object.keys(s.logistique_generale||{}).length>0||s.infos?`\n                    <div class="accordion-v3" style="margin-top:20px;">\n                        <div class="accordion-item">\n                            <button class="accordion-trigger" aria-expanded="false" onclick="window.toggleAccordionV3(this)">\n                                <div class="accordion-header-content">\n                                    <div class="icon-wrapper"><i class="fas fa-info-circle"></i></div>\n                                    <div class="accordion-text">\n                                        <div class="accordion-heading">Infos Pratiques & FAQ</div>\n                                        <div class="accordion-subtitle">Logistique du circuit</div>\n                                    </div>\n                                </div>\n                                <i class="fas fa-chevron-down chevron"></i>\n                            </button>\n                            <div class="accordion-body" aria-hidden="true">\n                                <div class="accordion-inner">\n                                    <ul style="list-style:none; padding:0; margin:0;">\n                                        ${(s.logistique_generale||{}).saison_ideale?`<li style="margin-bottom:10px;"><strong><i class="fas fa-sun"></i> Saison Id√©ale:</strong> ${(s.logistique_generale||{}).saison_ideale}</li>`:""}\n                                        ${(s.logistique_generale||{}).vehicule_conseil?`<li style="margin-bottom:10px;"><strong><i class="fas fa-car-side"></i> Transport:</strong> ${(s.logistique_generale||{}).vehicule_conseil}</li>`:""}\n                                        ${(s.logistique_generale||{}).route_etat?`<li style="margin-bottom:10px;"><strong><i class="fas fa-road"></i> √âtat de la route:</strong> ${(s.logistique_generale||{}).route_etat}</li>`:""}\n                                        ${s.infos.securite_level?`<li style="margin-bottom:10px;"><strong><i class="fas fa-shield-alt"></i> S√©curit√©:</strong> ${s.infos.securite_level}</li>`:""}\n                                        ${s.infos.description_fun?`<li style="margin-top:15px; font-style:italic; color:var(--laterite);">"${s.infos.description_fun}"</li>`:""}\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `:""}\n            </div>\n\n            \x3c!-- BUDGET SELECTOR --\x3e\n            ${s.budgets?`\n            <h3 style="margin-top:30px; margin-bottom:15px; font-family:var(--font-display);">Options de Voyage</h3>\n            <div class="budget-selector">\n                <div id="budget-btn-eco" class="budget-option" onclick="switchCircuitBudget('${e}', 'eco')">\n                    <span class="budget-label">Eco / Backpacker</span>\n                </div>\n                <div id="budget-btn-standard" class="budget-option active" onclick="switchCircuitBudget('${e}', 'standard')">\n                    <span class="budget-label">Confort Standard</span>\n                </div>\n                <div id="budget-btn-premium" class="budget-option" onclick="switchCircuitBudget('${e}', 'premium')">\n                    <span class="budget-label">Luxe Premium</span>\n                </div>\n            </div>\n            <div style="background:var(--bg-secondary); padding:20px; border-radius:12px; border:1px solid var(--border-color); box-shadow:0 4px 6px rgba(0,0,0,0.02);">\n                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">\n                    <span id="budget-price-display" class="budget-price" style="font-size:2rem; color:var(--laterite); font-weight:800;">${(s.budgets.standard||{}).price||"-"}</span>\n                    <span style="font-size:0.9rem; color:var(--text-secondary);">/ personne (base 2)</span>\n                </div>\n                <p id="budget-desc-display" style="margin-bottom:15px; color:var(--text-primary); font-size:1.05rem;">${(s.budgets.standard||{}).desc||""}</p>\n                <ul id="budget-inclusions" style="list-style:none; padding:0; display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:0.9rem;">\n                    ${s.budgets.standard&&s.budgets.standard.inclus?s.budgets.standard.inclus.map(e=>`<li><i class="fas fa-check" style="color:var(--success);"></i> ${e}</li>`).join(""):""}\n                </ul>\n            </div>\n            `:""}\n\n            \x3c!-- TIMELINE (CORE) --\x3e\n            <h3 style="margin-top:40px; margin-bottom:20px; font-family:var(--font-display);">Programme D√©taill√©</h3>\n            <div class="timeline-container">\n    `;s.etapes&&s.etapes.forEach(e=>{let t="";e.logistique&&(t=`\n                    <div class="logic-bar">\n                        <div class="logic-point start"><span class="logic-label">D√©part</span><span class="logic-val">${e.logistique.depart||""}</span></div>\n                        <div class="logic-arrow"><i class="fas fa-arrow-right"></i><span class="logic-dist">${e.logistique.duree_totale_transport||""}</span></div>\n                        <div class="logic-point end"><span class="logic-label">Arriv√©e</span><span class="logic-val">${e.logistique.arrivee||""}</span></div>\n                    </div>`);let n="";e.transports_details&&(n='<div class="transport-detail-row">',e.transports_details.forEach(e=>{let t="fa-car";e.type.toLowerCase().includes("bateau")&&(t="fa-ship"),e.type.toLowerCase().includes("marche")&&(t="fa-hiking"),e.type.toLowerCase().includes("avion")&&(t="fa-plane"),n+=`<div class="transport-pill"><i class="fas ${t}"></i> <span>${e.type} (${e.duree})</span></div>`}),n+="</div>");let i="";e.hebergement_options&&(i=window.getAccomGridHtml(e.hebergement_options)),r+=`\n                <div class="timeline-step">\n                    <div class="timeline-marker"></div>\n                    <div class="timeline-header">\n                        <span class="timeline-day">Jour ${e.jour}</span>\n                        <h4 class="timeline-title">${e.titre}</h4>\n                    </div>\n                    \n                    ${t}\n                    \n                    <div class="timeline-content expert-desc">\n                        ${e.description_expert||e.description}\n                    </div>\n                    \n                    \x3c!-- IMANQUABLES --\x3e\n                    ${e.incontournables?`\n                        <div class="step-section-title"><i class="fas fa-eye"></i> Les Immanquables</div>\n                        <div class="incontournables-tags">\n                            ${e.incontournables.map(e=>"object"==typeof e&&e.id?`<span class="visi-tag clickable" onclick="window.showLieuDetailsByID(${e.id})"><i class="fas fa-eye"></i> ${e.label||e.nom}</span>`:`<span class="visi-tag">${e}</span>`).join("")}\n                        </div>\n                    `:""}\n\n                    ${n}\n\n                    \x3c!-- ACCORDEONS (DODO, MIAM, TIPS) --\x3e\n                    <div style="margin-top:20px; display:flex; flex-direction:column; gap:10px;">\n                        ${e.hebergement_options?`\n                        <div class="step-accordion">\n                            <div class="step-accordion-header" onclick="window.toggleStepAccordion(this)">\n                                <div class="step-accordion-title">\n                                    <span><i class="fas fa-bed"></i> O√π poser ses valises ?</span>\n                                    <span class="preview-text">${window.getAccomPreviewText(e.hebergement_options)}</span>\n                                </div>\n                                <i class="fas fa-chevron-down Chevron"></i>\n                            </div>\n                            <div class="step-accordion-body">${i}</div>\n                        </div>`:""}\n\n                        ${e.gourmandise?`\n                        <div class="step-accordion culinary">\n                            <div class="step-accordion-toggle-btn step-accordion-header">\n                                <div class="step-accordion-title"><span><i class="fas fa-utensils"></i> Instant Gourmand</span></div>\n                                <i class="fas fa-chevron-down Chevron"></i>\n                            </div>\n                            <div class="step-accordion-outer">\n                                <div class="step-accordion-inner step-accordion-body"><div class="accordion-inner-content" style="padding:15px;">${e.gourmandise}</div></div>\n                            </div>\n                        </div>`:""}\n\n                        ${e.astuce?`\n                        <div class="step-accordion astuce">\n                            <div class="step-accordion-toggle-btn step-accordion-header">\n                                <div class="step-accordion-title"><span><i class="fas fa-lightbulb"></i> Le Conseil Expert</span></div>\n                                <i class="fas fa-chevron-down Chevron"></i>\n                            </div>\n                            <div class="step-accordion-outer">\n                                <div class="step-accordion-inner step-accordion-body"><div class="accordion-inner-content" style="padding:15px;">${e.astuce}</div></div>\n                            </div>\n                        </div>`:""}\n                    </div>\n                </div>\n            `}),r+="</div></div>",i.innerHTML=r,attachAccordionListeners(),window.scrollTo({top:0,behavior:"smooth"})},window.backToItineraries=function(){document.getElementById("itineraires-list").style.display="grid",document.getElementById("itineraire-detail").style.display="none";const e=document.querySelector("#page-itineraires > .premium-banner-tout");e&&(e.style.display="block"),window.scrollTo({top:0,behavior:"smooth"})};const appAccordionObservers=new WeakMap;window.forceRecalculateHeight=function(e){const t=e.querySelector(".step-accordion-outer"),n=e.querySelector(".step-accordion-inner")||e.querySelector(".step-accordion-body");if(!e.classList.contains("open")||!t||!n)return;n.offsetHeight;const i=n.scrollHeight;t.style.maxHeight=i+50+"px"};const forceRecalculateHeight=window.forceRecalculateHeight;function attachAccordionListeners(){document.querySelectorAll(".step-accordion-toggle-btn").forEach(e=>{e.dataset.hasListener||(e.dataset.hasListener="true",e.addEventListener("click",t=>{t.stopPropagation(),toggleStepAccordion(e)}))}),document.querySelectorAll(".step-sub-accordion").forEach(e=>{e.dataset.hasListener||(e.dataset.hasListener="true",e.addEventListener("toggle",t=>{t.stopPropagation();const n=e.closest(".step-accordion");n&&(setTimeout(()=>{forceRecalculateHeight(n)},50),requestAnimationFrame(()=>{forceRecalculateHeight(n)}))}))})}function toggleStepAccordion(e){const t=(e.tagName,e),n=t.closest(".step-accordion");if(!n)return;const i=n.querySelector(".step-accordion-outer"),a=n.querySelector(".step-accordion-inner")||n.querySelector(".step-accordion-body");if(!i)return void e.parentElement.classList.toggle("open");const o=n.classList.toggle("open");if(t.setAttribute&&t.setAttribute("aria-expanded",o),o){if(i.style.maxHeight="none",!appAccordionObservers.has(n)){const e=new ResizeObserver(e=>{for(let t of e)requestAnimationFrame(()=>{if(!n.classList.contains("open"))return;const e=a.scrollHeight;i.style.maxHeight=e+30+"px"})});e.observe(a),appAccordionObservers.set(n,e)}if(window.innerWidth<=768){n.querySelectorAll(".step-sub-accordion").forEach(e=>{e.open=!0});let e=0;const t=setInterval(()=>{forceRecalculateHeight(n),e++,e>=10&&clearInterval(t)},100)}}else{const e=appAccordionObservers.get(n);e&&(e.disconnect(),appAccordionObservers.delete(n)),i.style.maxHeight="0px"}}function initTaxiTool(){const e=document.getElementById("btnCalcTaxi"),t=document.getElementById("taxiFrom"),n=document.getElementById("taxiTo"),i=document.getElementById("taxiResult");if(t&&n){const e=["Antananarivo","Diego-Suarez","Mahajanga","Toamasina","Fianarantsoa","Toliara","Nosy Be","Ambanja","Antsirabe"].map(e=>`<option value="${e}">${e}</option>`).join("");t.innerHTML=e,n.innerHTML=e,n.value="Diego-Suarez"}e&&t&&n&&i&&e.addEventListener("click",()=>{if(t.value===n.value)return i.innerHTML="<p style='color:red; text-align:center;'>Tu es d√©j√† arriv√© ! Choisis une autre destination. üòÇ</p>",void i.classList.remove("hidden");const e=["Zay ! Tu es press√© ou tu veux admirer le paysage ?","En Taxi-Brousse, le temps est une notion abstraite... üòÇ","Pr√©pare ta playlist, √ßa va √™tre long (mais beau) !","Astuce : Prends la place devant si tu tiens √† tes genoux.","Mora Mora... on arrive quand on arrive."],a=e[Math.floor(Math.random()*e.length)];let o=Math.floor(800*Math.random())+100,s=Math.floor(o/50),r=100*o;i.innerHTML=`\n                <div style="background:var(--bg-secondary); padding:10px; border-radius:8px; margin-bottom:15px; border-left:4px solid var(--laterite); font-style:italic;">\n                    "${a}"\n                </div>\n\n                <div class="result-row">\n                    <div class="result-item">\n                        <span class="result-label">Dur√©e Estim√©e</span>\n                        <span class="result-value" id="resDuration">${s}h ${Math.floor(60*Math.random())}min</span>\n                    </div>\n                </div>\n\n                <div class="result-divider" style="height: 1px; background: rgba(0,0,0,0.1); margin: 15px 0;"></div>\n\n                <div id="resPriceContainer" class="price-tiers-container">\n                    <div class="price-tier">\n                        <div class="price-tier-name">Taxi-Brousse</div>\n                        <div class="price-tier-amount">${(10*r).toLocaleString()} Ar</div>\n                    </div>\n                     <div class="price-tier featured">\n                        <div class="price-tier-name">Cotisse / VIP</div>\n                        <div class="price-tier-amount">${(25*r).toLocaleString()} Ar</div>\n                    </div>\n                     <div class="price-tier">\n                        <div class="price-tier-name">Location 4x4</div>\n                        <div class="price-tier-amount">${(150*r).toLocaleString()} Ar</div>\n                    </div>\n                </div>\n\n                <div class="mt-20">\n                    <span class="result-note">‚ö†Ô∏è Tarifs indicatifs (Lite / Premium / VIP)</span>\n                </div>\n\n                <div id="companiesSection" class="companies-section">\n                    <h4 style="font-family: 'Playfair Display', serif; color: var(--text-primary); margin-bottom: 15px;">Compagnies Recommand√©es</h4>\n                    <div id="companiesList" class="companies-list">\n                        <div class="company-card">\n                            <div class="company-logo">üöê</div>\n                            <div><strong>Cotisse Transport</strong><br><span style="font-size:0.8rem; color:#666;">Premium & Wi-Fi</span></div>\n                        </div>\n                        <div class="company-card">\n                            <div class="company-logo">üöå</div>\n                            <div><strong>Kofmad</strong><br><span style="font-size:0.8rem; color:#666;">Fiable & Rapide</span></div>\n                        </div>\n                    </div>\n                </div>\n            `,i.classList.remove("hidden")})}window.toggleStepAccordion=toggleStepAccordion,window.getAccomPreviewText=function(e){if(!e)return"";if("object"==typeof e&&!Array.isArray(e)){let t=[];for(const[n,i]of Object.entries(e)){let e="object"==typeof i&&i.text?i.text:i;t.push(e.split("(")[0].trim())}return t.join(" ‚Ä¢ ")}return"Voir les options"},window.getAccomGridHtml=function(e){if(!e)return"";let t='<div class="accom-grid">';if("object"==typeof e&&!Array.isArray(e))for(const[n,i]of Object.entries(e)){let e="premium"===n?"fa-gem":"standard"===n?"fa-hotel":"fa-campground",a="premium"===n?"Luxe":"standard"===n?"Confort":"Eco",o=i,s="",r="";"object"==typeof i&&i.id&&(o=i.text,s=`onclick="window.showLieuDetailsByID(${i.id})"`,r="clickable-card"),t+=`\n                <div class="accom-card ${n} ${r}" ${s}>\n                    <div class="accom-icon"><i class="fas ${e}"></i></div>\n                    <div class="accom-info"><span class="accom-cat">${a}</span><span class="accom-name">${o}</span></div>\n                </div>`}return t+="</div>",t},window.switchCircuitBudget=function(e,t){const n=Object.values(window.ITINERAIRES_DATA).find(t=>t.id===e);if(!n||!n.budgets||!n.budgets[t])return;document.querySelectorAll(".budget-option").forEach(e=>e.classList.remove("active"));const i=document.getElementById(`budget-btn-${t}`);i&&i.classList.add("active");const a=n.budgets[t],o=document.getElementById("budget-price-display"),s=document.getElementById("budget-desc-display"),r=document.getElementById("budget-inclusions");o&&(o.textContent=a.price),s&&(s.textContent=a.desc),r&&a.inclus&&(r.innerHTML=a.inclus.map(e=>`<li><i class="fas fa-check" style="color:var(--success);"></i> ${e}</li>`).join(""))},window.showLieuDetailsByID=function(e){const t=window.LIEUX_DATA.find(t=>t.id==e);t?openLieuModal(t):console.warn("Lieu not found for ID:",e)},window.initOutilsPage=function(){initTaxiTool(),initChecklist();const e=document.getElementById("amountInput"),t=document.getElementById("convertBtn"),n=document.getElementById("convertedResult"),i=document.getElementById("exchangeRateInput");i&&(i.value=window.exchangeRate),t&&e&&n&&t.addEventListener("click",()=>{const t=parseFloat(e.value),a=parseFloat(i?i.value:window.exchangeRate);if(!isNaN(t)&&!isNaN(a)){window.exchangeRate=a,localStorage.setItem("exchangeRate",a);const e=(t/a).toFixed(2);n.textContent=`${t.toLocaleString()} Ar ‚âà ${e} ‚Ç¨`,n.style.color="var(--text-primary)"}})};const DEFAULT_CHECKLIST_DEFS=[{id:"passeport",text:"Passeport (validit√© 6 mois)"},{id:"visa",text:"Visa (√† l'arriv√©e ou e-visa)"},{id:"billet",text:"Billets d'avion imprim√©s"},{id:"cash",text:"Euros en esp√®ces (pour le change)"},{id:"vete_leger",text:"V√™tements l√©gers (coton/lin)"},{id:"pull",text:"Un pull l√©ger (soir√©es/avion)"},{id:"chaussure",text:"Chaussures de marche confortables"},{id:"maillot",text:"Maillot de bain & Serviette"},{id:"pharmacie",text:"Trousse √† pharmacie (base + antipalu)"},{id:"moustique",text:"R√©pulsif moustique (Zone Tropiques)"},{id:"creme",text:"Cr√®me solaire (SPF 50)"},{id:"lunettes",text:"Lunettes de soleil & Chapeau"},{id:"adaptateur",text:"Adaptateur universel (optionnel)"},{id:"batterie",text:"Batterie externe (Powerbank)"}];function initChecklist(){const e=document.getElementById("checklistContainer");if(!e)return;e.className="checklist-container-2026";let t=DEFAULT_CHECKLIST_DEFS;try{const e=localStorage.getItem("checklist_definitions");e&&(t=JSON.parse(e))}catch(e){console.warn("Checklist defs load error",e)}function n(){const t=window.currentChecklistDefs.length,n=window.checklist.length,i=0===t?0:Math.round(n/t*100);let a=`\n            <div class="checklist-stats">\n                <span>${n}/${t} compl√©t√©s</span>\n                <span>${i}%</span>\n            </div>\n            <div class="checklist-progress-container">\n                <div class="checklist-progress-bar" style="width: ${i}%"></div>\n            </div>\n            <div class="checklist-items-grid">\n        `;a+=window.currentChecklistDefs.map(e=>{const t=window.checklist.includes(e.id);return`\n                <div class="checklist-item-2026 ${t?"completed":""}" onclick="toggleCheckItem('${e.id}')">\n                    <div class="custom-checkbox">\n                        <i class="fas fa-check" style="opacity: ${t?1:0}; transform: scale(${t?1:.5}); transition: all 0.2s ease;"></i>\n                    </div>\n                    <span class="checklist-text">${e.text}</span>\n                    <button class="btn-delete-item" onclick="deleteChecklistItem('${e.id}', event)" title="Supprimer">\n                        <i class="fas fa-trash-alt"></i>\n                    </button>\n                </div>\n            `}).join(""),a+="</div>",a+='\n            <div class="checklist-add-container">\n                <input type="text" id="newChecklistItemInput" class="input-add-item" placeholder="Ajouter un √©l√©ment..." onkeypress="handleChecklistInput(event)">\n                <button class="btn-add-item" onclick="addChecklistItem()"><i class="fas fa-plus"></i></button>\n            </div>\n        ',e.innerHTML=a}window.currentChecklistDefs=t,n(),window.renderChecklist=n}function getCityNameFromKey(e){return{diego:"Diego-Suarez",nosybe:"Nosy Be",majunga:"Majunga",tamatave:"Tamatave",fianar:"Fianarantsoa",tulear:"Tul√©ar"}[e]||e}function initGlobalSearch(){const e=document.getElementById("globalSearchInput"),t=document.getElementById("searchResults");if(!e||!t)return;let n;document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||(t.classList.remove("active"),t.style.display="none")}),e.addEventListener("focus",()=>{e.value.trim().length>=3&&(t.style.display="block",t.classList.add("active"))}),e.addEventListener("input",e=>{clearTimeout(n);const i=e.target.value.toLowerCase().trim();n=setTimeout(()=>{if(i.length<3)return t.classList.remove("active"),void(t.style.display="none");window.LIEUX_DATA&&(renderSearchResults(window.LIEUX_DATA.filter(e=>{const t=(e.nom||"").toLowerCase(),n=(e.ville||"").toLowerCase(),a=(e.tags||[]).join(" ").toLowerCase(),o=(e.type||"").toLowerCase();return t.includes(i)||n.includes(i)||a.includes(i)||o.includes(i)}).slice(0,20),t),t.style.display="block")},250)})}function renderSearchResults(e,t){if(0===e.length)return t.innerHTML='<div class="search-no-results">Aucun r√©sultat trouv√©</div>',void t.classList.add("active");const n=e.map(e=>`\n        <div class="search-result-item" onclick="openLieuFromSearch(${e.id})">\n            <img src="${e.image}" class="search-result-thumb" onerror="this.src='images/placeholders/default.jpg'">\n            <div class="search-result-info">\n                <h4>${e.nom}</h4>\n                <p>${e.ville} ‚Ä¢ ${e.type}</p>\n            </div>\n        </div>\n    `).join("");t.innerHTML=n,t.classList.add("active")}window.toggleCheckItem=function(e){const t=window.checklist.indexOf(e);-1===t?(window.checklist.push(e),navigator.vibrate&&navigator.vibrate(10)):window.checklist.splice(t,1),localStorage.setItem("checklist",JSON.stringify(window.checklist)),window.renderChecklist&&window.renderChecklist()},window.addChecklistItem=function(){const e=document.getElementById("newChecklistItemInput");if(!e||!e.value.trim())return;const t=e.value.trim(),n="custom_"+Date.now();window.currentChecklistDefs.push({id:n,text:t}),localStorage.setItem("checklist_definitions",JSON.stringify(window.currentChecklistDefs)),e.value="",window.renderChecklist&&window.renderChecklist()},window.deleteChecklistItem=function(e,t){if(t&&t.stopPropagation(),!confirm("Supprimer cet √©l√©ment ?"))return;window.currentChecklistDefs=window.currentChecklistDefs.filter(t=>t.id!==e),localStorage.setItem("checklist_definitions",JSON.stringify(window.currentChecklistDefs));const n=window.checklist.indexOf(e);-1!==n&&(window.checklist.splice(n,1),localStorage.setItem("checklist",JSON.stringify(window.checklist))),window.renderChecklist&&window.renderChecklist()},window.handleChecklistInput=function(e){"Enter"===e.key&&window.addChecklistItem()},window.initLanguePage=function(){const e=document.getElementById("accordionContainer");if(!e||!window.PHRASES_DATA)return;e.innerHTML="",e.innerHTML='\n    <div class="search-container-2026" style="margin-bottom: 30px;">\n        <div class="search-wrapper-2026">\n            <i class="fas fa-search search-icon-left"></i>\n            <input type="text" id="langSearch" class="search-input-2026" autocomplete="off" \n                placeholder="Rechercher une expression..." \n                oninput="filterLanguages(this.value)" \n                onfocus="filterLanguages(this.value)">\n            <div id="langSearchResults" class="search-results-2026"></div>\n        </div>\n    </div>\n    ',document.addEventListener("click",function(e){const t=document.querySelector(".search-wrapper-2026"),n=document.getElementById("langSearchResults");t&&!t.contains(e.target)&&n&&n.classList.remove("active")});const t=document.createElement("div");t.id="langGridContainer",t.className="lang-sections-wrapper",e.appendChild(t);const n={salutations:"fa-hand-wave",politesse:"fa-heart","se pr√©senter":"fa-user","se d√©placer":"fa-map-marked-alt","n√©gocier":"fa-handshake",restaurant:"fa-utensils",urgence:"fa-exclamation-triangle",nombres:"fa-calculator",temps:"fa-clock"};let i=Array.isArray(window.PHRASES_DATA)?window.PHRASES_DATA:Object.entries(window.PHRASES_DATA),a="";i.forEach(([e,t])=>{const i=n[e.toLowerCase()]||"fa-comment",o=e.charAt(0).toUpperCase()+e.slice(1);a+=`\n        <div class="accordion-v3">\n            <div class="accordion-item">\n                <button class="accordion-trigger" \n                        aria-expanded="false" \n                        onclick="window.toggleAccordionV3(this)">\n                    <div class="accordion-header-content">\n                        <div class="icon-wrapper">\n                            <i class="fas ${i}"></i>\n                        </div>\n                        <div class="accordion-text">\n                            <div class="accordion-heading">${o}</div>\n                            <div class="accordion-subtitle">${t.length} expressions</div>\n                        </div>\n                    </div>\n                    <i class="fas fa-chevron-down chevron"></i>\n                </button>\n                <div class="accordion-body" aria-hidden="true">\n                    <div class="accordion-inner">\n                        <div class="language-grid-2026">\n                            ${t.map((t,n)=>{const i=`btn-audio-${e.replace(/\s+/g,"-")}-${n}`;return`\n                                <div class="language-card-2026" onclick="playAudio('${(t.audio||"").replace(/'/g,"\\'")}', '${i}')">\n                                    <div class="language-content">\n                                        <div class="lang-fr">${t.fr||t.francais}</div>\n                                        <div class="lang-phonetic">${t.phonetic||""}</div>\n                                        <div class="lang-mg">${t.mg||t.malgache}</div>\n                                    </div>\n                                    <div id="${i}" class="btn-play-audio-2026">\n                                        <i class="fas fa-play"></i>\n                                    </div>\n                                </div>`}).join("")}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}),t.innerHTML=a,window.GasikaraAnimations&&"function"==typeof window.GasikaraAnimations.init&&window.GasikaraAnimations.init()},window.filterLanguages=function(e){const t=e.toLowerCase().trim(),n=document.getElementById("langSearchResults");if(!n)return;if(!t)return void n.classList.remove("active");let i=[];Object.entries(window.PHRASES_DATA).forEach(([e,t])=>{t.forEach((t,n)=>{i.push({...t,cat:e,idx:n})})});const a=i.filter(e=>e.fr&&e.fr.toLowerCase().includes(t)||e.mg&&e.mg.toLowerCase().includes(t));0===a.length?n.innerHTML='\n            <div class="search-result-item" style="cursor:default;">\n                <div class="search-result-info">\n                    <h4 style="color:white;">Aucun r√©sultat</h4>\n                    <p>Essayez un autre mot...</p>\n                </div>\n            </div>':n.innerHTML=a.map(e=>{const t=`search-drop-${e.idx}`;return`\n                <div class="search-result-item" onclick="playAudio('${(e.audio||"").replace(/'/g,"\\'")}', '${t}'); event.stopPropagation();">\n                    <div class="search-result-thumb" style="background:var(--laterite-2026); display:flex; align-items:center; justify-content:center;">\n                        <i class="fas fa-volume-up" style="color:white;"></i>\n                    </div>\n                    <div class="search-result-info">\n                        <h4 style="color:white;">${e.fr||e.francais}</h4>\n                        <p style="color:#ccc;">${e.mg||e.malgache} <span style="font-size:0.75em; opacity:0.6">(${e.cat})</span></p>\n                    </div>\n                    <div id="${t}" style="margin-left:auto; color:var(--laterite-2026);">\n                        <i class="fas fa-play-circle" style="font-size:1.5rem;"></i>\n                    </div>\n                </div>`}).join(""),n.classList.add("active")},window.currentAudio=null,window.currentBtnId=null,window.playAudio=function(e,t){if(!e)return void alert("Audio indisponible.");window.currentAudio&&(window.currentAudio.pause(),window.currentAudio.currentTime=0,window.currentBtnId)&&document.querySelectorAll(`[id="${window.currentBtnId}"]`).forEach(e=>{e.classList.contains("btn-play-audio-2026")?(e.classList.remove("playing"),e.innerHTML='<i class="fas fa-play"></i>'):e.innerHTML='<i class="fas fa-play-circle" style="font-size:1.5rem;"></i>'});const n=new Audio(`audio/${e}`),i=document.getElementById(t);i&&(i.classList.contains("btn-play-audio-2026")?(i.classList.add("playing"),i.innerHTML='<i class="fas fa-volume-up"></i>'):i.innerHTML='<i class="fas fa-spinner fa-spin" style="font-size:1.5rem;"></i>'),n.play().then(()=>{i&&!i.classList.contains("btn-play-audio-2026")&&(i.innerHTML='<i class="fas fa-stop-circle" style="font-size:1.5rem;"></i>')}).catch(e=>{console.error("Audio error",e),i&&(i.classList.remove("playing"),i.innerHTML='<i class="fas fa-exclamation-triangle"></i>')}),n.onended=function(){i&&(i.classList.contains("btn-play-audio-2026")?(i.classList.remove("playing"),i.innerHTML='<i class="fas fa-play"></i>'):i.innerHTML='<i class="fas fa-play-circle" style="font-size:1.5rem;"></i>'),window.currentAudio=null,window.currentBtnId=null},window.currentAudio=n,window.currentBtnId=t},window.initItinerariesPage=function(){const e=document.getElementById("itineraires-list");if(!e)return;if(!window.ITINERAIRES_DATA)return void(e.innerHTML='<p style="padding:20px; text-align:center;">Chargement des circuits...</p>');const t=Array.isArray(window.ITINERAIRES_DATA)?window.ITINERAIRES_DATA:Object.values(window.ITINERAIRES_DATA);e.innerHTML=t.map((e,t)=>{const n=e.nom||e.titre||"Circuit Inconnu",i=e.budgets&&e.budgets.standard?e.budgets.standard.price:e.budget||"Sur devis";return`\n        <article class="lieu-card" onclick="showItineraryDetails(${t})" style="cursor: pointer;">\n            <div class="lieu-image" style="height:200px; position:relative;">\n                <img src="${e.image||"images/placeholders/default.jpg"}" alt="${n}" \n                     style="width:100%; height:100%; object-fit:cover;"\n                     onerror="this.src='images/placeholders/default.jpg'">\n                <div class="lieu-badge" style="position:absolute; bottom:10px; left:10px; background:var(--laterite); color:white; padding:4px 12px; border-radius:4px; font-weight:bold;">\n                    ${e.duree}\n                </div>\n            </div>\n            <div class="lieu-content" style="padding:15px;">\n                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px;">\n                    <h3 style="margin:0; font-size:1.1rem; color:var(--text-primary); font-family:var(--font-display);">${n}</h3>\n                    <span style="background:var(--bg-secondary); padding:2px 8px; border-radius:4px; font-size:0.8rem; font-weight:600;">${i}</span>\n                </div>\n                <p style="font-size:0.9rem; color:var(--text-secondary); margin-bottom:15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">\n                    ${e.description}\n                </p>\n                <button class="btn-action-primary" style="width:100%;">Voir le d√©tail</button>\n            </div>\n        </article>\n        `}).join("")},window.generateStepPracticalInfo=function(e){const t=e.gourmandise,n=e.hebergement_options&&("string"==typeof e.hebergement_options||(Array.isArray(e.hebergement_options)?e.hebergement_options.length>0:Object.keys(e.hebergement_options).length>0)),i=e.astuce;return t||n||i?`\n    <div class="step-accordion step-accordion-premium">\n      <button class="step-accordion-header" onclick="window.toggleStepAccordion(this)" aria-expanded="true">\n        <div class="step-accordion-header-main">\n          <div class="step-accordion-icon step-accordion-icon-premium">\n            <i class="fas fa-info"></i>\n          </div>\n          <h4 class="step-accordion-title">Infos Pratiques de l'√âtape</h4>\n        </div>\n        <i class="fas fa-chevron-down step-accordion-chevron"></i>\n      </button>\n      \n      <div class="step-practical-content step-practical-content-premium">\n        ${t?`\n          <details class="sub-accordion">\n            <summary>\n              <i class="fas fa-utensils"></i>\n              <div>\n                <strong>Instant Gourmand</strong>\n                <span>O√π bien manger sans se tromper</span>\n              </div>\n            </summary>\n            <div class="sub-accordion-content">${e.gourmandise}</div>\n          </details>\n        `:""}\n        \n        ${n?`\n          <details class="sub-accordion">\n            <summary>\n              <i class="fas fa-hotel"></i>\n              <div>\n                <strong>O√π poser ses valises ?</strong>\n                <span>Nos adresses test√©es et approuv√©es</span>\n              </div>\n            </summary>\n            <div class="sub-accordion-content">\n              ${window.getAccomPreviewText?window.getAccomPreviewText(e.hebergement_options):"string"==typeof e.hebergement_options?e.hebergement_options:"Voir les options"}\n            </div>\n          </details>\n        `:""}\n        \n        ${i?`\n          <details class="sub-accordion">\n            <summary>\n              <i class="fas fa-lightbulb"></i>\n              <div>\n                <strong>Le Conseil Expert</strong>\n                <span>Le petit hack qui change tout</span>\n              </div>\n            </summary>\n            <div class="sub-accordion-content">${e.astuce}</div>\n          </details>\n        `:""}\n      </div>\n    </div>\n  `:""},window.toggleStepAccordion=function(e){const t=e.closest(".step-accordion"),n=t.classList.contains("open");t.classList.toggle("open"),e.setAttribute("aria-expanded",!n);const i=t.querySelector(".step-practical-content");i&&i.setAttribute("aria-hidden",n),navigator.vibrate&&navigator.vibrate(10)},window.getAccomPreviewText=window.getAccomPreviewText||function(e){return e?"string"==typeof e?e:e.standard||(e.premium?e.premium.text||e.premium:"")||e.eco||"":""},window.showItineraryDetails=function(e){const t=(Array.isArray(window.ITINERAIRES_DATA)?window.ITINERAIRES_DATA:Object.values(window.ITINERAIRES_DATA))[e];if(!t)return void console.error("Itinerary not found for index:",e);const n=document.getElementById("itineraires-list"),i=document.getElementById("itineraire-detail"),a=document.getElementById("itineraire-content");if(!n||!i||!a)return;const o=t.nom||t.titre||"D√©tails du Circuit",s=t.budgets&&t.budgets.standard?t.budgets.standard.price:t.budget||"Sur devis",r=t.description_full||t.description,l=t.logistique_generale||{},c=t.infos||{};let d='<div class="timeline-container">';t.etapes&&Array.isArray(t.etapes)&&(d+=t.etapes.map((e,t)=>{const n="string"==typeof e?e:e.titre||`Jour ${e.jour}`,i="string"==typeof e?"":e.description_expert||e.description||"";"object"==typeof e&&e.logistique&&e.logistique;let a="images/placeholders/default.jpg",o=null,s="Voir Lieu";if("object"==typeof e&&e.lieux_ids&&e.lieux_ids.length>0){o=e.lieux_ids[0];const t=window.LIEUX_DATA||[],n=t.find(e=>e.id==o);n?(n.image&&(a=n.image),s=n.ville||n.nom):console.warn(`Itineraire Debug: Lieu ID ${o} not found in LIEUX_DATA (${t.length} items).`)}let r=window.generateStepPracticalInfo?window.generateStepPracticalInfo(e):"";const l=o?`onclick="event.stopPropagation(); window.showLieuDetailsByID(${o})"`:"",c=o?`onclick="window.showLieuDetailsByID(${o})"`:"";let d="";return e.incontournables&&Array.isArray(e.incontournables)&&(d=`\n                    <div style="margin-top:12px;">\n                        <strong style="font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; color:var(--laterite);">√Ä ne pas manquer:</strong>\n                        <ul style="margin:5px 0 0 20px; font-size:0.9rem; color:var(--text-secondary);">\n                            ${e.incontournables.map(e=>`<li>${"string"==typeof e?e:e.label}</li>`).join("")}\n                        </ul>\n                    </div>`),`\n            <div class="timeline-step">\n                <div class="timeline-marker"></div>\n                <div class="timeline-card">\n                    \x3c!-- HEADER --\x3e\n                    <div class="timeline-header" onclick="this.parentElement.parentElement.classList.toggle('active')">\n                        <div class="timeline-day">J${e.jour||t+1}</div>\n                        <div class="timeline-title">${n}</div>\n                        \n                        \x3c!-- Thumbnail (Clickable) --\x3e\n                        <div class="timeline-thumb-container" ${l} title="Voir le lieu">\n                            <img src="${a}" class="timeline-thumb" alt="Etape" onerror="this.style.display='none'">\n                        </div>\n                        \n                        <i class="fas fa-chevron-down timeline-chevron"></i>\n                    </div>\n\n                    \x3c!-- CONTENT --\x3e\n                    <div class="timeline-content">\n                        <div class="timeline-body">\n                            <div class="timeline-body-text">\n                                <p style="margin-bottom:10px; font-style:italic;">"${e.astuce||"Profitez de cette √©tape..."}"</p>\n                                <p style="margin-bottom:10px;">${i}</p>\n                                ${d}\n                                ${r}\n                            </div>\n\n                            \x3c!-- Large Image (Clickable) --\x3e\n                            <div class="timeline-body-image-container" ${c}>\n                                <img src="${a}" class="timeline-body-image" alt="Visualisation Etape" onerror="this.src='images/placeholders/default.jpg'">\n                                <div class="timeline-body-image-overlay">\n                                    <i class="fas fa-map-pin"></i> ${s}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>`}).join(""),d+="</div>");const p=`\n        <div class="accordion-v3" style="margin-top:20px;">\n            <div class="accordion-item">\n                <button class="accordion-trigger" aria-expanded="false" onclick="window.toggleAccordionV3(this)">\n                    <div class="accordion-header-content">\n                        <div class="icon-wrapper"><i class="fas fa-info-circle"></i></div>\n                        <div class="accordion-text">\n                            <div class="accordion-heading">Infos Pratiques & FAQ</div>\n                            <div class="accordion-subtitle">Logistique du circuit</div>\n                        </div>\n                    </div>\n                    <i class="fas fa-chevron-down chevron"></i>\n                </button>\n                <div class="accordion-body" aria-hidden="true">\n                    <div class="accordion-inner">\n                        <ul style="list-style:none; padding:0; margin:0;">\n                            ${l.saison_ideale?`<li style="margin-bottom:10px;"><strong><i class="fas fa-sun"></i> Saison Id√©ale:</strong> ${l.saison_ideale}</li>`:""}\n                            ${l.vehicule_conseil?`<li style="margin-bottom:10px;"><strong><i class="fas fa-car-side"></i> Transport:</strong> ${l.vehicule_conseil}</li>`:""}\n                            ${l.route_etat?`<li style="margin-bottom:10px;"><strong><i class="fas fa-road"></i> √âtat de la route:</strong> ${l.route_etat}</li>`:""}\n                            ${c.securite_level?`<li style="margin-bottom:10px;"><strong><i class="fas fa-shield-alt"></i> S√©curit√©:</strong> ${c.securite_level}</li>`:""}\n                            ${c.description_fun?`<li style="margin-top:15px; font-style:italic; color:var(--laterite);">"${c.description_fun}"</li>`:""}\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;a.innerHTML=`\n        <div class="itin-header" style="margin-bottom:20px;">\n            <img src="${t.image||"images/placeholders/default.jpg"}" style="width:100%; height:250px; object-fit:cover; border-radius:12px; margin-bottom:15px; box-shadow:var(--shadow-sm);">\n            \n            <h2 style="color:var(--laterite); margin-bottom:10px; font-family:var(--font-display);">${o}</h2>\n            \n            <div style="display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:20px; font-size:0.95rem; color:var(--text-secondary);">\n                <span class="badge-pill"><i class="fas fa-clock"></i> ${t.duree}</span>\n                <span class="badge-pill"><i class="fas fa-wallet"></i> ${s}</span>\n                <span class="badge-pill"><i class="fas fa-users"></i> Familial & Aventure</span>\n            </div>\n\n            <p style="font-size:1rem; line-height:1.6; margin-bottom:25px;">${r}</p>\n\n            <div id="itinerary-dynamic-map" style="height: 400px; width: 100%; border-radius: 12px; margin-bottom: 25px; box-shadow: var(--shadow-sm); z-index: 1; border:1px solid var(--border-color);"></div>\n\n            ${p}\n        </div>\n        \n        <div class="itin-stages">\n            <h3 style="border-bottom:1px solid var(--border-color); padding-bottom:10px; margin-bottom:20px;">Itin√©raire Jour par Jour</h3>\n            ${d}\n        </div>\n        \n        <div style="margin-top:30px; text-align:center;">\n             <button class="btn-action-primary" onclick="alert('R√©servation bient√¥t disponible !')" style="padding:15px 30px; font-size:1.1rem; box-shadow:var(--shadow-md);">\n                <i class="fas fa-paper-plane"></i> Demander un Devis Gratuit\n             </button>\n        </div>\n    `,n.style.display="none",i.style.display="block",window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{window.initItineraryMap&&window.initItineraryMap(t.etapes)},100)},window.backToItineraries=function(){const e=document.getElementById("itineraires-list"),t=document.getElementById("itineraire-detail");e&&t&&(t.style.display="none",e.style.display="grid",window.scrollTo({top:0,behavior:"smooth"}))},window.initSpotsPage=function(){const e=document.getElementById("spotsContainer");if(!e)return;if(console.log("üîç INIT SPOT PAGE (STRICT MODE)..."),!window.LIEUX_DATA)return void console.warn("‚ùå LIUEX_DATA missing in initSpotsPage");const t=window.LIEUX_DATA.filter(e=>e.tags&&e.tags.includes("secret_spot"));console.log(`üïµÔ∏è Spots Page: Found ${t.length} authentic secret spots.`),0===t.length?e.innerHTML="<div style='text-align:center; padding:40px; color:var(--text-secondary);'>Aucun spot secret trouv√© (Tag missing?).</div>":e.innerHTML=t.map(e=>(e._forceDisplayType="Spot Local",createLieuCard(e,"spot"))).join(""),window.GasikaraAnimations&&window.GasikaraAnimations.init()},window.filterSpotsByRegion=function(e,t){if(t){const e=t.closest(".province-filter-container");e&&(e.querySelectorAll(".nav-pill").forEach(e=>e.classList.remove("active")),t.classList.add("active"))}const n=document.getElementById("spotsContainer");if(!n)return;const i=n.querySelectorAll(".lieu-card");let a=0;i.forEach(t=>{const n=(t.dataset.ville||"").toLowerCase().trim(),i=e.toLowerCase();let o=!1;"all"===i?o=!0:(n.includes(i)&&(o=!0),"antananarivo"===i&&n.includes("tana")&&(o=!0),"mahajanga"===i&&n.includes("majunga")&&(o=!0),"toamasina"===i&&n.includes("tamatave")&&(o=!0),"toliara"===i&&(n.includes("tul√©ar")||n.includes("tulear"))&&(o=!0),"fianarantsoa"===i&&n.includes("fianar")&&(o=!0)),o?(t.style.display="block",t.style.animation=`fadeInUp 0.3s ease forwards ${.05*a}s`,a++):t.style.display="none"})},window.initCityPages=function(){renderCityData(),document.querySelectorAll(".province-section, .page-section").forEach(e=>{if(!e.id.startsWith("page-"))return;const t=e.id.replace("page-","");if(["circuit","itineraires","langue","outils","carte","spots"].some(e=>t.includes(e)))return;const n=e.querySelector(".nav-pill");n&&filterProvinceItems(t,"all",n),updatePremiumInfo(getCityNameFromKey(t),t);const i=e.querySelector(".nav-pills");if(i&&!e.querySelector(".budget-pills-container")){const e=document.createElement("div");e.className="budget-pills-container",e.style.cssText="margin-top: 16px; margin-bottom: 20px;";const n=document.createElement("div");n.className="filter-title",n.style.cssText="font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 10px; text-align: center;",n.innerHTML='<i class="fas fa-wallet"></i> Budget',e.appendChild(n);const a=document.createElement("div");a.className="nav-pills",a.style.justifyContent="center",[{level:"1",label:"‚Ç¨",desc:"(- 25k)",icon:"fa-coins"},{level:"2",label:"‚Ç¨‚Ç¨",desc:"(25k-80k)",icon:"fa-money-bill-wave"},{level:"3",label:"‚Ç¨‚Ç¨‚Ç¨",desc:"(+ 80k)",icon:"fa-gem"}].forEach(e=>{const n=document.createElement("button");n.className="budget-btn nav-pill",n.setAttribute("data-level",e.level),n.onclick=function(){toggleProvinceBudget(t,e.level,this)},n.innerHTML=`<i class="fas ${e.icon}"></i> ${e.label} <span style="font-size: 0.75rem; opacity: 0.8;">${e.desc}</span>`,a.appendChild(n)}),e.appendChild(a),i.parentNode.insertBefore(e,i.nextSibling)}})},window.renderCityData=function(){let e=window.LIEUX_DATA;e&&0!==e.length||(console.warn("‚ö†Ô∏è Data vide d√©tect√©e. Bascule sur la r√©serve globale..."),e=window.LIEUX_DATA||window.initData||[]),console.log("üî• AFFICHAGE EN COURS : "+(e?e.length:0)+" fiches."),console.log("1. Fonction Render appel√©e.");const t="grid-Mahajanga",n=document.getElementById(t);if(console.log(`2. Test Target ID '${t}' found?`,n),!window.LIEUX_DATA)return;console.log("üî• INVENTAIRE TOTAL :",window.LIEUX_DATA.length),173!==window.LIEUX_DATA.length?console.error(`üö® ALERT: DATA MISMATCH. FOUND ${window.LIEUX_DATA.length} (Expected 173)`):console.log("‚úÖ DATA INTEGRITY VERIFIED: 173 ITEMS.");const i={"Diego-Suarez":"Antsiranana",Antsiranana:"Antsiranana","Nosy Be":"NosyBe","Nosy-Be":"NosyBe",Mahajanga:"Mahajanga",Majunga:"Mahajanga",Antananarivo:"Antananarivo",Tana:"Antananarivo",Toamasina:"Toamasina",Tamatave:"Toamasina",Fianarantsoa:"Fianarantsoa",Fianar:"Fianarantsoa",Toliara:"Toliara","Tul√©ar":"Toliara",Tulear:"Toliara",Isalo:"Toliara",Ifaty:"Toliara",Anakao:"Toliara",Andasibe:"Toamasina",Mananara:"Toamasina","Sainte-Marie":"Saintemarie","Ile aux Nattes":"Saintemarie",Ankarana:"Antsiranana",Sambava:"Antsiranana",Antalaha:"Antsiranana","Voh√©mar":"Antsiranana",Ambilobe:"Antsiranana",Ampefy:"Antananarivo",Antsirabe:"Antananarivo",Anivorano:"Antsiranana",Ambanja:"Antsiranana",Ramena:"Antsiranana",Joffreville:"Antsiranana"};Object.values(i).forEach(e=>{const t=document.getElementById(`grid-${e}`);t&&(t.innerHTML="")});let a=0;window.LIEUX_DATA&&0!==window.LIEUX_DATA.length?window.LIEUX_DATA.forEach(e=>{let t=e.ville?e.ville.trim():"Inconnu",n=Object.keys(i).find(e=>e.toLowerCase()===t.toLowerCase()),o=i[t]||(n?i[n]:null);if("Diego-Suarez"===t&&(o="Antsiranana"),"Nosy Be"!==t&&"Nosy-Be"!==t||(o="NosyBe"),o){const t=document.getElementById(`grid-${o}`);if(t)if("function"==typeof window.createLieuCard){const n=window.createLieuCard(e);t.insertAdjacentHTML("beforeend",n),a++}else console.error("createLieuCard missing!",e)}}):console.warn("‚ö†Ô∏è LIEUX_DATA is empty in renderCityData!"),console.log(`‚úÖ Rendered ${a} locations across city grids.`),window.GasikaraAnimations&&"function"==typeof window.GasikaraAnimations.init&&window.GasikaraAnimations.init()},window.getCityNameFromKey=function(e){return{antananarivo:"Antananarivo",antsiranana:"Diego-Suarez",nosybe:"Nosy Be",mahajanga:"Mahajanga",toamasina:"Toamasina",fianarantsoa:"Fianarantsoa",toliara:"Toliara",saintemarie:"Sainte Marie"}[e]||e.charAt(0).toUpperCase()+e.slice(1)},window.filterProvinceItems=function(e,t,n){console.log(`üîç Filter Triggered: City=${e}, Type=${t}`);const i=document.getElementById(`page-${e}`);if(!i)return void console.error(`‚ùå Container not found: page-${e}`);i.querySelectorAll(".nav-pill").forEach(e=>{(e.getAttribute("onclick")||"").includes("filterProvinceItems")&&e.classList.remove("active")}),n&&n.classList.add("active");const a=i.querySelectorAll(".lieu-card");console.log(`found ${a.length} items to filter in ${e}`);let o=0;a.forEach(e=>{const n=(e.dataset.tags||"").toLowerCase().split(",");let a=!1;if("all"===t?a=!0:"voir"===t||"explorer"===t?a=n.includes("explorer"):"manger"===t?a=n.includes("manger"):"dodo"===t||"dormir"===t?a=n.includes("dormir"):"sortir"===t?a=n.includes("sortir"):"spot"===t&&(a=n.includes("spots")),a){const e=i.querySelector("[data-level].active");if(e){const t=e.dataset.level,i="1"===t?"budget_1":"2"===t?"budget_2":"budget_3";n.includes(i.toLowerCase())||(a=!1)}}a?(e.style.display="flex",o++):e.style.display="none"}),console.log(`‚úÖ Filter Result: ${o} visible items.`);const s=i.querySelector(".empty-state-msg");if(0===o)if(s)s.style.display="block";else{const e=document.createElement("div");e.className="empty-state-msg",e.style.gridColumn="1/-1",e.style.padding="40px",e.style.textAlign="center",e.innerHTML='<i class="fas fa-search" style="font-size:3rem; color:var(--text-secondary); margin-bottom:15px;"></i><p>Aucune p√©pite trouv√©e dans cette cat√©gorie.</p>';const t=i.querySelector(".lieux-grid");t&&t.appendChild(e)}else s&&(s.style.display="none")},window.toggleProvinceBudget=function(e,t,n){const i=document.getElementById(`page-${e}`);if(!i)return;n.classList.contains("active"),i.querySelectorAll("[data-level], .budget-btn").forEach(e=>e.classList.remove("active")),n.classList.add("active");const a=i.querySelector(".nav-pill.active");let o="all";if(a){const e=a.innerText.toLowerCase().trim();e.includes("explorer")?o="explorer":e.includes("manger")?o="manger":e.includes("dormir")?o="dormir":e.includes("sortir")?o="sortir":e.includes("spots")?o="spot":e.includes("tout")&&(o="all")}filterProvinceItems(e,o,a)},window.createLieuCard=function(e,t=""){t||(t=e.categorie||"Explorer");const n=0===e.prixNum?"gratuit":e.prixNum<1e4?"abordable":"premium",i=window.isFavorite(e.id)?"active":"",a=window.isFavorite(e.id)?'<i class="fa-solid fa-bookmark"></i>':'<i class="fa-regular fa-bookmark"></i>',o=(e.tags||[]).join(","),s=(e.tags||[]).filter(e=>!e.startsWith("budget_")).slice(0,3).map(e=>`<span class="card-tag" style="background:rgba(0,0,0,0.05); padding:2px 8px; border-radius:12px; font-size:0.7rem; color:var(--text-secondary); border:1px solid var(--border-color);">${e}</span>`).join("");let r="";const l=(e.tags||[]).find(e=>e.startsWith("budget_"));"budget_1"===l?r='<span class="budget-visual" style="background:#27ae60; color:white; padding:3px 8px; border-radius:8px; font-size:0.75rem; font-weight:700;">‚Ç¨</span>':"budget_2"===l?r='<span class="budget-visual" style="background:#f39c12; color:white; padding:3px 8px; border-radius:8px; font-size:0.75rem; font-weight:700;">‚Ç¨‚Ç¨</span>':"budget_3"===l&&(r='<span class="budget-visual" style="background:#e74c3c; color:white; padding:3px 8px; border-radius:8px; font-size:0.75rem; font-weight:700;">‚Ç¨‚Ç¨‚Ç¨</span>');const c=r?s+r:s,d="Incontournable"===e.type||e.tags&&e.tags.includes("Incontournable");let p=d?"Incontournable":e._forceDisplayType||e.type,u=d?"background: #d35400; color: white;":"background: rgba(0,0,0,0.6); color: white;",g="";return("Spot Local"===p||e.tags&&e.tags.includes("secret_spot")&&!d)&&"Spot Local"===p&&(u="background: #c0392b; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);",g='<i class="fas fa-fire-alt" style="margin-right:4px;"></i>'),`\n        <article class="lieu-card" \n                 data-id="${e.id}" \n                 data-category="${t}" \n                 data-tags="${o}" \n                 data-type="${e.type}" \n                 data-ville="${e.ville}"\n                 style="position: relative; cursor: pointer; display: flex; flex-direction: column; background: var(--bg-secondary); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-sm); transition: transform 0.2s; border: 1px solid var(--border-color);">\n            \n            \x3c!-- Badge Location (Top Left - REQUESTED) --\x3e\n            <div class="badge-location" style="position: absolute; top: 10px; left: 10px; z-index: 5; background: rgba(0,0,0,0.7); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; backdrop-filter: none;">\n                <i class="fas fa-map-marker-alt" style="margin-right:4px;"></i> ${e.ville}\n            </div>\n\n            \x3c!-- Favorite Button (Top Right) --\x3e\n            <button onclick="toggleLieuFavorite(${e.id}, this, event)" class="btn-favorite ${i}" \n                    style="position: absolute; top: 10px; right: 10px; z-index: 5; background: white; border-radius: 50%; width: 32px; height: 32px; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; cursor: pointer;">\n                ${a}\n            </button>\n            \n            \x3c!-- Image --\x3e\n            <div class="lieu-image" onclick="showLieuDetailsByID(${e.id})" style="position: relative; height: 180px; overflow: hidden;">\n                <img src="${e.image}" alt="${e.nom.replace(/"/g,"&quot;")}" loading="lazy" onerror="this.src='images/placeholder.jpg'" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s;">\n                \x3c!-- Type Badge (Bottom Left) --\x3e\n                <div class="lieu-badge" style="position: absolute; bottom: 10px; left: 10px; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; ${u}">${g}${p}</div>\n            </div>\n            \n            \x3c!-- Content --\x3e\n            <div class="lieu-content" onclick="showLieuDetailsByID(${e.id})" style="padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 8px;">\n                \n                <div class="lieu-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin: 0;">\n                    <h3 class="lieu-title" style="margin: 0; font-size: 1.1rem; color: var(--text-primary); line-height: 1.3; font-weight: 700;">${e.nom}</h3>\n                    <div class="lieu-rating" style="display: flex; align-items: center; gap: 4px; font-size: 0.85rem; color: var(--text-primary); background: var(--bg-body); padding: 2px 6px; border-radius: 6px; border: 1px solid var(--border-color);">\n                        <i class="fas fa-star" style="color: #f1c40f; font-size: 0.8rem;"></i> ${e.note}\n                    </div>\n                </div>\n\n                \x3c!-- Tags --\x3e\n                <div class="lieu-tags" style="display: flex; gap: 6px; flex-wrap: wrap;">${c}</div>\n\n                \x3c!-- Desc --\x3e\n                <p class="lieu-desc" style="margin: 0; font-size: 0.9rem; color: var(--text-secondary); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.5;">${e.description}</p>\n\n                \x3c!-- Footer --\x3e\n                <div class="lieu-footer" style="margin-top: auto; padding-top: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; border-top: 1px solid var(--border-color);">\n                   <span class="lieu-ville" style="color: var(--text-secondary); display: none;">${e.ville}</span> \x3c!-- Hidden as badge is on image --\x3e\n                   <span class="lieu-prix ${n}" style="font-weight: 600;">${e.prix}</span>\n                </div>\n            </div>\n        </article>\n    `},window.createSpotMediaCarousel=function(e,t=[]){const n=[{url:e,alt:"Image principale"},...t];console.log("üé® Carrousel images:",n),console.log("üé® Nombre d'images:",n.length);const i=n.length>1,a="carousel-"+Date.now();let o=`<div class="hero-media modern-carousel" id="${a}">`;return n.forEach((e,t)=>{o+=`\n            <img src="${e.url}" \n                 alt="${e.alt||""}" \n                 class="hero-image ${0===t?"active":""}" \n                 data-index="${t}"\n                 onerror="this.onerror=null; this.src='images/placeholder.jpg';">`}),i&&(o+=`\n            <button type="button" \n                    class="hero-nav hero-nav-left" \n                    onclick="window.carouselPrev('${a}')"\n                    aria-label="Image pr√©c√©dente">\n                ‚Äπ\n            </button>`),i&&(o+=`\n            <button type="button" \n                    class="hero-nav hero-nav-right" \n                    onclick="window.carouselNext('${a}')"\n                    aria-label="Image suivante">\n                ‚Ä∫\n            </button>`),i&&(o+='<div class="hero-dots">',n.forEach((e,t)=>{o+=`\n                <button type="button" \n                        class="hero-dot ${0===t?"active":""}" \n                        onclick="window.carouselGoTo('${a}', ${t})"\n                        aria-label="Image ${t+1}">\n                </button>`}),o+="</div>"),o+="</div>",i?(window.carouselStates||(window.carouselStates={}),window.carouselStates[a]={currentIndex:0,totalImages:n.length,autoPlayInterval:null},setTimeout(()=>{const e=document.getElementById(a);if(e){const t=e.querySelector('.hero-image[data-index="0"]');t&&(console.log("üéØ Forcing first image visible"),t.classList.add("active"),t.style.opacity="1",t.style.transform="scale(1)"),window.initCarouselFeatures(a)}},100)):setTimeout(()=>{const e=document.getElementById(a);if(e){const t=e.querySelector(".hero-image");t&&(console.log("üéØ Forcing single image visible"),t.classList.add("active"),t.style.opacity="1",t.style.transform="scale(1)")}},50),o},window.carouselPrev=function(e){const t=window.carouselStates[e];if(!t)return;const n=(t.currentIndex-1+t.totalImages)%t.totalImages;window.carouselGoTo(e,n)},window.carouselNext=function(e){const t=window.carouselStates[e];if(!t)return;const n=(t.currentIndex+1)%t.totalImages;window.carouselGoTo(e,n)},window.carouselGoTo=function(e,t){const n=document.getElementById(e);if(!n)return;const i=window.carouselStates[e];if(!i)return;i.currentIndex=t,n.querySelectorAll(".hero-image").forEach(e=>e.classList.remove("active"));const a=n.querySelector(`.hero-image[data-index="${t}"]`);a&&a.classList.add("active"),n.querySelectorAll(".hero-dot").forEach((e,n)=>{n===t?e.classList.add("active"):e.classList.remove("active")})},window.initCarouselFeatures=function(e){const t=document.getElementById(e);if(!t)return;const n=window.carouselStates[e];if(!n)return;const i=()=>{a(),n.autoPlayInterval=setInterval(()=>{window.carouselNext(e)},5e3)},a=()=>{n.autoPlayInterval&&(clearInterval(n.autoPlayInterval),n.autoPlayInterval=null)};t.addEventListener("mouseenter",a),t.addEventListener("mouseleave",i);let o=0,s=0;t.addEventListener("touchstart",e=>{o=e.changedTouches[0].screenX},{passive:!0}),t.addEventListener("touchend",t=>{s=t.changedTouches[0].screenX;const n=o-s;Math.abs(n)>50&&(n>0?window.carouselNext(e):window.carouselPrev(e))},{passive:!0});const r=n=>{const i=t.closest(".modal-overlay");i&&i.classList.contains("active")&&("ArrowLeft"===n.key?(n.preventDefault(),window.carouselPrev(e)):"ArrowRight"===n.key&&(n.preventDefault(),window.carouselNext(e)))};document.addEventListener("keydown",r);const l=t.closest(".modal-overlay");if(l){const e=new MutationObserver(t=>{t.forEach(t=>{"attributes"===t.type&&"class"===t.attributeName&&(l.classList.contains("active")||(a(),document.removeEventListener("keydown",r),e.disconnect()))})});e.observe(l,{attributes:!0})}i()},window.openLieuModal=function(e){if(!e)return;console.log("Opening Modal for:",e.nom,e);const t=document.getElementById("lieu-modal-overlay");t&&t.remove();const n=window.isFavorite(e.id),i=n?'<i class="fa-solid fa-bookmark"></i>':'<i class="fa-regular fa-bookmark"></i>',a=n?"active":"",o=["Explorer","Manger","Dormir","Sortir","Spots"];let s=e.type||"G√©n√©ral";e.tags&&e.tags.length&&(s=e.tags.find(e=>o.includes(e))||e.tags[0]),(e.galerie_photos||[]).length;const r=e.actions_principales||{},l=e.infos_pratiques||{},c=e.avis||null,d=e.carte_interactive||null,p=e.prix?e.prix:0===e.prixNum?"Gratuit":e.budgetNum?"Sur devis":"Variable",u=e.note?`${e.note}/5`:"-",g=e.duree||"Variable",m=e.ville||"Madagascar",v=e.siteWeb&&""!==e.siteWeb.trim();let f=`\n    <div id="lieu-modal-overlay" class="modal-overlay active" style="z-index: 10001;" onclick="if(event.target.id === 'lieu-modal-overlay') window.closeLieuModal();">\n        <div class="modal-content fade-in-up" style="position:relative; max-height: 90vh; overflow-y: auto; background: var(--bg-body); border-radius: 16px;">\n            \n             <button class="btn-close-modal-overlay" id="modal-close-btn" onclick="window.closeLieuModal()"\n                style="position: absolute; top: 15px; right: 15px; z-index: 100000; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-primary); pointer-events: auto;">\n                <i class="fas fa-times" style="font-size: 1.2rem;"></i>\n            </button>\n\n            \x3c!-- 1. CARROUSEL D'IMAGES (Moderne) --\x3e\n            ${window.createSpotMediaCarousel(e.image,e.galerie_photos||[])}\n\n            <div style="padding: 0 20px;">\n                <div class="modal-title-block" style="padding: 10px 0 0; position: relative;">\n                    <h2 class="modal-main-title" style="font-size: 1.6rem; line-height: 1.2; margin-bottom: 8px; font-weight: 800; font-family: var(--font-display); color: var(--text-primary); padding-right: 40px;">${e.nom}</h2>\n                    <span class="modal-category-badge" style="background: var(--laterite); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">${e.ville||s}</span>\n                     \n                     \x3c!-- Fav Button (Moved to float nicely if needed, or stick to absolute) --\x3e\n                     \x3c!-- Kept absolute for consistency but updated style --\x3e\n                </div>\n\n                \x3c!-- 3. INFO GRID --\x3e\n                <div class="modal-info-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 25px 0; text-align: center; border-bottom: 1px solid var(--border-color);">\n                    <div class="modal-info-box">\n                        <div style="color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Ville</div>\n                        <div style="font-weight:700; font-size:0.9rem; margin-top: 4px;">${m}</div>\n                    </div>\n                    <div class="modal-info-box">\n                         <div style="color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Prix</div>\n                        <div style="font-weight:700; font-size:0.9rem; margin-top: 4px;">${p}</div>\n                    </div>\n                    <div class="modal-info-box">\n                         <div style="color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Note</div>\n                        <div style="font-weight:700; font-size:0.9rem; margin-top: 4px; color: #f1c40f;">‚≠ê ${u}</div>\n                    </div>\n                    <div class="modal-info-box">\n                         <div style="color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Dur√©e</div>\n                        <div style="font-weight:700; font-size:0.9rem; margin-top: 4px;">${g}</div>\n                    </div>\n                </div>\n\n                \x3c!-- ACTIONS PRINCIPALES (New) --\x3e\n                ${r.cta_principal?`\n                <div class="modal-actions-container" style="padding: 20px 0; display: flex; gap: 12px;">\n                    <a href="${r.cta_principal.url}" class="btn-action-primary" style="flex: 2; background: var(--laterite); color: white; text-align: center; padding: 14px; border-radius: 12px; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 10px rgba(211, 84, 0, 0.3); transition: transform 0.2s;">\n                        ${r.cta_principal.icone||""} ${r.cta_principal.texte}\n                    </a>\n                    ${r.cta_secondaire?`\n                    <a href="${r.cta_secondaire.url}" target="_blank" class="btn-action-secondary" style="flex: 1; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); text-align: center; padding: 12px; border-radius: 12px; font-weight: 600; text-decoration: none; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">\n                        <i class="fab fa-whatsapp" style="color:#25D366;"></i>\n                    </a>`:""}\n                </div>`:""}\n\n                \x3c!-- DESCRIPTION --\x3e\n                ${(()=>{if(e.has_expandable_description&&e.description_summary){const t={summary:e.description_summary,hasMore:!0};return t.hasMore?`\n                                <div class="modal-description-text" style="font-size: 1rem; line-height: 1.7; color: var(--text-primary); margin-bottom: 25px;">\n                                    <div id="description-short" style="display: block;">\n                                        ${t.summary}\n                                    </div>\n                                    <div id="description-full" style="display: none;">\n                                        ${e.description}\n                                    </div>\n                                    <button onclick="window.toggleDescription()" \n                                            id="toggle-description-btn"\n                                            style="background: none; border: none; color: var(--laterite); font-weight: 600; cursor: pointer; padding: 8px 0; margin-top: 4px; font-size: 0.95rem; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;">\n                                        <span id="toggle-text">Lire plus</span>\n                                        <i id="toggle-icon" class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>\n                                    </button>\n                                </div>\n                            `:`\n                                <div class="modal-description-text" style="font-size: 1rem; line-height: 1.7; color: var(--text-primary); margin-bottom: 25px;">\n                                    ${e.description}\n                                </div>\n                            `}return`\n                            <div class="modal-description-text" style="font-size: 1rem; line-height: 1.7; color: var(--text-primary); margin-bottom: 25px;">\n                                ${e.description}\n                            </div>\n                        `})()}\n\n                 \x3c!-- CONSEIL DU LOCAL --\x3e\n                ${e.conseil?`\n                <div class="modal-conseil-block" style="margin-bottom: 25px; background: rgba(241, 196, 15, 0.1); color: #856404; padding: 16px; border-radius: 12px; border-left: 4px solid #f1c40f;">\n                    <div style="font-weight: 700; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; color: #d35400;"><i class="fas fa-lightbulb"></i> Conseil du Local</div>\n                    <p style="margin: 0; font-size: 0.95rem; line-height: 1.5;">${e.conseil}</p>\n                </div>`:""}\n\n                \x3c!-- INFOS PRATIQUES - ACCORD√âON 2026 --\x3e\n                ${l.horaires||l.meilleure_periode||l.a_prevoir?`\n                    <div class="accordion-v3" style="margin-bottom: 25px;">\n                        <div class="accordion-item">\n                            <button class="accordion-trigger" \n                                    aria-expanded="false" \n                                    onclick="window.toggleAccordionV3(this)">\n                                <div class="accordion-header-content">\n                                    <div class="icon-wrapper">\n                                        <i class="fas fa-info-circle"></i>\n                                    </div>\n                                    <div class="accordion-text">\n                                        <div class="accordion-heading">Infos Pratiques</div>\n                                        <div class="accordion-subtitle">Horaires, conseils & √©quipement</div>\n                                    </div>\n                                </div>\n                                <i class="fas fa-chevron-down chevron"></i>\n                            </button>\n                            <div class="accordion-body" aria-hidden="true">\n                                <div class="accordion-inner">\n                                    ${l.horaires?`\n                                        <div style="margin-bottom: 18px;">\n                                            <strong style="color: var(--laterite);"><i class="far fa-clock"></i> Horaires</strong>\n                                            <div style="margin-top: 6px;">\n                                                ${l.horaires.lundi_vendredi?`<div>${l.horaires.lundi_vendredi}</div>`:""}\n                                                ${l.horaires.weekend?`<div>${l.horaires.weekend}</div>`:""}\n                                                ${l.horaires.note?`<div style="font-style: italic; margin-top: 4px; color: var(--laterite);">${l.horaires.note}</div>`:""}\n                                            </div>\n                                        </div>\n                                    `:""}\n                                    \n                                    ${l.meilleure_periode?`\n                                        <div style="margin-bottom: 18px;">\n                                            <strong style="color: var(--laterite);"><i class="fas fa-sun"></i> Meilleure P√©riode</strong>\n                                            <div style="margin-top: 6px;">\n                                                ${l.meilleure_periode.saison_ideale?`<div>‚úÖ ${l.meilleure_periode.saison_ideale}</div>`:""}\n                                                ${l.meilleure_periode.eviter||l.meilleure_periode.a_eviter?`<div style="margin-top: 4px;">‚ö†Ô∏è ${l.meilleure_periode.eviter||l.meilleure_periode.a_eviter}</div>`:""}\n                                            </div>\n                                        </div>\n                                    `:""}\n                                    \n                                    ${l.a_prevoir?`\n                                        <div>\n                                            <strong style="color: var(--laterite);"><i class="fas fa-backpack"></i> √Ä Pr√©voir</strong>\n                                            <div style="margin-top: 6px;">\n                                                ${Array.isArray(l.a_prevoir.equipement)?l.a_prevoir.equipement.map(e=>`<div>‚Ä¢ ${e}</div>`).join(""):l.a_prevoir.equipement}\n                                                ${l.a_prevoir.conseils?`<div style="margin-top: 8px; font-style: italic; color: var(--laterite);">üí° ${l.a_prevoir.conseils}</div>`:""}\n                                            </div>\n                                        </div>\n                                    `:""}\n\n                                    ${e.humour_grok?`\n                                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(220, 38, 38, 0.2);">\n                                        <div style="display: flex; gap: 15px; align-items: flex-start;">\n                                            <div style="width: 36px; height: 36px; background: rgba(220, 38, 38, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--laterite); flex-shrink: 0;"><i class="fas fa-laugh-wink"></i></div>\n                                            <div style="flex: 1;">\n                                                <strong style="font-size: 0.95rem; display: block; margin-bottom: 6px; color: var(--text-primary);">L'Avis Sans Filtre</strong>\n                                                <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; font-style: italic;">\n                                                    "${e.humour_grok}"\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>`:""}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `:""}\n\n                \x3c!-- CARTE INTERACTIVE (Embedded) --\x3e\n                ${d?'\n                <div style="margin-bottom: 25px;">\n                    <h3 style="font-size: 1.1rem; margin-bottom: 12px; font-family: var(--font-display); color: var(--text-primary);">Localisation</h3>\n                    <div id="modal-map-container" style="height: 250px; border-radius: 12px; overflow: hidden; background: #eee; border: 1px solid var(--border-color);"></div>\n                </div>':""}\n\n                \x3c!-- AVIS --\x3e\n                ${c?`\n                <div class="modal-reviews" style="margin-bottom: 25px;">\n                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; font-family: var(--font-display);">\n                        Avis Voyageurs\n                        <span style="font-size: 0.85rem; color: var(--text-secondary); font-family: var(--font-body); font-weight: 400;">(${c.nombre_avis} avis)</span>\n                    </h3>\n                    \n                    <div style="margin-bottom: 20px; background: var(--bg-secondary); padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 20px;">\n                        <div style="text-align: center;">\n                             <div style="font-size: 2.5rem; font-weight: 800; color: var(--laterite); line-height: 1;">${c.note_globale}</div>\n                             <div style="color: #f1c40f; font-size: 0.8rem; margin-top: 5px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>\n                        </div>\n                        <div style="flex: 1; border-left: 1px solid var(--border-color); padding-left: 20px;">\n                            ${Object.entries(c.detail_notes||{}).slice(0,3).map(([e,t])=>`\n                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.85rem;">\n                                    <span style="text-transform: capitalize; color: var(--text-secondary);">${e.replace(/_/g," ")}</span>\n                                    <span style="font-weight: 600;">${t}</span>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n\n                    ${(c.avis_recents||[]).slice(0,2).map(e=>`\n                    <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);">\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">\n                            <strong style="font-size: 0.95rem;">${e.auteur}</strong>\n                            <span style="font-size: 0.8rem; color: var(--text-secondary);">${e.date}</span>\n                        </div>\n                        <div style="color: #f1c40f; font-size: 0.8rem; margin-bottom: 8px;">${"‚≠ê".repeat(Math.round(e.note))}</div>\n                        <p style="font-size: 0.9rem; font-style: italic; color: var(--text-primary); line-height: 1.5;">"${e.commentaire}"</p>\n                    </div>\n                    `).join("")}\n                </div>`:""}\n\n                 \x3c!-- STANDARD FOOTER ACTIONS (FIXED & SIMPLIFIED) --\x3e\n                <div class="modal-footer-actions" style="padding: 20px 0; display: flex; flex-direction: column; gap: 12px; border-top: 1px solid var(--border-color);">\n                    \x3c!-- 1. MAP ACTION: ALWAYS Internal Application Map --\x3e\n                    <a href="/carte?lieu=${e.id}" onclick="window.locateOnMap(${e.id}); return false;" \n                       class="btn-action-2026 btn-action-2026-map" \n                       style="width: 100%; padding: 16px; background: white; color: var(--text-primary); border: 2px solid var(--laterite); border-radius: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-decoration: none;">\n                        <i class="fas fa-map-marked-alt" style="color: var(--laterite); font-size: 1.2rem;"></i> Voir sur la carte de l'app\n                    </a>\n                    \n                    \x3c!-- 2. WEBSITE ACTION: Display if siteWeb exists --\x3e\n                    ${v?`\n                    <a href="${e.siteWeb}" target="_blank" class="btn-action-2026 btn-action-2026-web" \n                       style="width: 100%; padding: 16px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 12px; font-weight: 600; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;">\n                        <i class="fas fa-globe"></i> Visiter le site web\n                    </a>`:""}\n                </div>\n\n                <div style="height: 50px;"></div>\n            </div>\n            \n             \x3c!-- Floating Fav (Fixed Position inside modal content) --\x3e\n            <button onclick="toggleLieuFavorite(${e.id}, this, event)" class="btn-favorite-modal ${a}" \n                   style="position:absolute; top: 15px; left: 15px; background:white; color:var(--laterite); width:40px; height:40px; border-radius:50%; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.2); font-size: 1.1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; z-index:100;">\n               ${i}\n           </button>\n\n        </div>\n    </div>`;document.body.insertAdjacentHTML("beforeend",f),document.body.style.overflow="hidden",d&&"undefined"!=typeof L&&setTimeout(()=>{if(document.getElementById("modal-map-container")){const t=L.map("modal-map-container").setView([d.latitude||e.lat,d.longitude||e.lng],d.zoom_defaut||13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OSM"}).addTo(t),L.marker([d.latitude||e.lat,d.longitude||e.lng]).addTo(t).bindPopup(e.nom).openPopup(),t.scrollWheelZoom.disable()}},600);const y=document.getElementById("lieu-modal-overlay");y&&window.GasikaraAnimations&&window.GasikaraAnimations.openModal(y)},window.closeLieuModal=function(){const e=document.getElementById("lieu-modal-overlay");e?window.GasikaraAnimations?window.GasikaraAnimations.closeModal(e,()=>{e.remove(),document.body.style.overflow=""}):(e.classList.remove("active"),setTimeout(()=>{e.remove(),document.body.style.overflow=""},300)):document.body.style.overflow=""},window.locateOnMap=async function(e){window.closeLieuModal(),await window.navigateToPage("carte"),setTimeout(()=>{window.openMapMarker&&window.openMapMarker(e)},500)},window.addToItineraryTemp=function(e){alert("Fonctionnalit√© 'Ajouter au circuit' bient√¥t disponible !")},window.toggleAccordionV3=function(e){const t=e.nextElementSibling,n=(e.querySelector(".chevron"),"true"===e.getAttribute("aria-expanded"));e.setAttribute("aria-expanded",!n),t.setAttribute("aria-hidden",n),t.style.maxHeight=n?"0":t.scrollHeight+40+"px",navigator.vibrate&&navigator.vibrate(10)},document.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(e){!e.target.classList.contains("accordion-trigger")||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.toggleAccordionV3(e.target))})}),window.createDescriptionSummary=function(e,t=400){if(!e||e.length<=t)return{summary:e,hasMore:!1};let n=e.substring(0,t).lastIndexOf(".");return-1===n&&(n=e.substring(0,t).lastIndexOf(" ")),{summary:e.substring(0,n+1).trim(),hasMore:!0}},window.toggleDescription=function(){const e=document.getElementById("description-short"),t=document.getElementById("description-full"),n=document.getElementById("toggle-text"),i=document.getElementById("toggle-icon");e&&t&&("none"===e.style.display?(e.style.display="block",t.style.display="none",n.textContent="Lire plus",i.className="fas fa-chevron-down"):(e.style.display="none",t.style.display="block",n.textContent="Lire moins",i.className="fas fa-chevron-up"))},window.toggleAccordion=function(e){const t=e.nextElementSibling,n=e.querySelector(".accordion-chevron");t.style.maxHeight&&"0px"!==t.style.maxHeight?(t.style.maxHeight="0",t.style.padding="0 20px",n&&(n.style.transform="rotate(0deg)"),e.style.background="linear-gradient(135deg, rgba(220, 38, 38, 0.05), rgba(220, 38, 38, 0.02))"):(t.style.maxHeight=t.scrollHeight+40+"px",t.style.padding="20px",n&&(n.style.transform="rotate(180deg)"),e.style.background="linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05))")},window.updatePremiumInfo=function(e,t){const n=document.getElementById(`premium-container-${t}`);if(!n)return;const i=(window.ZONES_DATA||{})[e];if(!i)return void(n.innerHTML="");let a="";if(i.logistique){const{route_etat:t,transport_conseil:n}=i.logistique;a+=`\n    < div class="logistique-container" >\n                 <div class="logistique-header" onclick="this.nextElementSibling.classList.toggle('active')">\n                    <h3><i class="fas fa-truck-monster"></i> Infos Route (${e})</h3>\n                    <i class="fas fa-chevron-down"></i>\n                </div>\n                <div class="logistique-content">\n                    <div class="logistique-item"><div>Route:</div><div>${t}</div></div>\n                    <div class="logistique-item"><div>Transport:</div><div>${n}</div></div>\n                </div>\n            </div > `}n.innerHTML=a},window.initFilters=function(){},window.getActiveFilters=function(){const e={provinces:[],types:[],prix:[],favorites:!1};document.querySelectorAll('.filter-checkbox[id^="filter-"]:checked').forEach(t=>{const n=t.id.replace("filter-","");["antananarivo","antsiranana","mahajanga","toamasina","toliara","fianarantsoa"].includes(n)?e.provinces.push(n):["explorer","manger","dodo","sortir","spot"].includes(n)&&e.types.push(n)});const t=document.getElementById("filter-favorites");return t&&t.checked&&(e.favorites=!0),e},window.matchesFilters=function(e,t){if(!e)return!1;if(t.favorites&&!window.isFavorite(e.id))return!1;if(t.provinces&&t.provinces.length>0){const n=(e.ville||"").toLowerCase(),i={"diego-suarez":"antsiranana",antsiranana:"antsiranana","nosy be":"antsiranana","nosy-be":"antsiranana",antananarivo:"antananarivo",tana:"antananarivo",mahajanga:"mahajanga",majunga:"mahajanga",toamasina:"toamasina",tamatave:"toamasina",toliara:"toliara","tul√©ar":"toliara",fianarantsoa:"fianarantsoa"}[n]||n;if(!t.provinces.includes(i))return!1}if(t.types&&t.types.length>0){const n=(e.categorie||"").toLowerCase(),i={dodo:"dormir"};if(!t.types.some(e=>{let t=e.toLowerCase();return i[t]&&(t=i[t]),n===t}))return!1}return!0},window.openLieuFromSearch=function(e){const t=window.LIEUX_DATA.find(t=>t.id===e);t&&showLieuModalDirectly(t),document.getElementById("searchResults").classList.remove("active"),document.getElementById("globalSearchInput").value=""},window.showLieuModalDirectly=function(e){e&&window.openLieuModal(e)},document.addEventListener("DOMContentLoaded",async()=>{console.log("üöÄ PWA BOOTSTRAP: Starting Optimized Application..."),initNavigation(),await window.initData(),console.log("‚úÖ Data Loaded."),initTheme(),initGlobalSearch(),"function"==typeof registerServiceWorker&&("window.requestIdleCallback"in window?requestIdleCallback(()=>registerServiceWorker()):setTimeout(registerServiceWorker,1e3)),setTimeout(()=>{"function"==typeof initInstallPrompt&&initInstallPrompt(),"function"==typeof initModal&&initModal(),"function"==typeof initGeolocation&&initGeolocation()},500),document.querySelectorAll(".filter-chip-map").forEach(e=>{e.addEventListener("click",t=>{e.parentElement.querySelectorAll(".filter-chip-map").forEach(e=>e.classList.remove("active")),e.classList.add("active")})}),document.querySelectorAll(".nav-pill").forEach(e=>{e.addEventListener("click",function(e){this.parentElement.querySelectorAll(".nav-pill").forEach(e=>e.classList.remove("active")),this.classList.add("active")})}),console.log("üöÄ Application Ready (Lazy Mode).")}),window.initItineraryMap=function(e){if(!document.getElementById("itinerary-dynamic-map"))return;window.itinMap&&(window.itinMap.remove(),window.itinMap=null);const t=L.map("itinerary-dynamic-map",{scrollWheelZoom:!1}).setView([-18.8792,47.5079],6);window.itinMap=t,L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap & CARTO",subdomains:"abcd",maxZoom:20}).addTo(t);const n=[];if(e&&Array.isArray(e)&&e.forEach((e,i)=>{if(e.lieux_ids&&e.lieux_ids.length>0){const a=e.lieux_ids[0],o=window.LIEUX_DATA?window.LIEUX_DATA.find(e=>e.id==a):null;if(o&&o.lat&&o.lng){const a=[o.lat,o.lng];n.push(a);const s=L.divIcon({className:"itin-marker",html:`<div style="background:var(--laterite); color:white; width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem; border:2px solid white; box-shadow:0 3px 6px rgba(0,0,0,0.3); z-index:100;">${i+1}</div>`,iconSize:[28,28],iconAnchor:[14,14],popupAnchor:[0,-14]});L.marker(a,{icon:s}).bindPopup(`\n                            <div style="font-family:var(--font-body); text-align:center;">\n                                <strong style="color:var(--laterite);">Jour ${e.jour||i+1}</strong><br>\n                                ${o.nom}\n                            </div>\n                        `).addTo(t)}}}),n.length>1){const e=L.polyline(n,{color:"#b03030",weight:4,opacity:.8,lineJoin:"round",dashArray:"10, 10"}).addTo(t);t.fitBounds(e.getBounds(),{padding:[50,50]})}else 1===n.length&&t.setView(n[0],10)},console.log("‚úÖ APP.JS FULLY PARSED");
//# sourceMappingURL=app.min.js.map