{"version":3,"names":["console","log","window","currentTheme","exchangeRate","favorites","checklist","initData","Promise","resolve","LIEUX_DATA","ITINERAIRES_DATA","PHRASES_DATA","CHECKLIST_ITEMS","id","text","localStorage","getItem","parseFloat","JSON","parse","e","warn","MapModule","init","navigator","addEventListener","serviceWorker","register","then","reg","scope","setInterval","update","catch","err","error","initTheme","toggleTheme","html","document","documentElement","themeToggle","getElementById","newTheme","getAttribute","setAttribute","setItem","innerHTML","savedTheme","isFavorite","includes","toggleLieuFavorite","btn","event","stopPropagation","index","indexOf","push","classList","add","vibrate","splice","remove","stringify","navigateToHomeDestinations","querySelectorAll","forEach","el","style","display","vid","querySelector","pause","home","setTimeout","target","scrollIntoView","behavior","block","b","homeBtn","initNavigation","navBtns","shortcuts","page","dataset","navigateToPage","card","goto","previousPageContext","async","pageName","targetId","startsWith","currentSection","currentId","section","video","newSection","scrollTo","top","leafletMap","invalidateSize","btnContainer","btnLabel","niceName","innerText","GasikaraAnimations","refresh","rawName","replace","activeBtn","_modulesLoaded","map","import","initMap","some","k","cities","initCityPages","itineraires","initItinerariesPage","spots","initSpotsPage","outils","initOutilsPage","langue","initLanguePage","navigateBack","rawPage","showSection","container","circuits","Object","values","slugMap","c","i","image","nom","duree","budget","description","join","showItineraryDetail","list","detail","content","mainBanner","circuit","find","infos","securite_level","logistique_generale","saison_ideale","keys","length","vehicule_conseil","route_etat","description_fun","budgets","standard","price","desc","inclus","item","etapes","step","logicBarHtml","logistique","depart","duree_totale_transport","arrivee","transportHtml","transports_details","t","icon","type","toLowerCase","accomHtml","hebergement_options","getAccomGridHtml","jour","titre","description_expert","incontournables","label","getAccomPreviewText","gourmandise","astuce","attachAccordionListeners","backToItineraries","appAccordionObservers","WeakMap","forceRecalculateHeight","outer","inner","contains","offsetHeight","newHeight","scrollHeight","maxHeight","hasListener","toggleStepAccordion","details","parentAccordion","closest","requestAnimationFrame","header","tagName","parentElement","toggle","isOpen","has","observer","ResizeObserver","entries","entry","height","observe","set","innerWidth","open","iterations","mobileInterval","clearInterval","get","disconnect","delete","initTaxiTool","btnCalcTaxi","selFrom","selTo","resultDiv","opts","value","remarks","randomRemark","Math","floor","random","dist","hours","toLocaleString","options","Array","isArray","names","v","n","split","trim","key","val","name","clickAttr","classExtra","switchCircuitBudget","circuitId","level","data","priceDisplay","descDisplay","incDisplay","textContent","showLieuDetailsByID","lieu","l","openLieuModal","initChecklist","amountInput","convertBtn","rateInput","ariary","rate","isNaN","euros","toFixed","color","DEFAULT_CHECKLIST_DEFS","listContainer","className","currentDefs","savedDefs","renderChecklist","total","currentChecklistDefs","checkedCount","percent","round","isChecked","getCityNameFromKey","diego","nosybe","majunga","tamatave","fianar","tulear","initGlobalSearch","searchInput","resultsContainer","debounceTimer","clearTimeout","query","renderSearchResults","filter","city","ville","tags","slice","results","toggleCheckItem","idx","addChecklistItem","input","Date","now","deleteChecklistItem","confirm","handleChecklistInput","wrapper","dropdown","gridContainer","createElement","appendChild","categoryIcons","salutations","politesse","restaurant","urgence","nombres","temps","dataEntries","cat","phrases","catTitle","charAt","toUpperCase","p","uniqueId","audio","fr","francais","phonetic","mg","malgache","filterLanguages","term","allPhrases","matches","currentAudio","currentBtnId","playAudio","filename","btnId","alert","currentTime","Audio","clickedBtn","play","onended","itineraries","itin","title","generateStepPracticalInfo","day","hasFood","hasAccom","hasAdvice","premium","eco","showItineraryDetails","descFull","description_full","stagesHtml","dayIdx","stepTitle","stepDesc","stepImage","firstLieuId","locationName","lieux_ids","allLieux","detailsHtml","imageClickAction","cardClickAction","incHtml","faqHtml","initItineraryMap","spotsContainer","_forceDisplayType","createLieuCard","filterSpotsByRegion","region","cards","count","itemVille","regionKey","show","animation","renderCityData","cityKey","btnAll","filterProvinceItems","updatePremiumInfo","navPills","budgetContainer","cssText","pills","justifyContent","onclick","toggleProvinceBudget","this","parentNode","insertBefore","nextSibling","checkId","containerCheck","citiesStub","Antsiranana","Mahajanga","Majunga","Antananarivo","Tana","Toamasina","Tamatave","Fianarantsoa","Fianar","Toliara","Tulear","Isalo","Ifaty","Anakao","Andasibe","Mananara","Ankarana","Sambava","Antalaha","Ambilobe","Ampefy","Antsirabe","Anivorano","Ambanja","Ramena","Joffreville","stubKey","gridId","grid","insertAdjacentHTML","antananarivo","antsiranana","mahajanga","toamasina","fianarantsoa","toliara","saintemarie","filterType","items","isMatch","activeBudgetBtn","budgetLevel","targetTag","emptyMsg","msg","gridColumn","padding","textAlign","activeCatBtn","txt","category","categorie","prixClass","prixNum","activeClass","tagsString","displayTags","budgetBadge","budgetTag","displayTagsWithBudget","isMustSee","badgeText","badgeStyle","badgeIcon","note","prix","createSpotMediaCarousel","heroImage","gallery","allImages","url","alt","hasCarousel","carouselId","img","_","carouselStates","currentIndex","totalImages","autoPlayInterval","carousel","firstImage","opacity","transform","initCarouselFeatures","singleImage","carouselPrev","state","newIndex","carouselGoTo","carouselNext","currentImage","dot","startAutoPlay","stopAutoPlay","touchStartX","touchEndX","changedTouches","screenX","passive","diff","abs","handleKeyboard","modal","preventDefault","MutationObserver","mutations","mutation","attributeName","removeEventListener","attributes","existing","isFav","favIcon","categoriesPrioritaires","badgeType","galerie_photos","actions","actions_principales","infos_pratiques","avis","embeddedMap","carte_interactive","budgetNum","noteDisplay","dureeDisplay","villeDisplay","hasWebsite","siteWeb","cta_principal","icone","texte","cta_secondaire","has_expandable_description","description_summary","descData","summary","hasMore","conseil","horaires","meilleure_periode","a_prevoir","lundi_vendredi","weekend","eviter","a_eviter","equipement","conseils","humour_grok","nombre_avis","note_globale","detail_notes","avis_recents","a","auteur","date","repeat","commentaire","body","overflow","L","setView","latitude","lat","longitude","lng","zoom_defaut","tileLayer","attribution","addTo","marker","bindPopup","openPopup","scrollWheelZoom","disable","openModal","closeLieuModal","closeModal","locateOnMap","openMapMarker","addToItineraryTemp","toggleAccordionV3","button","nextElementSibling","isExpanded","createDescriptionSummary","fullDescription","maxChars","cutPoint","substring","lastIndexOf","toggleDescription","shortDiv","fullDiv","toggleText","toggleIcon","toggleAccordion","chevron","background","provinceKey","zoneData","ZONES_DATA","transport_conseil","initFilters","getActiveFilters","filters","provinces","types","cb","favCb","checked","matchesFilters","lieuCity","mappedLieu","tana","normalizedLieuCat","filterKeyMap","dodo","ft","openLieuFromSearch","showLieuModalDirectly","registerServiceWorker","requestIdleCallback","initInstallPrompt","initModal","initGeolocation","sib","steps","itinMap","subdomains","maxZoom","routeCoords","lieuId","latLng","divIcon","iconSize","iconAnchor","popupAnchor","polyline","weight","lineJoin","dashArray","fitBounds","getBounds"],"sourceRoot":".","sources":["js/app.js"],"sourcesContent":["/* ============================================\r\n   APP LOGIC (RESTORED & PREMIUM)\r\n   Handles Navigation, Data Loading, UI interaction, Pages, Modals.\r\n   ============================================ */\r\n\r\nconsole.log('üöÄ APP.JS LOADED - STARTING INIT');\r\n\r\n// Global State\r\nwindow.currentTheme = 'light';\r\nwindow.exchangeRate = 4250;\r\nwindow.favorites = [];\r\nwindow.checklist = [];\r\n\r\n// ============================================\r\n// 1. INITIALIZATION & DATA\r\n// ============================================\r\n\r\nwindow.initData = function () {\r\n    return new Promise((resolve) => {\r\n        // Validation des globales\r\n        if (typeof LIEUX_DATA === 'undefined' || typeof ITINERAIRES_DATA === 'undefined') {\r\n            console.error(\"Critical Data Missing!\");\r\n            return;\r\n        }\r\n\r\n        // Globals ensure\r\n        window.LIEUX_DATA = LIEUX_DATA;\r\n        window.ITINERAIRES_DATA = ITINERAIRES_DATA;\r\n        // Phrases fallback\r\n        window.PHRASES_DATA = typeof PHRASES_DATA !== 'undefined' ? PHRASES_DATA : {};\r\n        // Checklist fallback\r\n        window.CHECKLIST_ITEMS = typeof CHECKLIST_ITEMS !== 'undefined' ? CHECKLIST_ITEMS : [\r\n            { id: 'passeport', text: 'Passeport (validit√© 6 mois)' },\r\n            { id: 'visa', text: 'Visa (√† l\\'arriv√©e ou e-visa)' },\r\n            { id: 'billet', text: 'Billets d\\'avion imprim√©s' },\r\n            { id: 'cash', text: 'Euros en esp√®ces (pour le change)' },\r\n            { id: 'vete_leger', text: 'V√™tements l√©gers (coton/lin)' },\r\n            { id: 'pull', text: 'Un pull l√©ger (soir√©es/avion)' },\r\n            { id: 'chaussure', text: 'Chaussures de marche confortables' },\r\n            { id: 'maillot', text: 'Maillot de bain & Serviette' },\r\n            { id: 'pharmacie', text: 'Trousse √† pharmacie (base + antipalu)' },\r\n            { id: 'moustique', text: 'R√©pulsif moustique (Zone Tropiques)' },\r\n            { id: 'creme', text: 'Cr√®me solaire (SPF 50)' },\r\n            { id: 'lunettes', text: 'Lunettes de soleil & Chapeau' },\r\n            { id: 'adaptateur', text: 'Adaptateur universel (optionnel)' },\r\n            { id: 'batterie', text: 'Batterie externe (Powerbank)' },\r\n            { id: 'lampe', text: 'Lampe torche / Frontale (coupures)' }\r\n        ];\r\n\r\n        // Load LocalStorage\r\n        try {\r\n            if (typeof localStorage !== 'undefined') {\r\n                window.currentTheme = localStorage.getItem('theme') || 'light';\r\n                window.exchangeRate = parseFloat(localStorage.getItem('exchangeRate')) || 4250;\r\n                window.favorites = JSON.parse(localStorage.getItem('favorites')) || [];\r\n                window.checklist = JSON.parse(localStorage.getItem('checklist')) || [];\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"LS Error\", e);\r\n        }\r\n\r\n\r\n\r\n        // Initialize Modules\r\n        if (window.MapModule) window.MapModule.init();\r\n\r\n        // === SERVICE WORKER REGISTRATION (Single Instance) ===\r\n        if ('serviceWorker' in navigator) {\r\n            window.addEventListener('load', () => {\r\n                navigator.serviceWorker.register('/sw.js')\r\n                    .then(reg => {\r\n                        console.log('‚úÖ SW registered:', reg.scope);\r\n                        // V√©rifier mises √† jour toutes les heures\r\n                        setInterval(() => reg.update(), 60 * 60 * 1000);\r\n                    })\r\n                    .catch(err => console.error('‚ùå SW registration failed:', err));\r\n            });\r\n        }\r\n\r\n        resolve();\r\n    });\r\n};\r\n\r\n/* ============================================\r\n   2. THEME & UTILS\r\n   ============================================ */\r\nwindow.initTheme = function () {\r\n    console.log(\"üåì Theme initialized via Native Event Handlers.\");\r\n    // Initialization handled by styles-premium.css variables and inline onclick\r\n};\r\n\r\nwindow.toggleTheme = function () {\r\n    const html = document.documentElement;\r\n    const themeToggle = document.getElementById('themeToggle');\r\n\r\n    // R√©cup√©rer le th√®me actuel\r\n    const currentTheme = html.getAttribute('data-theme') || 'light';\r\n\r\n    // Toggle entre light et dark\r\n    const newTheme = currentTheme === 'light' ? 'dark' : 'light';\r\n\r\n    // Appliquer le nouveau th√®me\r\n    html.setAttribute('data-theme', newTheme);\r\n\r\n    // Sauvegarder dans localStorage\r\n    localStorage.setItem('theme', newTheme);\r\n\r\n    // Mettre √† jour l'ic√¥ne du bouton (optionnel)\r\n    if (themeToggle) {\r\n        themeToggle.innerHTML = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';\r\n        themeToggle.setAttribute('aria-label', `Activer le mode ${newTheme === 'light' ? 'nuit' : 'jour'}`);\r\n    }\r\n\r\n    console.log('Theme toggled to:', newTheme);\r\n};\r\n\r\n// Appliquer le th√®me sauvegard√© au chargement\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    const savedTheme = localStorage.getItem('theme') || 'light';\r\n    document.documentElement.setAttribute('data-theme', savedTheme);\r\n\r\n    const themeToggle = document.getElementById('themeToggle');\r\n    if (themeToggle) {\r\n        themeToggle.innerHTML = savedTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';\r\n    }\r\n});\r\n\r\nwindow.isFavorite = function (id) {\r\n    return window.favorites.includes(id);\r\n};\r\n\r\nwindow.toggleLieuFavorite = function (id, btn, event) {\r\n    if (event) event.stopPropagation();\r\n    const index = window.favorites.indexOf(id);\r\n    if (index === -1) {\r\n        window.favorites.push(id);\r\n        if (btn) btn.innerHTML = '<i class=\"fa-solid fa-bookmark\"></i>';\r\n        if (btn) btn.classList.add('active');\r\n        if (navigator.vibrate) navigator.vibrate(10); // Haptic\r\n    } else {\r\n        window.favorites.splice(index, 1);\r\n        if (btn) btn.innerHTML = '<i class=\"fa-regular fa-bookmark\"></i>';\r\n        if (btn) btn.classList.remove('active');\r\n    }\r\n    localStorage.setItem('favorites', JSON.stringify(window.favorites));\r\n};\r\n\r\n/* ============================================\r\n   3. NAVIGATION & UI CORE\r\n   ============================================ */\r\n\r\nwindow.navigateToHomeDestinations = function () {\r\n    console.log(\"üîÑ Navigation Fluide: Retour Destinations...\");\r\n\r\n    // 1. Hide all sections (Manual Toggle to avoid ScrollTo(0,0))\r\n    document.querySelectorAll('.page-section').forEach(el => {\r\n        el.style.display = 'none';\r\n        el.classList.remove('active');\r\n        const vid = el.querySelector('video');\r\n        if (vid) vid.pause();\r\n    });\r\n\r\n    // 2. Show Home\r\n    const home = document.getElementById('page-accueil');\r\n    if (home) {\r\n        home.style.display = 'block';\r\n        home.classList.add('active');\r\n\r\n        // 3. Fluid scroll to anchor\r\n        // Small delay to ensure layout is painted\r\n        setTimeout(() => {\r\n            const target = document.getElementById('home-destinations');\r\n            if (target) {\r\n                target.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n            }\r\n        }, 10);\r\n    }\r\n\r\n    // 4. Update Nav State\r\n    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));\r\n    const homeBtn = document.querySelector('.nav-btn[data-page=\"accueil\"]');\r\n    if (homeBtn) homeBtn.classList.add('active');\r\n}\r\n\r\nwindow.initNavigation = function () {\r\n    const navBtns = document.querySelectorAll('.nav-btn');\r\n    const shortcuts = document.querySelectorAll('.shortcut-card');\r\n\r\n    navBtns.forEach(btn => {\r\n        btn.addEventListener('click', () => {\r\n            const page = btn.dataset.page;\r\n            navigateToPage(page);\r\n        });\r\n    });\r\n\r\n    shortcuts.forEach(card => {\r\n        card.addEventListener('click', () => {\r\n            const page = card.dataset.goto;\r\n            navigateToPage(page);\r\n        });\r\n    });\r\n}\r\n\r\n// Global Context Tracker\r\nwindow.previousPageContext = null;\r\n\r\nwindow.navigateToPage = async function (pageName) {\r\n    console.log('üîÑ navigateToPage called with:', pageName);\r\n    if (!pageName) return;\r\n\r\n    let targetId = pageName;\r\n    if (!targetId.startsWith('page-')) targetId = 'page-' + pageName;\r\n\r\n    // --- CONTEXT TRACKING ---\r\n    const currentSection = document.querySelector('.page-section.active');\r\n    if (currentSection) {\r\n        const currentId = currentSection.id;\r\n        if (currentId !== 'page-carte' && currentId !== 'page-accueil' && currentId.startsWith('page-')) {\r\n            window.previousPageContext = currentId;\r\n        } else if (currentId === 'page-accueil') {\r\n            window.previousPageContext = null;\r\n        }\r\n    }\r\n\r\n    // --- UI RESET ---\r\n    document.querySelectorAll('.page-section').forEach(section => {\r\n        section.classList.remove('active');\r\n        section.style.display = 'none';\r\n        const video = section.querySelector('video');\r\n        if (video) video.pause();\r\n    });\r\n    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));\r\n\r\n    // --- SHOW TARGET ---\r\n    const newSection = document.getElementById(targetId);\r\n    if (newSection) {\r\n        newSection.style.display = 'block';\r\n        setTimeout(() => newSection.classList.add('active'), 10);\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n\r\n        // Map Specifics\r\n        if (pageName === 'carte') {\r\n            if (window.leafletMap) {\r\n                setTimeout(() => { if (window.leafletMap) window.leafletMap.invalidateSize(); }, 300);\r\n            }\r\n            // Back Button Logic\r\n            const btnContainer = document.getElementById('btn-back-context-container');\r\n            const btnLabel = document.getElementById('btn-back-context-label');\r\n            if (window.previousPageContext && btnContainer && btnLabel) {\r\n                let niceName = \"Province\";\r\n                if (window.previousPageContext.includes('antsiranana')) niceName = \"Diego\";\r\n                else if (window.previousPageContext.includes('nosybe')) niceName = \"Nosy Be\";\r\n                else if (window.previousPageContext.includes('mahajanga')) niceName = \"Majunga\";\r\n                else if (window.previousPageContext.includes('toamasina')) niceName = \"Tamatave\";\r\n                else if (window.previousPageContext.includes('toliara')) niceName = \"Tul√©ar\";\r\n                else if (window.previousPageContext.includes('fianarantsoa')) niceName = \"Fianar\";\r\n                else if (window.previousPageContext.includes('antananarivo')) niceName = \"Tana\";\r\n                else if (window.previousPageContext.includes('saintemarie')) niceName = \"Ste Marie\";\r\n                btnLabel.innerText = `Retour √† ${niceName}`;\r\n                btnContainer.style.display = 'block';\r\n            } else if (btnContainer) {\r\n                btnContainer.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        // GSAP Refresh\r\n        setTimeout(() => {\r\n            if (window.GasikaraAnimations) window.GasikaraAnimations.refresh();\r\n        }, 100);\r\n    }\r\n\r\n    const rawName = pageName.replace('page-', '');\r\n    const activeBtn = document.querySelector(`.nav-btn[data-page=\"${rawName}\"]`);\r\n    if (activeBtn) activeBtn.classList.add('active');\r\n\r\n    // --- LAZY LOADING MODULES ---\r\n    if (!window._modulesLoaded) window._modulesLoaded = {};\r\n\r\n    try {\r\n        // 1. MAP\r\n        if (rawName === 'carte' && !window._modulesLoaded.map) {\r\n            console.log(\"Lazy Loading: Map Module...\");\r\n            await import('./modules/map.js');\r\n            if (typeof window.initMap === 'function') window.initMap();\r\n            window._modulesLoaded.map = true;\r\n        }\r\n\r\n        // 2. CITIES (Hubs)\r\n        const cityKeys = ['antsiranana', 'nosybe', 'mahajanga', 'toamasina', 'toliara', 'fianarantsoa', 'antananarivo', 'saintemarie'];\r\n        if (cityKeys.some(k => rawName.includes(k)) && !window._modulesLoaded.cities) {\r\n            console.log(\"Lazy Loading: Cities Module...\");\r\n            await import('./modules/cities.js');\r\n            if (typeof window.initCityPages === 'function') window.initCityPages();\r\n            window._modulesLoaded.cities = true;\r\n        }\r\n\r\n        // 3. ITINERARIES\r\n        if (rawName === 'itineraires' && !window._modulesLoaded.itineraires) {\r\n            console.log(\"Lazy Loading: Itineraries Module...\");\r\n            await import('./modules/itineraries.js');\r\n            if (typeof window.initItinerariesPage === 'function') window.initItinerariesPage();\r\n            window._modulesLoaded.itineraires = true;\r\n        }\r\n\r\n        // 4. SPOTS\r\n        if (rawName === 'spots' && !window._modulesLoaded.spots) {\r\n            console.log(\"Lazy Loading: Spots Module...\");\r\n            await import('./modules/spots.js');\r\n            if (typeof window.initSpotsPage === 'function') window.initSpotsPage();\r\n            window._modulesLoaded.spots = true;\r\n        }\r\n\r\n        // 5. TOOLS & LANGUE\r\n        if (rawName === 'outils' && !window._modulesLoaded.outils) {\r\n            console.log(\"Lazy Loading: Tools Module...\");\r\n            await import('./modules/tools.js');\r\n            if (typeof window.initOutilsPage === 'function') window.initOutilsPage();\r\n            window._modulesLoaded.outils = true;\r\n        }\r\n        if (rawName === 'langue' && !window._modulesLoaded.langue) {\r\n            // Langue data is loaded synchronously in index.html (phrases.js)\r\n            // Logic is already in app.js, no need to lazy load empty module\r\n            if (typeof window.initLanguePage === 'function') window.initLanguePage();\r\n            window._modulesLoaded.langue = true;\r\n        }\r\n\r\n    } catch (e) {\r\n        console.error(\"Module Load Error:\", e);\r\n    }\r\n};\r\n\r\n// Implement Back Navigation Function\r\nwindow.navigateBack = function () {\r\n    if (window.previousPageContext) {\r\n        // Strip 'page-' to get the clean name for navigateToPage\r\n        const rawPage = window.previousPageContext.replace('page-', '');\r\n        window.navigateToPage(rawPage);\r\n    } else {\r\n        window.navigateToPage('accueil');\r\n    }\r\n};\r\n// Alias\r\nwindow.showSection = window.navigateToPage;\r\n\r\n/* ============================================\r\n   3. CIRCUITS & TIMELINE (RESTORED PREMIUM)\r\n   ============================================ */\r\n\r\nwindow.initItinerariesPage = function () {\r\n    const container = document.getElementById('itineraires-list');\r\n    if (!container) return;\r\n    const circuits = window.ITINERAIRES_DATA ? Object.values(window.ITINERAIRES_DATA) : [];\r\n\r\n    const slugMap = {\r\n        'circuit-nord': 'circuits/epopee-grand-nord.html',\r\n        'circuit-cacao': 'circuits/route-du-cacao.html',\r\n        'circuit-vanille': 'circuits/cote-de-la-vanille.html',\r\n        'circuit-nosybe': 'circuits/archipel-nosy-be.html'\r\n    };\r\n\r\n    container.innerHTML = circuits.map((c, i) => `\r\n        <div class=\"lieu-card fade-in-up hover-lift\" style=\"animation-delay: ${i * 0.1}s;\">\r\n             <div class=\"lieu-image\" style=\"${c.image ? `background-image: url('${c.image}'); background-size: cover; background-position: center;` : `background: linear-gradient(to bottom right, var(--laterite), var(--foret)); display:flex; align-items:center; justify-content:center; color:white; font-size:3rem;`}\">\r\n                ${!c.image ? '<i class=\"fas fa-route\"></i>' : ''}\r\n             </div>\r\n             <div class=\"lieu-content\">\r\n                <h3 class=\"lieu-title\">${c.nom}</h3>\r\n                <div class=\"lieu-meta\"><span class=\"badge-type\">${c.duree}</span><span class=\"lieu-prix\">${c.budget || 'Variable'}</span></div>\r\n                <p class=\"lieu-desc\">${c.description}</p>\r\n                <a href=\"${slugMap[c.id] || '#'}\" class=\"btn-details\">Voir le d√©tail</a>\r\n             </div>\r\n        </div>\r\n    `).join('');\r\n}\r\n\r\n// DEPRECATED HANDLERS REMOVED\r\n// window.handleCircuitClick & window.handleCircuitCardClick removed to force standard navigation.\r\n\r\n\r\nwindow.showItineraryDetail = function (id) {\r\n    const list = document.getElementById('itineraires-list');\r\n    const detail = document.getElementById('itineraire-detail');\r\n    const content = document.getElementById('itineraire-content');\r\n    const mainBanner = document.querySelector('#page-itineraires > .premium-banner-tout');\r\n\r\n    const circuits = window.ITINERAIRES_DATA || {};\r\n    let circuit = Object.values(circuits).find(c => c.id === id);\r\n    if (!circuit) return;\r\n\r\n    // View toggle\r\n    list.style.display = 'none';\r\n    if (mainBanner) mainBanner.style.display = 'none';\r\n    detail.style.display = 'block';\r\n\r\n    // 1. BANNER & HEADER\r\n    let html = `\r\n        <div class=\"circuit-detail-banner city-header\" style=\"background-image: url('${circuit.image}');\">\r\n            <div class=\"banner-overlay\"></div>\r\n            <div class=\"banner-content\">\r\n                <h2 class=\"city-title\" style=\"text-shadow: 0 2px 4px rgba(0,0,0,0.3);\">${circuit.nom}</h2>\r\n                <p class=\"city-desc\" style=\"text-shadow: 0 1px 2px rgba(0,0,0,0.3); opacity: 0.9;\">${circuit.description}</p>\r\n            </div>\r\n            <button onclick=\"backToItineraries()\" class=\"btn-back-floating\"><i class=\"fas fa-arrow-left\"></i></button>\r\n        </div>\r\n\r\n        <div style=\"padding: 20px; max-width: 800px; margin: 0 auto;\">\r\n            <!-- META INFO -->\r\n            <div style=\"display:flex; gap:15px; margin-bottom:25px; flex-wrap:wrap; justify-content: center;\">\r\n                <span class=\"meta-tag\"><i class=\"far fa-clock\"></i> ${circuit.duree}</span>\r\n                <span class=\"meta-tag\"><i class=\"fas fa-shield-alt\"></i> S√©curit√©: ${circuit.infos.securite_level}</span>\r\n                <span class=\"meta-tag\"><i class=\"fas fa-sun\"></i> ${(circuit.logistique_generale || {}).saison_ideale || 'Toute ann√©e'}</span>\r\n            </div>\r\n\r\n            <!-- LE MOT DU GUIDE (COLLAPSIBLE) -->\r\n            <div class=\"logistique-container\" style=\"margin-top:0;\">\r\n                 ${(Object.keys(circuit.logistique_generale || {}).length > 0 || circuit.infos) ? `\r\n                    <div class=\"accordion-v3\" style=\"margin-top:20px;\">\r\n                        <div class=\"accordion-item\">\r\n                            <button class=\"accordion-trigger\" aria-expanded=\"false\" onclick=\"window.toggleAccordionV3(this)\">\r\n                                <div class=\"accordion-header-content\">\r\n                                    <div class=\"icon-wrapper\"><i class=\"fas fa-info-circle\"></i></div>\r\n                                    <div class=\"accordion-text\">\r\n                                        <div class=\"accordion-heading\">Infos Pratiques & FAQ</div>\r\n                                        <div class=\"accordion-subtitle\">Logistique du circuit</div>\r\n                                    </div>\r\n                                </div>\r\n                                <i class=\"fas fa-chevron-down chevron\"></i>\r\n                            </button>\r\n                            <div class=\"accordion-body\" aria-hidden=\"true\">\r\n                                <div class=\"accordion-inner\">\r\n                                    <ul style=\"list-style:none; padding:0; margin:0;\">\r\n                                        ${(circuit.logistique_generale || {}).saison_ideale ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-sun\"></i> Saison Id√©ale:</strong> ${(circuit.logistique_generale || {}).saison_ideale}</li>` : ''}\r\n                                        ${(circuit.logistique_generale || {}).vehicule_conseil ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-car-side\"></i> Transport:</strong> ${(circuit.logistique_generale || {}).vehicule_conseil}</li>` : ''}\r\n                                        ${(circuit.logistique_generale || {}).route_etat ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-road\"></i> √âtat de la route:</strong> ${(circuit.logistique_generale || {}).route_etat}</li>` : ''}\r\n                                        ${circuit.infos.securite_level ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-shield-alt\"></i> S√©curit√©:</strong> ${circuit.infos.securite_level}</li>` : ''}\r\n                                        ${circuit.infos.description_fun ? `<li style=\"margin-top:15px; font-style:italic; color:var(--laterite);\">\"${circuit.infos.description_fun}\"</li>` : ''}\r\n                                    </ul>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n            </div>\r\n\r\n            <!-- BUDGET SELECTOR -->\r\n            ${circuit.budgets ? `\r\n            <h3 style=\"margin-top:30px; margin-bottom:15px; font-family:var(--font-display);\">Options de Voyage</h3>\r\n            <div class=\"budget-selector\">\r\n                <div id=\"budget-btn-eco\" class=\"budget-option\" onclick=\"switchCircuitBudget('${id}', 'eco')\">\r\n                    <span class=\"budget-label\">Eco / Backpacker</span>\r\n                </div>\r\n                <div id=\"budget-btn-standard\" class=\"budget-option active\" onclick=\"switchCircuitBudget('${id}', 'standard')\">\r\n                    <span class=\"budget-label\">Confort Standard</span>\r\n                </div>\r\n                <div id=\"budget-btn-premium\" class=\"budget-option\" onclick=\"switchCircuitBudget('${id}', 'premium')\">\r\n                    <span class=\"budget-label\">Luxe Premium</span>\r\n                </div>\r\n            </div>\r\n            <div style=\"background:var(--bg-secondary); padding:20px; border-radius:12px; border:1px solid var(--border-color); box-shadow:0 4px 6px rgba(0,0,0,0.02);\">\r\n                <div style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;\">\r\n                    <span id=\"budget-price-display\" class=\"budget-price\" style=\"font-size:2rem; color:var(--laterite); font-weight:800;\">${(circuit.budgets.standard || {}).price || '-'}</span>\r\n                    <span style=\"font-size:0.9rem; color:var(--text-secondary);\">/ personne (base 2)</span>\r\n                </div>\r\n                <p id=\"budget-desc-display\" style=\"margin-bottom:15px; color:var(--text-primary); font-size:1.05rem;\">${(circuit.budgets.standard || {}).desc || ''}</p>\r\n                <ul id=\"budget-inclusions\" style=\"list-style:none; padding:0; display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:0.9rem;\">\r\n                    ${(circuit.budgets.standard && circuit.budgets.standard.inclus ? circuit.budgets.standard.inclus.map(item => `<li><i class=\"fas fa-check\" style=\"color:var(--success);\"></i> ${item}</li>`).join('') : '')}\r\n                </ul>\r\n            </div>\r\n            ` : ''}\r\n\r\n            <!-- TIMELINE (CORE) -->\r\n            <h3 style=\"margin-top:40px; margin-bottom:20px; font-family:var(--font-display);\">Programme D√©taill√©</h3>\r\n            <div class=\"timeline-container\">\r\n    `;\r\n\r\n    // 2. TIMELINE STEPS GENERATION\r\n    if (circuit.etapes) {\r\n        circuit.etapes.forEach(step => {\r\n            // Logic Bar\r\n            let logicBarHtml = '';\r\n            if (step.logistique) {\r\n                logicBarHtml = `\r\n                    <div class=\"logic-bar\">\r\n                        <div class=\"logic-point start\"><span class=\"logic-label\">D√©part</span><span class=\"logic-val\">${step.logistique.depart || ''}</span></div>\r\n                        <div class=\"logic-arrow\"><i class=\"fas fa-arrow-right\"></i><span class=\"logic-dist\">${step.logistique.duree_totale_transport || ''}</span></div>\r\n                        <div class=\"logic-point end\"><span class=\"logic-label\">Arriv√©e</span><span class=\"logic-val\">${step.logistique.arrivee || ''}</span></div>\r\n                    </div>`;\r\n            }\r\n\r\n            // Transports\r\n            let transportHtml = '';\r\n            if (step.transports_details) {\r\n                transportHtml = '<div class=\"transport-detail-row\">';\r\n                step.transports_details.forEach(t => {\r\n                    let icon = 'fa-car';\r\n                    if (t.type.toLowerCase().includes('bateau')) icon = 'fa-ship';\r\n                    if (t.type.toLowerCase().includes('marche')) icon = 'fa-hiking';\r\n                    if (t.type.toLowerCase().includes('avion')) icon = 'fa-plane';\r\n                    transportHtml += `<div class=\"transport-pill\"><i class=\"fas ${icon}\"></i> <span>${t.type} (${t.duree})</span></div>`;\r\n                });\r\n                transportHtml += '</div>';\r\n            }\r\n\r\n            // Accomodations Grid\r\n            let accomHtml = '';\r\n            if (step.hebergement_options) {\r\n                accomHtml = window.getAccomGridHtml(step.hebergement_options);\r\n            }\r\n\r\n            // Step HTML\r\n            html += `\r\n                <div class=\"timeline-step\">\r\n                    <div class=\"timeline-marker\"></div>\r\n                    <div class=\"timeline-header\">\r\n                        <span class=\"timeline-day\">Jour ${step.jour}</span>\r\n                        <h4 class=\"timeline-title\">${step.titre}</h4>\r\n                    </div>\r\n                    \r\n                    ${logicBarHtml}\r\n                    \r\n                    <div class=\"timeline-content expert-desc\">\r\n                        ${step.description_expert || step.description}\r\n                    </div>\r\n                    \r\n                    <!-- IMANQUABLES -->\r\n                    ${step.incontournables ? `\r\n                        <div class=\"step-section-title\"><i class=\"fas fa-eye\"></i> Les Immanquables</div>\r\n                        <div class=\"incontournables-tags\">\r\n                            ${step.incontournables.map(i => {\r\n                if (typeof i === 'object' && i.id) return `<span class=\"visi-tag clickable\" onclick=\"window.showLieuDetailsByID(${i.id})\"><i class=\"fas fa-eye\"></i> ${i.label || i.nom}</span>`;\r\n                return `<span class=\"visi-tag\">${i}</span>`;\r\n            }).join('')}\r\n                        </div>\r\n                    ` : ''}\r\n\r\n                    ${transportHtml}\r\n\r\n                    <!-- ACCORDEONS (DODO, MIAM, TIPS) -->\r\n                    <div style=\"margin-top:20px; display:flex; flex-direction:column; gap:10px;\">\r\n                        ${step.hebergement_options ? `\r\n                        <div class=\"step-accordion\">\r\n                            <div class=\"step-accordion-header\" onclick=\"window.toggleStepAccordion(this)\">\r\n                                <div class=\"step-accordion-title\">\r\n                                    <span><i class=\"fas fa-bed\"></i> O√π poser ses valises ?</span>\r\n                                    <span class=\"preview-text\">${window.getAccomPreviewText(step.hebergement_options)}</span>\r\n                                </div>\r\n                                <i class=\"fas fa-chevron-down Chevron\"></i>\r\n                            </div>\r\n                            <div class=\"step-accordion-body\">${accomHtml}</div>\r\n                        </div>` : ''}\r\n\r\n                        ${step.gourmandise ? `\r\n                        <div class=\"step-accordion culinary\">\r\n                            <div class=\"step-accordion-toggle-btn step-accordion-header\">\r\n                                <div class=\"step-accordion-title\"><span><i class=\"fas fa-utensils\"></i> Instant Gourmand</span></div>\r\n                                <i class=\"fas fa-chevron-down Chevron\"></i>\r\n                            </div>\r\n                            <div class=\"step-accordion-outer\">\r\n                                <div class=\"step-accordion-inner step-accordion-body\"><div class=\"accordion-inner-content\" style=\"padding:15px;\">${step.gourmandise}</div></div>\r\n                            </div>\r\n                        </div>` : ''}\r\n\r\n                        ${step.astuce ? `\r\n                        <div class=\"step-accordion astuce\">\r\n                            <div class=\"step-accordion-toggle-btn step-accordion-header\">\r\n                                <div class=\"step-accordion-title\"><span><i class=\"fas fa-lightbulb\"></i> Le Conseil Expert</span></div>\r\n                                <i class=\"fas fa-chevron-down Chevron\"></i>\r\n                            </div>\r\n                            <div class=\"step-accordion-outer\">\r\n                                <div class=\"step-accordion-inner step-accordion-body\"><div class=\"accordion-inner-content\" style=\"padding:15px;\">${step.astuce}</div></div>\r\n                            </div>\r\n                        </div>` : ''}\r\n                    </div>\r\n                </div>\r\n            `;\r\n        });\r\n    }\r\n\r\n    html += `</div></div>`; // End container\r\n    content.innerHTML = html;\r\n\r\n    // Attach listeners after rendering\r\n    attachAccordionListeners();\r\n\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n}\r\n\r\nwindow.backToItineraries = function () {\r\n    document.getElementById('itineraires-list').style.display = 'grid';\r\n    document.getElementById('itineraire-detail').style.display = 'none';\r\n    const mainBanner = document.querySelector('#page-itineraires > .premium-banner-tout');\r\n    if (mainBanner) mainBanner.style.display = 'block';\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n}\r\n\r\n// Helpers Timeline - Robust Implementation (Synced with circuit-renderer.js)\r\nconst appAccordionObservers = new WeakMap();\r\n\r\n// GLOBAL: Expose for setInterval usage to prevent ReferenceError\r\nwindow.forceRecalculateHeight = function (container) {\r\n    const outer = container.querySelector('.step-accordion-outer');\r\n    const inner = container.querySelector('.step-accordion-inner') || container.querySelector('.step-accordion-body');\r\n\r\n    if (!container.classList.contains('open') || !outer || !inner) return;\r\n\r\n    void inner.offsetHeight; // Force reflow\r\n    const newHeight = inner.scrollHeight;\r\n    outer.style.maxHeight = (newHeight + 50) + 'px';\r\n};\r\n\r\n// Internal alias if needed, or just use window.\r\nconst forceRecalculateHeight = window.forceRecalculateHeight;\r\n\r\nfunction attachAccordionListeners() {\r\n    document.querySelectorAll('.step-accordion-toggle-btn').forEach(btn => {\r\n        // Prevent multiple attachments\r\n        if (btn.dataset.hasListener) return;\r\n        btn.dataset.hasListener = 'true';\r\n\r\n        btn.addEventListener('click', (e) => {\r\n            e.stopPropagation(); // SOL 1: ISOLATION\r\n            toggleStepAccordion(btn);\r\n        });\r\n    });\r\n\r\n    // √âcouter TOUS les <details> pour les sous-accord√©ons\r\n    document.querySelectorAll('.step-sub-accordion').forEach(details => {\r\n        if (details.dataset.hasListener) return;\r\n        details.dataset.hasListener = 'true';\r\n\r\n        details.addEventListener('toggle', (e) => {\r\n            e.stopPropagation();\r\n\r\n            const parentAccordion = details.closest('.step-accordion');\r\n            if (!parentAccordion) return;\r\n\r\n            setTimeout(() => {\r\n                forceRecalculateHeight(parentAccordion);\r\n            }, 50);\r\n\r\n            requestAnimationFrame(() => {\r\n                forceRecalculateHeight(parentAccordion);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction toggleStepAccordion(header) {\r\n    // Support click on header or button\r\n    const btn = header.tagName === 'BUTTON' ? header : header;\r\n    const container = btn.closest('.step-accordion');\r\n    if (!container) return;\r\n\r\n    const outer = container.querySelector('.step-accordion-outer');\r\n    const inner = container.querySelector('.step-accordion-inner') || container.querySelector('.step-accordion-body'); // Support legacy class\r\n\r\n    // Fallback for old structure if wrappers missing\r\n    if (!outer) {\r\n        header.parentElement.classList.toggle('open');\r\n        return;\r\n    }\r\n\r\n    const isOpen = container.classList.toggle('open');\r\n    if (btn.setAttribute) btn.setAttribute('aria-expanded', isOpen);\r\n\r\n    if (isOpen) {\r\n        outer.style.maxHeight = 'none';\r\n\r\n        if (!appAccordionObservers.has(container)) {\r\n            const observer = new ResizeObserver(entries => {\r\n                for (let entry of entries) {\r\n                    requestAnimationFrame(() => {\r\n                        if (!container.classList.contains('open')) return;\r\n                        const height = inner.scrollHeight;\r\n                        // Apply +30px buffer everywhere\r\n                        outer.style.maxHeight = (height + 30) + 'px';\r\n                    });\r\n                }\r\n            });\r\n            observer.observe(inner);\r\n            appAccordionObservers.set(container, observer);\r\n        }\r\n\r\n        // Surveillance continue sur mobile\r\n        if (window.innerWidth <= 768) {\r\n            // FORCE STATIC CARDS MODE: Open all sub-details\r\n            container.querySelectorAll('.step-sub-accordion').forEach(details => {\r\n                details.open = true;\r\n            });\r\n\r\n            let iterations = 0;\r\n            const mobileInterval = setInterval(() => {\r\n                forceRecalculateHeight(container);\r\n                iterations++;\r\n                if (iterations >= 10) {\r\n                    clearInterval(mobileInterval);\r\n                }\r\n            }, 100);\r\n        }\r\n\r\n    } else {\r\n        const observer = appAccordionObservers.get(container);\r\n        if (observer) {\r\n            observer.disconnect();\r\n            appAccordionObservers.delete(container);\r\n        }\r\n        outer.style.maxHeight = '0px';\r\n    }\r\n}\r\n\r\n// Expose slightly different name or same to avoid conflict if both loaded?\r\n// But ideally only one renders. We keep window.toggleStepAccordion for console testing.\r\nwindow.toggleStepAccordion = toggleStepAccordion;\r\n\r\nwindow.getAccomPreviewText = function (options) {\r\n    if (!options) return '';\r\n    if (typeof options === 'object' && !Array.isArray(options)) {\r\n        let names = [];\r\n        for (const [k, v] of Object.entries(options)) {\r\n            let n = (typeof v === 'object' && v.text) ? v.text : v;\r\n            names.push(n.split('(')[0].trim());\r\n        }\r\n        return names.join(' ‚Ä¢ ');\r\n    }\r\n    return 'Voir les options';\r\n};\r\n\r\nwindow.getAccomGridHtml = function (options) {\r\n    if (!options) return '';\r\n    let html = '<div class=\"accom-grid\">';\r\n    if (typeof options === 'object' && !Array.isArray(options)) {\r\n        for (const [key, val] of Object.entries(options)) {\r\n            let icon = key === 'premium' ? 'fa-gem' : (key === 'standard' ? 'fa-hotel' : 'fa-campground');\r\n            let label = key === 'premium' ? 'Luxe' : (key === 'standard' ? 'Confort' : 'Eco');\r\n            let name = val;\r\n            let clickAttr = '';\r\n            let classExtra = '';\r\n            if (typeof val === 'object' && val.id) {\r\n                name = val.text;\r\n                clickAttr = `onclick=\"window.showLieuDetailsByID(${val.id})\"`;\r\n                classExtra = 'clickable-card';\r\n            }\r\n            html += `\r\n                <div class=\"accom-card ${key} ${classExtra}\" ${clickAttr}>\r\n                    <div class=\"accom-icon\"><i class=\"fas ${icon}\"></i></div>\r\n                    <div class=\"accom-info\"><span class=\"accom-cat\">${label}</span><span class=\"accom-name\">${name}</span></div>\r\n                </div>`;\r\n        }\r\n    }\r\n    html += '</div>';\r\n    return html;\r\n};\r\n\r\nwindow.switchCircuitBudget = function (circuitId, level) {\r\n    const circuit = Object.values(window.ITINERAIRES_DATA).find(c => c.id === circuitId);\r\n    if (!circuit || !circuit.budgets || !circuit.budgets[level]) return;\r\n\r\n    document.querySelectorAll('.budget-option').forEach(el => el.classList.remove('active'));\r\n    const btn = document.getElementById(`budget-btn-${level}`);\r\n    if (btn) btn.classList.add('active');\r\n\r\n    const data = circuit.budgets[level];\r\n    const priceDisplay = document.getElementById('budget-price-display');\r\n    const descDisplay = document.getElementById('budget-desc-display');\r\n    const incDisplay = document.getElementById('budget-inclusions');\r\n\r\n    if (priceDisplay) priceDisplay.textContent = data.price;\r\n    if (descDisplay) descDisplay.textContent = data.desc;\r\n    if (incDisplay && data.inclus) {\r\n        incDisplay.innerHTML = data.inclus.map(item => `<li><i class=\"fas fa-check\" style=\"color:var(--success);\"></i> ${item}</li>`).join('');\r\n    }\r\n}\r\n\r\nwindow.showLieuDetailsByID = function (id) {\r\n    const lieu = window.LIEUX_DATA.find(l => l.id == id);\r\n    if (lieu) {\r\n        openLieuModal(lieu);\r\n    } else {\r\n        console.warn(\"Lieu not found for ID:\", id);\r\n    }\r\n}\r\n\r\n/* ============================================\r\n   4. OUTILS (TAXI & CHECKLIST)\r\n   ============================================ */\r\n\r\nwindow.initOutilsPage = function () {\r\n    initTaxiTool();\r\n    initChecklist(); // New persistent checklist\r\n\r\n    // Currency Converter\r\n    const amountInput = document.getElementById('amountInput');\r\n    const convertBtn = document.getElementById('convertBtn');\r\n    const resultDiv = document.getElementById('convertedResult');\r\n    const rateInput = document.getElementById('exchangeRateInput');\r\n\r\n    if (rateInput) rateInput.value = window.exchangeRate;\r\n\r\n    if (convertBtn && amountInput && resultDiv) {\r\n        convertBtn.addEventListener('click', () => {\r\n            const ariary = parseFloat(amountInput.value);\r\n            const rate = parseFloat(rateInput ? rateInput.value : window.exchangeRate);\r\n            if (!isNaN(ariary) && !isNaN(rate)) {\r\n                window.exchangeRate = rate;\r\n                localStorage.setItem('exchangeRate', rate);\r\n                const euros = (ariary / rate).toFixed(2);\r\n                resultDiv.textContent = `${ariary.toLocaleString()} Ar ‚âà ${euros} ‚Ç¨`;\r\n                resultDiv.style.color = 'var(--text-primary)';\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction initTaxiTool() {\r\n    const btnCalcTaxi = document.getElementById('btnCalcTaxi');\r\n    const selFrom = document.getElementById('taxiFrom');\r\n    const selTo = document.getElementById('taxiTo');\r\n    const resultDiv = document.getElementById('taxiResult');\r\n\r\n    // Populate Selects\r\n    const cities = [\"Antananarivo\", \"Diego-Suarez\", \"Mahajanga\", \"Toamasina\", \"Fianarantsoa\", \"Toliara\", \"Nosy Be\", \"Ambanja\", \"Antsirabe\"];\r\n    if (selFrom && selTo) {\r\n        const opts = cities.map(c => `<option value=\"${c}\">${c}</option>`).join('');\r\n        selFrom.innerHTML = opts;\r\n        selTo.innerHTML = opts;\r\n        selTo.value = \"Diego-Suarez\"; // default\r\n    }\r\n\r\n    if (btnCalcTaxi && selFrom && selTo && resultDiv) {\r\n        btnCalcTaxi.addEventListener('click', () => {\r\n            const from = selFrom.value;\r\n            const to = selTo.value;\r\n\r\n            if (from === to) {\r\n                resultDiv.innerHTML = \"<p style='color:red; text-align:center;'>Tu es d√©j√† arriv√© ! Choisis une autre destination. üòÇ</p>\";\r\n                resultDiv.classList.remove('hidden');\r\n                return;\r\n            }\r\n\r\n            // Humor (Grok Style)\r\n            const remarks = [\r\n                \"Zay ! Tu es press√© ou tu veux admirer le paysage ?\",\r\n                \"En Taxi-Brousse, le temps est une notion abstraite... üòÇ\",\r\n                \"Pr√©pare ta playlist, √ßa va √™tre long (mais beau) !\",\r\n                \"Astuce : Prends la place devant si tu tiens √† tes genoux.\",\r\n                \"Mora Mora... on arrive quand on arrive.\"\r\n            ];\r\n            const randomRemark = remarks[Math.floor(Math.random() * remarks.length)];\r\n\r\n            // Mock Data\r\n            let dist = Math.floor(Math.random() * 800) + 100;\r\n            let hours = Math.floor(dist / 50);\r\n            let price = dist * 100;\r\n\r\n            resultDiv.innerHTML = `\r\n                <div style=\"background:var(--bg-secondary); padding:10px; border-radius:8px; margin-bottom:15px; border-left:4px solid var(--laterite); font-style:italic;\">\r\n                    \"${randomRemark}\"\r\n                </div>\r\n\r\n                <div class=\"result-row\">\r\n                    <div class=\"result-item\">\r\n                        <span class=\"result-label\">Dur√©e Estim√©e</span>\r\n                        <span class=\"result-value\" id=\"resDuration\">${hours}h ${Math.floor(Math.random() * 60)}min</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"result-divider\" style=\"height: 1px; background: rgba(0,0,0,0.1); margin: 15px 0;\"></div>\r\n\r\n                <div id=\"resPriceContainer\" class=\"price-tiers-container\">\r\n                    <div class=\"price-tier\">\r\n                        <div class=\"price-tier-name\">Taxi-Brousse</div>\r\n                        <div class=\"price-tier-amount\">${(price * 10).toLocaleString()} Ar</div>\r\n                    </div>\r\n                     <div class=\"price-tier featured\">\r\n                        <div class=\"price-tier-name\">Cotisse / VIP</div>\r\n                        <div class=\"price-tier-amount\">${(price * 25).toLocaleString()} Ar</div>\r\n                    </div>\r\n                     <div class=\"price-tier\">\r\n                        <div class=\"price-tier-name\">Location 4x4</div>\r\n                        <div class=\"price-tier-amount\">${(price * 150).toLocaleString()} Ar</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"mt-20\">\r\n                    <span class=\"result-note\">‚ö†Ô∏è Tarifs indicatifs (Lite / Premium / VIP)</span>\r\n                </div>\r\n\r\n                <div id=\"companiesSection\" class=\"companies-section\">\r\n                    <h4 style=\"font-family: 'Playfair Display', serif; color: var(--text-primary); margin-bottom: 15px;\">Compagnies Recommand√©es</h4>\r\n                    <div id=\"companiesList\" class=\"companies-list\">\r\n                        <div class=\"company-card\">\r\n                            <div class=\"company-logo\">üöê</div>\r\n                            <div><strong>Cotisse Transport</strong><br><span style=\"font-size:0.8rem; color:#666;\">Premium & Wi-Fi</span></div>\r\n                        </div>\r\n                        <div class=\"company-card\">\r\n                            <div class=\"company-logo\">üöå</div>\r\n                            <div><strong>Kofmad</strong><br><span style=\"font-size:0.8rem; color:#666;\">Fiable & Rapide</span></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n            resultDiv.classList.remove('hidden');\r\n        });\r\n    }\r\n}\r\n\r\nconst DEFAULT_CHECKLIST_DEFS = [\r\n    { id: 'passeport', text: 'Passeport (validit√© 6 mois)' },\r\n    { id: 'visa', text: 'Visa (√† l\\'arriv√©e ou e-visa)' },\r\n    { id: 'billet', text: 'Billets d\\'avion imprim√©s' },\r\n    { id: 'cash', text: 'Euros en esp√®ces (pour le change)' },\r\n    { id: 'vete_leger', text: 'V√™tements l√©gers (coton/lin)' },\r\n    { id: 'pull', text: 'Un pull l√©ger (soir√©es/avion)' },\r\n    { id: 'chaussure', text: 'Chaussures de marche confortables' },\r\n    { id: 'maillot', text: 'Maillot de bain & Serviette' },\r\n    { id: 'pharmacie', text: 'Trousse √† pharmacie (base + antipalu)' },\r\n    { id: 'moustique', text: 'R√©pulsif moustique (Zone Tropiques)' },\r\n    { id: 'creme', text: 'Cr√®me solaire (SPF 50)' },\r\n    { id: 'lunettes', text: 'Lunettes de soleil & Chapeau' },\r\n    { id: 'adaptateur', text: 'Adaptateur universel (optionnel)' },\r\n    { id: 'batterie', text: 'Batterie externe (Powerbank)' }\r\n];\r\n\r\nfunction initChecklist() {\r\n    const listContainer = document.getElementById('checklistContainer');\r\n    if (!listContainer) return;\r\n\r\n    // Apply 2026 Container Class\r\n    listContainer.className = 'checklist-container-2026';\r\n\r\n    // Load Defs\r\n    let currentDefs = DEFAULT_CHECKLIST_DEFS;\r\n    try {\r\n        const savedDefs = localStorage.getItem('checklist_definitions');\r\n        if (savedDefs) currentDefs = JSON.parse(savedDefs);\r\n    } catch (e) { console.warn(\"Checklist defs load error\", e); }\r\n\r\n    // Store globally for add/remove access\r\n    window.currentChecklistDefs = currentDefs;\r\n\r\n    function renderChecklist() {\r\n        const total = window.currentChecklistDefs.length;\r\n        const checkedCount = window.checklist.length;\r\n        const percent = total === 0 ? 0 : Math.round((checkedCount / total) * 100);\r\n\r\n        // Header & Progress\r\n        let html = `\r\n            <div class=\"checklist-stats\">\r\n                <span>${checkedCount}/${total} compl√©t√©s</span>\r\n                <span>${percent}%</span>\r\n            </div>\r\n            <div class=\"checklist-progress-container\">\r\n                <div class=\"checklist-progress-bar\" style=\"width: ${percent}%\"></div>\r\n            </div>\r\n            <div class=\"checklist-items-grid\">\r\n        `;\r\n\r\n        // Items\r\n        html += window.currentChecklistDefs.map(item => {\r\n            const isChecked = window.checklist.includes(item.id);\r\n            return `\r\n                <div class=\"checklist-item-2026 ${isChecked ? 'completed' : ''}\" onclick=\"toggleCheckItem('${item.id}')\">\r\n                    <div class=\"custom-checkbox\">\r\n                        <i class=\"fas fa-check\" style=\"opacity: ${isChecked ? 1 : 0}; transform: scale(${isChecked ? 1 : 0.5}); transition: all 0.2s ease;\"></i>\r\n                    </div>\r\n                    <span class=\"checklist-text\">${item.text}</span>\r\n                    <button class=\"btn-delete-item\" onclick=\"deleteChecklistItem('${item.id}', event)\" title=\"Supprimer\">\r\n                        <i class=\"fas fa-trash-alt\"></i>\r\n                    </button>\r\n                </div>\r\n            `;\r\n        }).join('');\r\n\r\n        html += `</div>`; // Close grid\r\n\r\n        // Add Input Section\r\n        html += `\r\n            <div class=\"checklist-add-container\">\r\n                <input type=\"text\" id=\"newChecklistItemInput\" class=\"input-add-item\" placeholder=\"Ajouter un √©l√©ment...\" onkeypress=\"handleChecklistInput(event)\">\r\n                <button class=\"btn-add-item\" onclick=\"addChecklistItem()\"><i class=\"fas fa-plus\"></i></button>\r\n            </div>\r\n        `;\r\n\r\n        listContainer.innerHTML = html;\r\n    }\r\n    renderChecklist();\r\n    window.renderChecklist = renderChecklist; // export export\r\n}\r\n\r\nwindow.toggleCheckItem = function (id) {\r\n    const idx = window.checklist.indexOf(id);\r\n    if (idx === -1) {\r\n        window.checklist.push(id);\r\n        if (navigator.vibrate) navigator.vibrate(10);\r\n    } else {\r\n        window.checklist.splice(idx, 1);\r\n    }\r\n    localStorage.setItem('checklist', JSON.stringify(window.checklist));\r\n    if (window.renderChecklist) window.renderChecklist();\r\n}\r\n\r\nwindow.addChecklistItem = function () {\r\n    const input = document.getElementById('newChecklistItemInput');\r\n    if (!input || !input.value.trim()) return;\r\n\r\n    const text = input.value.trim();\r\n    const id = 'custom_' + Date.now();\r\n\r\n    window.currentChecklistDefs.push({ id, text });\r\n    localStorage.setItem('checklist_definitions', JSON.stringify(window.currentChecklistDefs));\r\n\r\n    // Clear input and re-render\r\n    input.value = '';\r\n    if (window.renderChecklist) window.renderChecklist();\r\n}\r\n\r\nwindow.deleteChecklistItem = function (id, event) {\r\n    if (event) event.stopPropagation();\r\n\r\n    if (!confirm(\"Supprimer cet √©l√©ment ?\")) return;\r\n\r\n    // Remove from defs\r\n    window.currentChecklistDefs = window.currentChecklistDefs.filter(i => i.id !== id);\r\n    localStorage.setItem('checklist_definitions', JSON.stringify(window.currentChecklistDefs));\r\n\r\n    // Also custom cleanup from checked status\r\n    const idx = window.checklist.indexOf(id);\r\n    if (idx !== -1) {\r\n        window.checklist.splice(idx, 1);\r\n        localStorage.setItem('checklist', JSON.stringify(window.checklist));\r\n    }\r\n\r\n    if (window.renderChecklist) window.renderChecklist();\r\n}\r\n\r\nwindow.handleChecklistInput = function (e) {\r\n    if (e.key === 'Enter') window.addChecklistItem();\r\n}\r\n\r\n\r\n/* ============================================\r\n   5. LANGUE & TTS (RESTORED)\r\n   ============================================ */\r\n\r\n// ============================================\r\n// 5. LANGUE & TTS (RESTORED w/ PREMIUM DROPDOWN)\r\n// ============================================\r\n\r\nwindow.initLanguePage = function () {\r\n    const container = document.getElementById('accordionContainer');\r\n    if (!container || !window.PHRASES_DATA) return;\r\n\r\n    container.innerHTML = '';\r\n\r\n    // Barre de recherche\r\n    const searchHtml = `\r\n    <div class=\"search-container-2026\" style=\"margin-bottom: 30px;\">\r\n        <div class=\"search-wrapper-2026\">\r\n            <i class=\"fas fa-search search-icon-left\"></i>\r\n            <input type=\"text\" id=\"langSearch\" class=\"search-input-2026\" autocomplete=\"off\" \r\n                placeholder=\"Rechercher une expression...\" \r\n                oninput=\"filterLanguages(this.value)\" \r\n                onfocus=\"filterLanguages(this.value)\">\r\n            <div id=\"langSearchResults\" class=\"search-results-2026\"></div>\r\n        </div>\r\n    </div>\r\n    `;\r\n\r\n    container.innerHTML = searchHtml;\r\n\r\n    document.addEventListener('click', function (e) {\r\n        const wrapper = document.querySelector('.search-wrapper-2026');\r\n        const dropdown = document.getElementById('langSearchResults');\r\n        if (wrapper && !wrapper.contains(e.target) && dropdown) {\r\n            dropdown.classList.remove('active');\r\n        }\r\n    });\r\n\r\n    const gridContainer = document.createElement('div');\r\n    gridContainer.id = 'langGridContainer';\r\n    gridContainer.className = 'lang-sections-wrapper';\r\n    container.appendChild(gridContainer);\r\n\r\n    const categoryIcons = {\r\n        'salutations': 'fa-hand-wave',\r\n        'politesse': 'fa-heart',\r\n        'se pr√©senter': 'fa-user',\r\n        'se d√©placer': 'fa-map-marked-alt',\r\n        'n√©gocier': 'fa-handshake',\r\n        'restaurant': 'fa-utensils',\r\n        'urgence': 'fa-exclamation-triangle',\r\n        'nombres': 'fa-calculator',\r\n        'temps': 'fa-clock'\r\n    };\r\n\r\n    let dataEntries = Array.isArray(window.PHRASES_DATA) ?\r\n        window.PHRASES_DATA : Object.entries(window.PHRASES_DATA);\r\n\r\n    let html = '';\r\n\r\n    dataEntries.forEach(([cat, phrases]) => {\r\n        const icon = categoryIcons[cat.toLowerCase()] || 'fa-comment';\r\n        const catTitle = cat.charAt(0).toUpperCase() + cat.slice(1);\r\n\r\n        html += `\r\n        <div class=\"accordion-v3\">\r\n            <div class=\"accordion-item\">\r\n                <button class=\"accordion-trigger\" \r\n                        aria-expanded=\"false\" \r\n                        onclick=\"window.toggleAccordionV3(this)\">\r\n                    <div class=\"accordion-header-content\">\r\n                        <div class=\"icon-wrapper\">\r\n                            <i class=\"fas ${icon}\"></i>\r\n                        </div>\r\n                        <div class=\"accordion-text\">\r\n                            <div class=\"accordion-heading\">${catTitle}</div>\r\n                            <div class=\"accordion-subtitle\">${phrases.length} expressions</div>\r\n                        </div>\r\n                    </div>\r\n                    <i class=\"fas fa-chevron-down chevron\"></i>\r\n                </button>\r\n                <div class=\"accordion-body\" aria-hidden=\"true\">\r\n                    <div class=\"accordion-inner\">\r\n                        <div class=\"language-grid-2026\">\r\n                            ${phrases.map((p, index) => {\r\n            const uniqueId = `btn-audio-${cat.replace(/\\s+/g, '-')}-${index}`;\r\n            const audioFile = p.audio || '';\r\n            const safeAudio = audioFile.replace(/'/g, \"\\\\'\");\r\n            return `\r\n                                <div class=\"language-card-2026\" onclick=\"playAudio('${safeAudio}', '${uniqueId}')\">\r\n                                    <div class=\"language-content\">\r\n                                        <div class=\"lang-fr\">${p.fr || p.francais}</div>\r\n                                        <div class=\"lang-phonetic\">${p.phonetic || ''}</div>\r\n                                        <div class=\"lang-mg\">${p.mg || p.malgache}</div>\r\n                                    </div>\r\n                                    <div id=\"${uniqueId}\" class=\"btn-play-audio-2026\">\r\n                                        <i class=\"fas fa-play\"></i>\r\n                                    </div>\r\n                                </div>`;\r\n        }).join('')}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        `;\r\n    });\r\n\r\n    gridContainer.innerHTML = html;\r\n\r\n    if (window.GasikaraAnimations && typeof window.GasikaraAnimations.init === 'function') {\r\n        window.GasikaraAnimations.init();\r\n    }\r\n};\r\n\r\n// Global filter function (Dropdown Logic)\r\nwindow.filterLanguages = function (query) {\r\n    const term = query.toLowerCase().trim();\r\n    const dropdown = document.getElementById('langSearchResults');\r\n    if (!dropdown) return;\r\n\r\n    if (!term) {\r\n        dropdown.classList.remove('active');\r\n        return;\r\n    }\r\n\r\n    // Flatten Search\r\n    let allPhrases = [];\r\n    Object.entries(window.PHRASES_DATA).forEach(([cat, phrases]) => {\r\n        phrases.forEach((p, idx) => {\r\n            allPhrases.push({ ...p, cat, idx });\r\n        });\r\n    });\r\n\r\n    const matches = allPhrases.filter(p => {\r\n        return (p.fr && p.fr.toLowerCase().includes(term)) ||\r\n            (p.mg && p.mg.toLowerCase().includes(term));\r\n    });\r\n\r\n    if (matches.length === 0) {\r\n        dropdown.innerHTML = `\r\n            <div class=\"search-result-item\" style=\"cursor:default;\">\r\n                <div class=\"search-result-info\">\r\n                    <h4 style=\"color:white;\">Aucun r√©sultat</h4>\r\n                    <p>Essayez un autre mot...</p>\r\n                </div>\r\n            </div>`;\r\n    } else {\r\n        dropdown.innerHTML = matches.map(p => {\r\n            const uniqueId = `search-drop-${p.idx}`;\r\n            const audioFile = p.audio || '';\r\n            const safeAudio = audioFile.replace(/'/g, \"\\\\'\");\r\n\r\n            // Use item styling similar to Home search but adapted for Audio\r\n            return `\r\n                <div class=\"search-result-item\" onclick=\"playAudio('${safeAudio}', '${uniqueId}'); event.stopPropagation();\">\r\n                    <div class=\"search-result-thumb\" style=\"background:var(--laterite-2026); display:flex; align-items:center; justify-content:center;\">\r\n                        <i class=\"fas fa-volume-up\" style=\"color:white;\"></i>\r\n                    </div>\r\n                    <div class=\"search-result-info\">\r\n                        <h4 style=\"color:white;\">${p.fr || p.francais}</h4>\r\n                        <p style=\"color:#ccc;\">${p.mg || p.malgache} <span style=\"font-size:0.75em; opacity:0.6\">(${p.cat})</span></p>\r\n                    </div>\r\n                    <div id=\"${uniqueId}\" style=\"margin-left:auto; color:var(--laterite-2026);\">\r\n                        <i class=\"fas fa-play-circle\" style=\"font-size:1.5rem;\"></i>\r\n                    </div>\r\n                </div>`;\r\n        }).join('');\r\n    }\r\n\r\n    dropdown.classList.add('active');\r\n}\r\n\r\n// Global Audio State\r\nwindow.currentAudio = null;\r\nwindow.currentBtnId = null;\r\n\r\nwindow.playAudio = function (filename, btnId) {\r\n    if (!filename) {\r\n        alert(\"Audio indisponible.\");\r\n        return;\r\n    }\r\n\r\n    // Stop currently playing\r\n    if (window.currentAudio) {\r\n        window.currentAudio.pause();\r\n        window.currentAudio.currentTime = 0;\r\n\r\n        // Reset previous UI\r\n        if (window.currentBtnId) {\r\n            const prevBtns = document.querySelectorAll(`[id=\"${window.currentBtnId}\"]`);\r\n            prevBtns.forEach(btn => {\r\n                if (btn.classList.contains('btn-play-audio-2026')) {\r\n                    btn.classList.remove('playing');\r\n                    btn.innerHTML = '<i class=\"fas fa-play\"></i>';\r\n                } else {\r\n                    // Dropdown icon reset\r\n                    btn.innerHTML = '<i class=\"fas fa-play-circle\" style=\"font-size:1.5rem;\"></i>';\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    const audioPath = `audio/${filename}`;\r\n    const audio = new Audio(audioPath);\r\n\r\n    // UI Update for CURRENT target\r\n    const clickedBtn = document.getElementById(btnId);\r\n    if (clickedBtn) {\r\n        if (clickedBtn.classList.contains('btn-play-audio-2026')) {\r\n            clickedBtn.classList.add('playing');\r\n            clickedBtn.innerHTML = '<i class=\"fas fa-volume-up\"></i>';\r\n        } else {\r\n            // Dropdown style\r\n            clickedBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\" style=\"font-size:1.5rem;\"></i>';\r\n        }\r\n    }\r\n\r\n    audio.play().then(() => {\r\n        // Playing\r\n        if (clickedBtn && !clickedBtn.classList.contains('btn-play-audio-2026')) {\r\n            clickedBtn.innerHTML = '<i class=\"fas fa-stop-circle\" style=\"font-size:1.5rem;\"></i>';\r\n        }\r\n    }).catch(e => {\r\n        console.error(\"Audio error\", e);\r\n        if (clickedBtn) {\r\n            clickedBtn.classList.remove('playing');\r\n            clickedBtn.innerHTML = '<i class=\"fas fa-exclamation-triangle\"></i>';\r\n        }\r\n    });\r\n\r\n    audio.onended = function () {\r\n        if (clickedBtn) {\r\n            if (clickedBtn.classList.contains('btn-play-audio-2026')) {\r\n                clickedBtn.classList.remove('playing');\r\n                clickedBtn.innerHTML = '<i class=\"fas fa-play\"></i>';\r\n            } else {\r\n                clickedBtn.innerHTML = '<i class=\"fas fa-play-circle\" style=\"font-size:1.5rem;\"></i>';\r\n            }\r\n        }\r\n        window.currentAudio = null;\r\n        window.currentBtnId = null;\r\n    };\r\n\r\n    window.currentAudio = audio;\r\n    window.currentBtnId = btnId;\r\n}\r\n\r\n\r\n/* ============================================\r\n   X. CIRCUITS & ITINERAIRES (RESTORED)\r\n   ============================================ */\r\n/* ============================================\r\n   X. CIRCUITS & ITINERAIRES (RESTORED & ENHANCED)\r\n   ============================================ */\r\nwindow.initItinerariesPage = function () {\r\n    const listContainer = document.getElementById('itineraires-list');\r\n    if (!listContainer) return;\r\n\r\n    if (!window.ITINERAIRES_DATA) {\r\n        listContainer.innerHTML = '<p style=\"padding:20px; text-align:center;\">Chargement des circuits...</p>';\r\n        return;\r\n    }\r\n\r\n    // Always convert to array for consistent indexing\r\n    const itineraries = Array.isArray(window.ITINERAIRES_DATA) ? window.ITINERAIRES_DATA : Object.values(window.ITINERAIRES_DATA);\r\n\r\n    listContainer.innerHTML = itineraries.map((itin, index) => {\r\n        // Safe Property Access\r\n        const title = itin.nom || itin.titre || 'Circuit Inconnu';\r\n        // Get generic price or range\r\n        const price = itin.budgets && itin.budgets.standard ? itin.budgets.standard.price : (itin.budget || 'Sur devis');\r\n        // Image Fallback\r\n        const img = itin.image || 'images/placeholders/default.jpg';\r\n\r\n        return `\r\n        <article class=\"lieu-card\" onclick=\"showItineraryDetails(${index})\" style=\"cursor: pointer;\">\r\n            <div class=\"lieu-image\" style=\"height:200px; position:relative;\">\r\n                <img src=\"${img}\" alt=\"${title}\" \r\n                     style=\"width:100%; height:100%; object-fit:cover;\"\r\n                     onerror=\"this.src='images/placeholders/default.jpg'\">\r\n                <div class=\"lieu-badge\" style=\"position:absolute; bottom:10px; left:10px; background:var(--laterite); color:white; padding:4px 12px; border-radius:4px; font-weight:bold;\">\r\n                    ${itin.duree}\r\n                </div>\r\n            </div>\r\n            <div class=\"lieu-content\" style=\"padding:15px;\">\r\n                <div style=\"display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px;\">\r\n                    <h3 style=\"margin:0; font-size:1.1rem; color:var(--text-primary); font-family:var(--font-display);\">${title}</h3>\r\n                    <span style=\"background:var(--bg-secondary); padding:2px 8px; border-radius:4px; font-size:0.8rem; font-weight:600;\">${price}</span>\r\n                </div>\r\n                <p style=\"font-size:0.9rem; color:var(--text-secondary); margin-bottom:15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;\">\r\n                    ${itin.description}\r\n                </p>\r\n                <button class=\"btn-action-primary\" style=\"width:100%;\">Voir le d√©tail</button>\r\n            </div>\r\n        </article>\r\n        `;\r\n    }).join('');\r\n};\r\n\r\n/**\r\n * G√©n√®re l'accord√©on Infos Pratiques en PLEINE LARGEUR avec grille 3 colonnes\r\n */\r\n/**\r\n * G√©n√®re l'accord√©on Infos Pratiques Premium - FULL WIDTH\r\n * Compatible avec les styles ajout√©s dans css/styles-premium.css (Step 603)\r\n */\r\nwindow.generateStepPracticalInfo = function (day) {\r\n    const hasFood = day.gourmandise;\r\n    const hasAccom = day.hebergement_options && (\r\n        typeof day.hebergement_options === 'string' ||\r\n        (Array.isArray(day.hebergement_options) ? day.hebergement_options.length > 0 : Object.keys(day.hebergement_options).length > 0)\r\n    );\r\n    const hasAdvice = day.astuce;\r\n\r\n    if (!hasFood && !hasAccom && !hasAdvice) {\r\n        return '';\r\n    }\r\n\r\n    return `\r\n    <div class=\"step-accordion step-accordion-premium\">\r\n      <button class=\"step-accordion-header\" onclick=\"window.toggleStepAccordion(this)\" aria-expanded=\"true\">\r\n        <div class=\"step-accordion-header-main\">\r\n          <div class=\"step-accordion-icon step-accordion-icon-premium\">\r\n            <i class=\"fas fa-info\"></i>\r\n          </div>\r\n          <h4 class=\"step-accordion-title\">Infos Pratiques de l'√âtape</h4>\r\n        </div>\r\n        <i class=\"fas fa-chevron-down step-accordion-chevron\"></i>\r\n      </button>\r\n      \r\n      <div class=\"step-practical-content step-practical-content-premium\">\r\n        ${hasFood ? `\r\n          <details class=\"sub-accordion\">\r\n            <summary>\r\n              <i class=\"fas fa-utensils\"></i>\r\n              <div>\r\n                <strong>Instant Gourmand</strong>\r\n                <span>O√π bien manger sans se tromper</span>\r\n              </div>\r\n            </summary>\r\n            <div class=\"sub-accordion-content\">${day.gourmandise}</div>\r\n          </details>\r\n        ` : ''}\r\n        \r\n        ${hasAccom ? `\r\n          <details class=\"sub-accordion\">\r\n            <summary>\r\n              <i class=\"fas fa-hotel\"></i>\r\n              <div>\r\n                <strong>O√π poser ses valises ?</strong>\r\n                <span>Nos adresses test√©es et approuv√©es</span>\r\n              </div>\r\n            </summary>\r\n            <div class=\"sub-accordion-content\">\r\n              ${window.getAccomPreviewText ? window.getAccomPreviewText(day.hebergement_options) : (typeof day.hebergement_options === 'string' ? day.hebergement_options : 'Voir les options')}\r\n            </div>\r\n          </details>\r\n        ` : ''}\r\n        \r\n        ${hasAdvice ? `\r\n          <details class=\"sub-accordion\">\r\n            <summary>\r\n              <i class=\"fas fa-lightbulb\"></i>\r\n              <div>\r\n                <strong>Le Conseil Expert</strong>\r\n                <span>Le petit hack qui change tout</span>\r\n              </div>\r\n            </summary>\r\n            <div class=\"sub-accordion-content\">${day.astuce}</div>\r\n          </details>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n};\r\n\r\n// Toggle Function for new Premium Accordion\r\nwindow.toggleStepAccordion = function (btn) {\r\n    const container = btn.closest('.step-accordion');\r\n\r\n    // Toggle la classe 'open'\r\n    const isOpen = container.classList.contains('open');\r\n    container.classList.toggle('open');\r\n\r\n    // Mettre √† jour aria-expanded\r\n    btn.setAttribute('aria-expanded', !isOpen);\r\n\r\n    // Mettre √† jour aria-hidden sur le contenu\r\n    const content = container.querySelector('.step-practical-content');\r\n    if (content) {\r\n        content.setAttribute('aria-hidden', isOpen);\r\n    }\r\n\r\n    // Feedback haptique (mobile)\r\n    if (navigator.vibrate) {\r\n        navigator.vibrate(10);\r\n    }\r\n};\r\n\r\n// Helper for Accomodation Text (idempotent check)\r\nwindow.getAccomPreviewText = window.getAccomPreviewText || function (options) {\r\n    if (!options) return '';\r\n    if (typeof options === 'string') return options;\r\n    return options.standard || (options.premium ? (options.premium.text || options.premium) : '') || (options.eco || '');\r\n};\r\n\r\nwindow.showItineraryDetails = function (index) {\r\n    // Critical: Re-derive array to match the index passed from initItinerariesPage\r\n    const itineraries = Array.isArray(window.ITINERAIRES_DATA) ? window.ITINERAIRES_DATA : Object.values(window.ITINERAIRES_DATA);\r\n    const itin = itineraries[index];\r\n\r\n    if (!itin) {\r\n        console.error(\"Itinerary not found for index:\", index);\r\n        return;\r\n    }\r\n\r\n    const list = document.getElementById('itineraires-list');\r\n    const detail = document.getElementById('itineraire-detail');\r\n    const content = document.getElementById('itineraire-content');\r\n\r\n    if (!list || !detail || !content) return;\r\n\r\n    // Safe Data Extraction\r\n    const title = itin.nom || itin.titre || 'D√©tails du Circuit';\r\n    const price = itin.budgets && itin.budgets.standard ? itin.budgets.standard.price : (itin.budget || 'Sur devis');\r\n    const descFull = itin.description_full || itin.description;\r\n\r\n    // Logistique Data (FAQ)\r\n    const logistique = itin.logistique_generale || {};\r\n    const infos = itin.infos || {};\r\n\r\n    // 1. Build Stages Accordion (Premium Timeline Style)\r\n    let stagesHtml = '<div class=\"timeline-container\">';\r\n    let routePoints = []; // For the map (unused now but kept for safety if ref needed later, or remove)\r\n\r\n    // Note: Old routePoints map removed in favor of visual timeline\r\n\r\n    if (itin.etapes && Array.isArray(itin.etapes)) {\r\n        stagesHtml += itin.etapes.map((step, dayIdx) => {\r\n            const stepTitle = typeof step === 'string' ? step : (step.titre || `Jour ${step.jour}`);\r\n            const stepDesc = typeof step === 'string' ? '' : (step.description_expert || step.description || ''); // Prefer Expert Desc\r\n            const stepLogistique = (typeof step === 'object' && step.logistique) ? step.logistique : null;\r\n\r\n            // Image Lookup for Thumbnail & Content\r\n            let stepImage = 'images/placeholders/default.jpg';\r\n            let firstLieuId = null;\r\n            let locationName = \"Voir Lieu\";\r\n\r\n            if (typeof step === 'object' && step.lieux_ids && step.lieux_ids.length > 0) {\r\n                firstLieuId = step.lieux_ids[0];\r\n                // Ensure LIEUX_DATA is available\r\n                const allLieux = window.LIEUX_DATA || [];\r\n                const lieu = allLieux.find(l => l.id == firstLieuId); // Coercive check (string vs int)\r\n\r\n                if (lieu) {\r\n                    if (lieu.image) stepImage = lieu.image;\r\n                    locationName = lieu.ville || lieu.nom;\r\n                } else {\r\n                    console.warn(`Itineraire Debug: Lieu ID ${firstLieuId} not found in LIEUX_DATA (${allLieux.length} items).`);\r\n                }\r\n            }\r\n\r\n            // More details for Accordion Content (V3 Refactor)\r\n            let detailsHtml = window.generateStepPracticalInfo ? window.generateStepPracticalInfo(step) : '';\r\n\r\n            // Image Click Handler (Safe)\r\n            const imageClickAction = firstLieuId ? `onclick=\"event.stopPropagation(); window.showLieuDetailsByID(${firstLieuId})\"` : '';\r\n            const cardClickAction = firstLieuId ? `onclick=\"window.showLieuDetailsByID(${firstLieuId})\"` : '';\r\n\r\n            // Incontournables List\r\n            let incHtml = '';\r\n            if (step.incontournables && Array.isArray(step.incontournables)) {\r\n                incHtml = `\r\n                    <div style=\"margin-top:12px;\">\r\n                        <strong style=\"font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; color:var(--laterite);\">√Ä ne pas manquer:</strong>\r\n                        <ul style=\"margin:5px 0 0 20px; font-size:0.9rem; color:var(--text-secondary);\">\r\n                            ${step.incontournables.map(i => `<li>${typeof i === 'string' ? i : i.label}</li>`).join('')}\r\n                        </ul>\r\n                    </div>`;\r\n            }\r\n\r\n            return `\r\n            <div class=\"timeline-step\">\r\n                <div class=\"timeline-marker\"></div>\r\n                <div class=\"timeline-card\">\r\n                    <!-- HEADER -->\r\n                    <div class=\"timeline-header\" onclick=\"this.parentElement.parentElement.classList.toggle('active')\">\r\n                        <div class=\"timeline-day\">J${step.jour || dayIdx + 1}</div>\r\n                        <div class=\"timeline-title\">${stepTitle}</div>\r\n                        \r\n                        <!-- Thumbnail (Clickable) -->\r\n                        <div class=\"timeline-thumb-container\" ${imageClickAction} title=\"Voir le lieu\">\r\n                            <img src=\"${stepImage}\" class=\"timeline-thumb\" alt=\"Etape\" onerror=\"this.style.display='none'\">\r\n                        </div>\r\n                        \r\n                        <i class=\"fas fa-chevron-down timeline-chevron\"></i>\r\n                    </div>\r\n\r\n                    <!-- CONTENT -->\r\n                    <div class=\"timeline-content\">\r\n                        <div class=\"timeline-body\">\r\n                            <div class=\"timeline-body-text\">\r\n                                <p style=\"margin-bottom:10px; font-style:italic;\">\"${step.astuce || 'Profitez de cette √©tape...'}\"</p>\r\n                                <p style=\"margin-bottom:10px;\">${stepDesc}</p>\r\n                                ${incHtml}\r\n                                ${detailsHtml}\r\n                            </div>\r\n\r\n                            <!-- Large Image (Clickable) -->\r\n                            <div class=\"timeline-body-image-container\" ${cardClickAction}>\r\n                                <img src=\"${stepImage}\" class=\"timeline-body-image\" alt=\"Visualisation Etape\" onerror=\"this.src='images/placeholders/default.jpg'\">\r\n                                <div class=\"timeline-body-image-overlay\">\r\n                                    <i class=\"fas fa-map-pin\"></i> ${locationName}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>`;\r\n        }).join('');\r\n        stagesHtml += '</div>'; // End container\r\n    }\r\n\r\n    // 2. Generate CSS Map (Timeline Style)\r\n    // Redundant with new Timeline UI - ensuring clean state\r\n    let mapHtml = '';\r\n    // Legacy code removed\r\n\r\n\r\n    // 3. Build FAQ / Accordion\r\n    const faqHtml = `\r\n        <div class=\"accordion-v3\" style=\"margin-top:20px;\">\r\n            <div class=\"accordion-item\">\r\n                <button class=\"accordion-trigger\" aria-expanded=\"false\" onclick=\"window.toggleAccordionV3(this)\">\r\n                    <div class=\"accordion-header-content\">\r\n                        <div class=\"icon-wrapper\"><i class=\"fas fa-info-circle\"></i></div>\r\n                        <div class=\"accordion-text\">\r\n                            <div class=\"accordion-heading\">Infos Pratiques & FAQ</div>\r\n                            <div class=\"accordion-subtitle\">Logistique du circuit</div>\r\n                        </div>\r\n                    </div>\r\n                    <i class=\"fas fa-chevron-down chevron\"></i>\r\n                </button>\r\n                <div class=\"accordion-body\" aria-hidden=\"true\">\r\n                    <div class=\"accordion-inner\">\r\n                        <ul style=\"list-style:none; padding:0; margin:0;\">\r\n                            ${logistique.saison_ideale ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-sun\"></i> Saison Id√©ale:</strong> ${logistique.saison_ideale}</li>` : ''}\r\n                            ${logistique.vehicule_conseil ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-car-side\"></i> Transport:</strong> ${logistique.vehicule_conseil}</li>` : ''}\r\n                            ${logistique.route_etat ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-road\"></i> √âtat de la route:</strong> ${logistique.route_etat}</li>` : ''}\r\n                            ${infos.securite_level ? `<li style=\"margin-bottom:10px;\"><strong><i class=\"fas fa-shield-alt\"></i> S√©curit√©:</strong> ${infos.securite_level}</li>` : ''}\r\n                            ${infos.description_fun ? `<li style=\"margin-top:15px; font-style:italic; color:var(--laterite);\">\"${infos.description_fun}\"</li>` : ''}\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // 4. Render Full View\r\n    content.innerHTML = `\r\n        <div class=\"itin-header\" style=\"margin-bottom:20px;\">\r\n            <img src=\"${itin.image || 'images/placeholders/default.jpg'}\" style=\"width:100%; height:250px; object-fit:cover; border-radius:12px; margin-bottom:15px; box-shadow:var(--shadow-sm);\">\r\n            \r\n            <h2 style=\"color:var(--laterite); margin-bottom:10px; font-family:var(--font-display);\">${title}</h2>\r\n            \r\n            <div style=\"display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:20px; font-size:0.95rem; color:var(--text-secondary);\">\r\n                <span class=\"badge-pill\"><i class=\"fas fa-clock\"></i> ${itin.duree}</span>\r\n                <span class=\"badge-pill\"><i class=\"fas fa-wallet\"></i> ${price}</span>\r\n                <span class=\"badge-pill\"><i class=\"fas fa-users\"></i> Familial & Aventure</span>\r\n            </div>\r\n\r\n            <p style=\"font-size:1rem; line-height:1.6; margin-bottom:25px;\">${descFull}</p>\r\n\r\n            <div id=\"itinerary-dynamic-map\" style=\"height: 400px; width: 100%; border-radius: 12px; margin-bottom: 25px; box-shadow: var(--shadow-sm); z-index: 1; border:1px solid var(--border-color);\"></div>\r\n\r\n            ${faqHtml}\r\n        </div>\r\n        \r\n        <div class=\"itin-stages\">\r\n            <h3 style=\"border-bottom:1px solid var(--border-color); padding-bottom:10px; margin-bottom:20px;\">Itin√©raire Jour par Jour</h3>\r\n            ${stagesHtml}\r\n        </div>\r\n        \r\n        <div style=\"margin-top:30px; text-align:center;\">\r\n             <button class=\"btn-action-primary\" onclick=\"alert('R√©servation bient√¥t disponible !')\" style=\"padding:15px 30px; font-size:1.1rem; box-shadow:var(--shadow-md);\">\r\n                <i class=\"fas fa-paper-plane\"></i> Demander un Devis Gratuit\r\n             </button>\r\n        </div>\r\n    `;\r\n\r\n    // Swap Views\r\n    list.style.display = 'none';\r\n    detail.style.display = 'block';\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n\r\n    // 5. Initialize Dynamic Map\r\n    setTimeout(() => {\r\n        if (window.initItineraryMap) {\r\n            window.initItineraryMap(itin.etapes);\r\n        }\r\n    }, 100); // Short delay to ensure DOM is ready\r\n};\r\n\r\nwindow.backToItineraries = function () {\r\n    const list = document.getElementById('itineraires-list');\r\n    const detail = document.getElementById('itineraire-detail');\r\n    if (list && detail) {\r\n        detail.style.display = 'none';\r\n        list.style.display = 'grid'; // Grid!\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n};\r\n\r\n/* ============================================\r\n   6. SPOTS & DATA RECOVERY\r\n   ============================================ */\r\nwindow.initSpotsPage = function () {\r\n    const spotsContainer = document.getElementById('spotsContainer');\r\n    if (!spotsContainer) return;\r\n\r\n    console.log(\"üîç INIT SPOT PAGE (STRICT MODE)...\");\r\n    if (!window.LIEUX_DATA) {\r\n        console.warn(\"‚ùå LIUEX_DATA missing in initSpotsPage\");\r\n        return;\r\n    }\r\n\r\n    // üîí STRICT FILTER: ONLY Secret/Authentic Spots\r\n    // Must have 'secret_spot' tag (added by surgical update)\r\n    const spots = window.LIEUX_DATA.filter(l =>\r\n        l.tags && l.tags.includes('secret_spot')\r\n    );\r\n\r\n    console.log(`üïµÔ∏è Spots Page: Found ${spots.length} authentic secret spots.`);\r\n\r\n    if (spots.length === 0) {\r\n        spotsContainer.innerHTML = \"<div style='text-align:center; padding:40px; color:var(--text-secondary);'>Aucun spot secret trouv√© (Tag missing?).</div>\";\r\n    } else {\r\n        spotsContainer.innerHTML = spots.map(lieu => {\r\n            // Force Type Display for Card\r\n            lieu._forceDisplayType = \"Spot Local\";\r\n            return createLieuCard(lieu, 'spot');\r\n        }).join('');\r\n    }\r\n\r\n    // GSAP\r\n    if (window.GasikaraAnimations) window.GasikaraAnimations.init();\r\n}\r\n\r\n/**\r\n * Filter Spots by Region (Ville)\r\n * @param {string} region - Name of the city/province (e.g. 'Diego-Suarez') or 'all'\r\n * @param {HTMLElement} btn - The button element clicked\r\n */\r\nwindow.filterSpotsByRegion = function (region, btn) {\r\n    // 1. Update UI (Active Button)\r\n    if (btn) {\r\n        const container = btn.closest('.province-filter-container');\r\n        if (container) {\r\n            container.querySelectorAll('.nav-pill').forEach(b => b.classList.remove('active'));\r\n            btn.classList.add('active');\r\n        }\r\n    }\r\n\r\n    // 2. Filter Items in DOM\r\n    const spotsContainer = document.getElementById('spotsContainer');\r\n    if (!spotsContainer) return;\r\n\r\n    const cards = spotsContainer.querySelectorAll('.lieu-card');\r\n\r\n    // Animate Out\r\n    // We can just hide/show for simplicity or better, filter logic\r\n    let count = 0;\r\n\r\n    cards.forEach(card => {\r\n        // Use data-ville for reliable filtering\r\n        const itemVille = (card.dataset.ville || '').toLowerCase().trim();\r\n        const regionKey = region.toLowerCase();\r\n\r\n        let show = false;\r\n        if (regionKey === 'all') {\r\n            show = true;\r\n        } else {\r\n            // Check inclusions directly against the data attribute\r\n            if (itemVille.includes(regionKey)) {\r\n                show = true;\r\n            }\r\n            // Mappings (Handle variations in naming)\r\n            if (regionKey === 'antananarivo' && itemVille.includes('tana')) show = true;\r\n            if (regionKey === 'mahajanga' && itemVille.includes('majunga')) show = true;\r\n            if (regionKey === 'toamasina' && itemVille.includes('tamatave')) show = true;\r\n            if (regionKey === 'toliara' && (itemVille.includes('tul√©ar') || itemVille.includes('tulear'))) show = true;\r\n            if (regionKey === 'fianarantsoa' && itemVille.includes('fianar')) show = true;\r\n        }\r\n\r\n        if (show) {\r\n            card.style.display = 'block';\r\n            card.style.animation = `fadeInUp 0.3s ease forwards ${count * 0.05}s`;\r\n            count++;\r\n        } else {\r\n            card.style.display = 'none';\r\n        }\r\n    });\r\n\r\n    // Optional: Show empty state if count === 0\r\n}\r\n\r\n/* ============================================\r\n   7. PROVINCE & CITY PAGES (RESTORED logic)\r\n   ============================================ */\r\n\r\nwindow.initCityPages = function () {\r\n    // 1. HYDRATION: Populate grids with data from LIEUX_DATA\r\n    renderCityData();\r\n\r\n    // 2. Filter logic for ALL province sections\r\n    const citySections = document.querySelectorAll('.province-section, .page-section');\r\n\r\n    citySections.forEach(section => {\r\n        // Exclude non-city sections like home/outils\r\n        if (!section.id.startsWith('page-')) return;\r\n        const cityKey = section.id.replace('page-', ''); // e.g., 'diego', 'nosybe'\r\n\r\n        // Skip \"special\" pages that use page- logic but aren't cities\r\n        const ignored = ['circuit', 'itineraires', 'langue', 'outils', 'carte', 'spots'];\r\n        if (ignored.some(k => cityKey.includes(k))) return;\r\n\r\n        // A. Init Filters\r\n        const btnAll = section.querySelector('.nav-pill'); // Default first pill\r\n        if (btnAll) {\r\n            filterProvinceItems(cityKey, 'all', btnAll);\r\n        }\r\n\r\n        // B. Update premium info\r\n        updatePremiumInfo(getCityNameFromKey(cityKey), cityKey);\r\n\r\n        // C. Inject Budget Buttons (Only if missing)\r\n        const navPills = section.querySelector('.nav-pills');\r\n        if (navPills && !section.querySelector('.budget-pills-container')) {\r\n            // Create budget buttons container\r\n            const budgetContainer = document.createElement('div');\r\n            budgetContainer.className = 'budget-pills-container';\r\n            budgetContainer.style.cssText = 'margin-top: 16px; margin-bottom: 20px;';\r\n\r\n            // Title\r\n            const title = document.createElement('div');\r\n            title.className = 'filter-title';\r\n            title.style.cssText = 'font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 10px; text-align: center;';\r\n            title.innerHTML = '<i class=\"fas fa-wallet\"></i> Budget';\r\n            budgetContainer.appendChild(title);\r\n\r\n            // Pills container\r\n            const pills = document.createElement('div');\r\n            pills.className = 'nav-pills';\r\n            pills.style.justifyContent = 'center';\r\n\r\n            // Create 3 buttons\r\n            const budgets = [\r\n                { level: '1', label: '‚Ç¨', desc: '(- 25k)', icon: 'fa-coins' },\r\n                { level: '2', label: '‚Ç¨‚Ç¨', desc: '(25k-80k)', icon: 'fa-money-bill-wave' },\r\n                { level: '3', label: '‚Ç¨‚Ç¨‚Ç¨', desc: '(+ 80k)', icon: 'fa-gem' }\r\n            ];\r\n\r\n            budgets.forEach(b => {\r\n                const btn = document.createElement('button');\r\n                btn.className = 'budget-btn nav-pill';\r\n                btn.setAttribute('data-level', b.level);\r\n                btn.onclick = function () { toggleProvinceBudget(cityKey, b.level, this); };\r\n                btn.innerHTML = `<i class=\"fas ${b.icon}\"></i> ${b.label} <span style=\"font-size: 0.75rem; opacity: 0.8;\">${b.desc}</span>`;\r\n                pills.appendChild(btn);\r\n            });\r\n\r\n            budgetContainer.appendChild(pills);\r\n            navPills.parentNode.insertBefore(budgetContainer, navPills.nextSibling);\r\n        }\r\n    });\r\n};\r\n\r\n/* ============================================\r\n   NEW: HYDRATION LOGIC (Fixing Empty Pages)\r\n   ============================================ */\r\nwindow.renderCityData = function () {\r\n    // --- SECURITY FALLBACK START (AXIS A) ---\r\n    // Si la fonction re√ßoit des donn√©es vides, on force l'usage de la r√©serve globale.\r\n    let data = window.LIEUX_DATA;\r\n    if (!data || data.length === 0) {\r\n        console.warn(\"‚ö†Ô∏è Data vide d√©tect√©e. Bascule sur la r√©serve globale...\");\r\n        // Tente de r√©cup√©rer les donn√©es inject√©es pr√©c√©demment\r\n        data = window.LIEUX_DATA || window.initData || [];\r\n    }\r\n    console.log(\"üî• AFFICHAGE EN COURS : \" + (data ? data.length : 0) + \" fiches.\");\r\n    // --- SECURITY FALLBACK END ---\r\n\r\n    console.log(\"1. Fonction Render appel√©e.\");\r\n    // Log container check\r\n    const checkId = 'grid-Mahajanga';\r\n    const containerCheck = document.getElementById(checkId);\r\n    console.log(`2. Test Target ID '${checkId}' found?`, containerCheck);\r\n\r\n    if (!window.LIEUX_DATA) return;\r\n\r\n    // DEBUG: INVENTAIRE STRICT (173 Items Required)\r\n    console.log(\"üî• INVENTAIRE TOTAL :\", window.LIEUX_DATA.length);\r\n    if (window.LIEUX_DATA.length !== 173) {\r\n        console.error(`üö® ALERT: DATA MISMATCH. FOUND ${window.LIEUX_DATA.length} (Expected 173)`);\r\n    } else {\r\n        console.log(\"‚úÖ DATA INTEGRITY VERIFIED: 173 ITEMS.\");\r\n    }\r\n\r\n\r\n    // Clear all grids first\r\n    // Note: Keys match the 'ville' property in data/lieux.js OR mapped via logic\r\n    const citiesStub = {\r\n        'Diego-Suarez': 'Antsiranana',\r\n        'Antsiranana': 'Antsiranana',\r\n        'Nosy Be': 'NosyBe', 'Nosy-Be': 'NosyBe',\r\n        'Mahajanga': 'Mahajanga', 'Majunga': 'Mahajanga',\r\n        'Antananarivo': 'Antananarivo', 'Tana': 'Antananarivo',\r\n        'Toamasina': 'Toamasina', 'Tamatave': 'Toamasina',\r\n        'Fianarantsoa': 'Fianarantsoa', 'Fianar': 'Fianarantsoa',\r\n        'Toliara': 'Toliara', 'Tul√©ar': 'Toliara', 'Tulear': 'Toliara',\r\n        // MISSING CITIES MAPPED TO HUBS\r\n        'Isalo': 'Toliara', 'Ifaty': 'Toliara', 'Anakao': 'Toliara',\r\n        'Andasibe': 'Toamasina', 'Mananara': 'Toamasina',\r\n        'Sainte-Marie': 'Saintemarie', 'Ile aux Nattes': 'Saintemarie', // New Independent Hub\r\n        'Ankarana': 'Antsiranana', 'Sambava': 'Antsiranana', 'Antalaha': 'Antsiranana', 'Voh√©mar': 'Antsiranana', 'Ambilobe': 'Antsiranana',\r\n        // NEW ORPHANS\r\n        'Ampefy': 'Antananarivo', 'Antsirabe': 'Antananarivo',\r\n        'Anivorano': 'Antsiranana', 'Ambanja': 'Antsiranana',\r\n        'Ramena': 'Antsiranana', 'Joffreville': 'Antsiranana'\r\n    };\r\n\r\n    // Clean containers\r\n    Object.values(citiesStub).forEach(id => {\r\n        const el = document.getElementById(`grid-${id}`);\r\n        if (el) el.innerHTML = '';\r\n    });\r\n\r\n    // Populate\r\n    let count = 0;\r\n    if (!window.LIEUX_DATA || window.LIEUX_DATA.length === 0) {\r\n        console.warn(\"‚ö†Ô∏è LIEUX_DATA is empty in renderCityData!\");\r\n    } else {\r\n        window.LIEUX_DATA.forEach(lieu => {\r\n            let v = lieu.ville ? lieu.ville.trim() : 'Inconnu';\r\n\r\n            // NORD LOGIC: Both Diego and Nosy Be go to Antsiranana (The Hub) - Logic Adjusted\r\n            // Using citiesStub for mapping\r\n            let stubKey = Object.keys(citiesStub).find(k => k.toLowerCase() === v.toLowerCase());\r\n            let gridId = citiesStub[v] || (stubKey ? citiesStub[stubKey] : null);\r\n\r\n            // Specific overrides for consistency with index.html IDs\r\n            if (v === 'Diego-Suarez') gridId = 'Antsiranana';\r\n            if (v === 'Nosy Be' || v === 'Nosy-Be') gridId = 'NosyBe';\r\n\r\n            // Target Grid\r\n            if (gridId) {\r\n                const grid = document.getElementById(`grid-${gridId}`);\r\n                if (grid) {\r\n                    if (typeof window.createLieuCard === 'function') {\r\n                        const card = window.createLieuCard(lieu);\r\n                        grid.insertAdjacentHTML('beforeend', card);\r\n                        count++;\r\n                    } else {\r\n                        console.error(\"createLieuCard missing!\", lieu);\r\n                    }\r\n                } else {\r\n                    // console.warn(`Grid not found for ID: grid-${gridId} (Ville: ${v})`);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    console.log(`‚úÖ Rendered ${count} locations across city grids.`);\r\n\r\n    // ‚ú® GSAP: Re-initialize animations after cards are rendered\r\n    if (window.GasikaraAnimations && typeof window.GasikaraAnimations.init === 'function') {\r\n        window.GasikaraAnimations.init();\r\n    }\r\n}\r\n\r\n// Helper for mapped names\r\nwindow.getCityNameFromKey = function (key) {\r\n    const map = {\r\n        'antananarivo': 'Antananarivo',\r\n        'antsiranana': 'Diego-Suarez',\r\n        'nosybe': 'Nosy Be',\r\n        'mahajanga': 'Mahajanga',\r\n        'toamasina': 'Toamasina',\r\n        'fianarantsoa': 'Fianarantsoa',\r\n        'toliara': 'Toliara',\r\n        'saintemarie': 'Sainte Marie'\r\n    };\r\n    return map[key] || key.charAt(0).toUpperCase() + key.slice(1);\r\n};\r\n\r\n/* ============================================\r\n   8. THEME MANAGER (Dark/Light)\r\n   ============================================ */\r\n\r\n\r\n\r\n\r\nwindow.filterProvinceItems = function (cityKey, filterType, btn) {\r\n    console.log(`üîç Filter Triggered: City=${cityKey}, Type=${filterType}`);\r\n\r\n    // 1. UI Update\r\n    const container = document.getElementById(`page-${cityKey}`);\r\n    if (!container) {\r\n        console.error(`‚ùå Container not found: page-${cityKey}`);\r\n        return;\r\n    }\r\n\r\n    // Fix: Toggle active on nav-pills\r\n    // We want to deactivate all \"category\" buttons, but keep \"budget\" buttons.\r\n    // Budget buttons call 'toggleProvinceBudget'. Category buttons call 'filterProvinceItems'.\r\n\r\n    const allPills = container.querySelectorAll('.nav-pill');\r\n    allPills.forEach(b => {\r\n        const onClickFn = b.getAttribute('onclick') || '';\r\n        if (onClickFn.includes('filterProvinceItems')) {\r\n            b.classList.remove('active');\r\n        }\r\n    });\r\n\r\n    if (btn) btn.classList.add('active');\r\n\r\n    // 2. Filter Logic\r\n    const items = container.querySelectorAll('.lieu-card');\r\n    console.log(`found ${items.length} items to filter in ${cityKey}`);\r\n    let count = 0;\r\n\r\n    items.forEach(item => {\r\n        const rawTags = (item.dataset.tags || '').toLowerCase(); // e.g., \"explorer,tana,‚Ç¨\"\r\n        const tags = rawTags.split(',');\r\n        let isMatch = false;\r\n\r\n        // Normalization for filters\r\n        if (filterType === 'all') isMatch = true;\r\n\r\n        // Categories (Check if tag exists)\r\n        else if (filterType === 'voir' || filterType === 'explorer') isMatch = tags.includes('explorer');\r\n        else if (filterType === 'manger') isMatch = tags.includes('manger');\r\n        else if (filterType === 'dodo' || filterType === 'dormir') isMatch = tags.includes('dormir');\r\n        else if (filterType === 'sortir') isMatch = tags.includes('sortir');\r\n        else if (filterType === 'spot') isMatch = tags.includes('spots');\r\n\r\n        // Debug\r\n        // console.log(`Item: ${item.dataset.id} | Tags: ${rawTags} | Match: ${isMatch}`);\r\n\r\n        // Budget Filter Check \r\n        if (isMatch) {\r\n            // Check if a budget button is active locally\r\n            const activeBudgetBtn = container.querySelector('[data-level].active');\r\n            if (activeBudgetBtn) {\r\n                const budgetLevel = activeBudgetBtn.dataset.level; // 1='‚Ç¨', 2='‚Ç¨‚Ç¨', 3='‚Ç¨‚Ç¨‚Ç¨'\r\n                const targetTag = budgetLevel === '1' ? 'budget_1' : (budgetLevel === '2' ? 'budget_2' : 'budget_3');\r\n\r\n                // If it doesn't match the specific budget, hide it (Strict filtering)\r\n                /* \r\n                   Wait, budget logic in `toggleProvinceBudget` typically works by *showing* items.\r\n                   Here we must intersect. \r\n                   If budget 1 is active, item MUST have '‚Ç¨'.\r\n                   But wait, `item.dataset.tags` stores symbols e.g. \"‚Ç¨\".\r\n                   `toLowerCase` turns it to \"‚Ç¨\".\r\n                */\r\n                if (!tags.includes(targetTag.toLowerCase())) {\r\n                    isMatch = false;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (isMatch) {\r\n            item.style.display = 'flex'; // Show card\r\n            count++;\r\n        } else {\r\n            item.style.display = 'none'; // Hide card\r\n        }\r\n    });\r\n    console.log(`‚úÖ Filter Result: ${count} visible items.`);\r\n\r\n    // 3. Empty State\r\n    const emptyMsg = container.querySelector('.empty-state-msg');\r\n    if (count === 0) {\r\n        if (!emptyMsg) {\r\n            const msg = document.createElement('div');\r\n            msg.className = 'empty-state-msg';\r\n            msg.style.gridColumn = '1/-1';\r\n            msg.style.padding = '40px';\r\n            msg.style.textAlign = 'center';\r\n            msg.innerHTML = '<i class=\"fas fa-search\" style=\"font-size:3rem; color:var(--text-secondary); margin-bottom:15px;\"></i><p>Aucune p√©pite trouv√©e dans cette cat√©gorie.</p>';\r\n            const grid = container.querySelector('.lieux-grid');\r\n            if (grid) grid.appendChild(msg);\r\n        } else {\r\n            emptyMsg.style.display = 'block';\r\n        }\r\n    } else {\r\n        if (emptyMsg) emptyMsg.style.display = 'none';\r\n    }\r\n};\r\n\r\nwindow.toggleProvinceBudget = function (cityKey, level, btn) {\r\n    const container = document.getElementById(`page-${cityKey}`);\r\n    if (!container) return;\r\n\r\n    // Toggle logic\r\n    const isActive = btn.classList.contains('active');\r\n    container.querySelectorAll('[data-level], .budget-btn').forEach(b => b.classList.remove('active'));\r\n\r\n    // Always activate the clicked button (even if was already active)\r\n    btn.classList.add('active');\r\n\r\n    // Re-run filter based on current active category\r\n    const activeCatBtn = container.querySelector('.nav-pill.active'); // Was .filter-btn\r\n    // Extract filter type from button logic or text\r\n    let filterType = 'all';\r\n    if (activeCatBtn) {\r\n        const txt = activeCatBtn.innerText.toLowerCase().trim();\r\n        if (txt.includes('explorer')) filterType = 'explorer';\r\n        else if (txt.includes('manger')) filterType = 'manger';\r\n        else if (txt.includes('dormir')) filterType = 'dormir';\r\n        else if (txt.includes('sortir')) filterType = 'sortir';\r\n        else if (txt.includes('spots')) filterType = 'spot';\r\n        else if (txt.includes('tout')) filterType = 'all';\r\n    }\r\n\r\n    // IMPORTANT: Call filter AFTER button state is updated\r\n    filterProvinceItems(cityKey, filterType, activeCatBtn);\r\n};\r\n\r\nfunction getCityNameFromKey(key) {\r\n    const map = { 'diego': 'Diego-Suarez', 'nosybe': 'Nosy Be', 'majunga': 'Majunga', 'tamatave': 'Tamatave', 'fianar': 'Fianarantsoa', 'tulear': 'Tul√©ar' };\r\n    return map[key] || key;\r\n}\r\n\r\n/* ============================================\r\n   CORE UI: CARDS & MODULES (Continued)\r\n   ============================================ */\r\n\r\nwindow.createLieuCard = function (lieu, category = '') {\r\n    // 1. Logic & Safety\r\n    // Use the normalized category from data first\r\n    if (!category) {\r\n        category = lieu.categorie || 'Explorer'; // Default fallback\r\n    }\r\n\r\n    const prixClass = lieu.prixNum === 0 ? 'gratuit' : lieu.prixNum < 10000 ? 'abordable' : 'premium';\r\n    const activeClass = window.isFavorite(lieu.id) ? 'active' : '';\r\n    const icon = window.isFavorite(lieu.id) ? '<i class=\"fa-solid fa-bookmark\"></i>' : '<i class=\"fa-regular fa-bookmark\"></i>';\r\n\r\n    // 2. Data Preparation\r\n    const tagsString = (lieu.tags || []).join(',');\r\n    const displayTags = (lieu.tags || [])\r\n        .filter(t => !t.startsWith('budget_')) // Exclure budget_X des tags visuels\r\n        .slice(0, 3)\r\n        .map(t => `<span class=\"card-tag\" style=\"background:rgba(0,0,0,0.05); padding:2px 8px; border-radius:12px; font-size:0.7rem; color:var(--text-secondary); border:1px solid var(--border-color);\">${t}</span>`)\r\n        .join('');\r\n\r\n    // Ajouter le badge budget VISUEL (‚Ç¨ ‚Ç¨‚Ç¨ ‚Ç¨‚Ç¨‚Ç¨)\r\n    let budgetBadge = '';\r\n    const budgetTag = (lieu.tags || []).find(t => t.startsWith('budget_'));\r\n    if (budgetTag === 'budget_1') budgetBadge = '<span class=\"budget-visual\" style=\"background:#27ae60; color:white; padding:3px 8px; border-radius:8px; font-size:0.75rem; font-weight:700;\">‚Ç¨</span>';\r\n    else if (budgetTag === 'budget_2') budgetBadge = '<span class=\"budget-visual\" style=\"background:#f39c12; color:white; padding:3px 8px; border-radius:8px; font-size:0.75rem; font-weight:700;\">‚Ç¨‚Ç¨</span>';\r\n    else if (budgetTag === 'budget_3') budgetBadge = '<span class=\"budget-visual\" style=\"background:#e74c3c; color:white; padding:3px 8px; border-radius:8px; font-size:0.75rem; font-weight:700;\">‚Ç¨‚Ç¨‚Ç¨</span>';\r\n\r\n    const displayTagsWithBudget = budgetBadge ? displayTags + budgetBadge : displayTags;\r\n\r\n    const isMustSee = lieu.type === 'Incontournable' || (lieu.tags && lieu.tags.includes('Incontournable'));\r\n\r\n    // Determine Badge Text\r\n    let badgeText = isMustSee ? 'Incontournable' : (lieu._forceDisplayType || lieu.type);\r\n\r\n    // Determine Badge Style & Icon\r\n    let badgeStyle = isMustSee ? 'background: #d35400; color: white;' : 'background: rgba(0,0,0,0.6); color: white;';\r\n    let badgeIcon = '';\r\n\r\n    // SPECIAL: Spot Local Styling (Red + Icon)\r\n    if (badgeText === 'Spot Local' || (lieu.tags && lieu.tags.includes('secret_spot') && !isMustSee)) {\r\n        // Force the text if it was generic 'Nature' etc but specifically identified as secret spot in context\r\n        // But respect isMustSee priority if needed. Here we follow User's target: \"vignette o√π il est √©crit spot local\"\r\n        if (badgeText === 'Spot Local') {\r\n            badgeStyle = 'background: #c0392b; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);';\r\n            badgeIcon = '<i class=\"fas fa-fire-alt\" style=\"margin-right:4px;\"></i>';\r\n        }\r\n    }\r\n\r\n    // 3. Template (Rich & Premium)\r\n    return `\r\n        <article class=\"lieu-card\" \r\n                 data-id=\"${lieu.id}\" \r\n                 data-category=\"${category}\" \r\n                 data-tags=\"${tagsString}\" \r\n                 data-type=\"${lieu.type}\" \r\n                 data-ville=\"${lieu.ville}\"\r\n                 style=\"position: relative; cursor: pointer; display: flex; flex-direction: column; background: var(--bg-secondary); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-sm); transition: transform 0.2s; border: 1px solid var(--border-color);\">\r\n            \r\n            <!-- Badge Location (Top Left - REQUESTED) -->\r\n            <div class=\"badge-location\" style=\"position: absolute; top: 10px; left: 10px; z-index: 5; background: rgba(0,0,0,0.7); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; backdrop-filter: none;\">\r\n                <i class=\"fas fa-map-marker-alt\" style=\"margin-right:4px;\"></i> ${lieu.ville}\r\n            </div>\r\n\r\n            <!-- Favorite Button (Top Right) -->\r\n            <button onclick=\"toggleLieuFavorite(${lieu.id}, this, event)\" class=\"btn-favorite ${activeClass}\" \r\n                    style=\"position: absolute; top: 10px; right: 10px; z-index: 5; background: white; border-radius: 50%; width: 32px; height: 32px; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; cursor: pointer;\">\r\n                ${icon}\r\n            </button>\r\n            \r\n            <!-- Image -->\r\n            <div class=\"lieu-image\" onclick=\"showLieuDetailsByID(${lieu.id})\" style=\"position: relative; height: 180px; overflow: hidden;\">\r\n                <img src=\"${lieu.image}\" alt=\"${lieu.nom.replace(/\"/g, '&quot;')}\" loading=\"lazy\" onerror=\"this.src='images/placeholder.jpg'\" style=\"width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s;\">\r\n                <!-- Type Badge (Bottom Left) -->\r\n                <div class=\"lieu-badge\" style=\"position: absolute; bottom: 10px; left: 10px; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; ${badgeStyle}\">${badgeIcon}${badgeText}</div>\r\n            </div>\r\n            \r\n            <!-- Content -->\r\n            <div class=\"lieu-content\" onclick=\"showLieuDetailsByID(${lieu.id})\" style=\"padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 8px;\">\r\n                \r\n                <div class=\"lieu-header\" style=\"display: flex; justify-content: space-between; align-items: flex-start; margin: 0;\">\r\n                    <h3 class=\"lieu-title\" style=\"margin: 0; font-size: 1.1rem; color: var(--text-primary); line-height: 1.3; font-weight: 700;\">${lieu.nom}</h3>\r\n                    <div class=\"lieu-rating\" style=\"display: flex; align-items: center; gap: 4px; font-size: 0.85rem; color: var(--text-primary); background: var(--bg-body); padding: 2px 6px; border-radius: 6px; border: 1px solid var(--border-color);\">\r\n                        <i class=\"fas fa-star\" style=\"color: #f1c40f; font-size: 0.8rem;\"></i> ${lieu.note}\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Tags -->\r\n                <div class=\"lieu-tags\" style=\"display: flex; gap: 6px; flex-wrap: wrap;\">${displayTagsWithBudget}</div>\r\n\r\n                <!-- Desc -->\r\n                <p class=\"lieu-desc\" style=\"margin: 0; font-size: 0.9rem; color: var(--text-secondary); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.5;\">${lieu.description}</p>\r\n\r\n                <!-- Footer -->\r\n                <div class=\"lieu-footer\" style=\"margin-top: auto; padding-top: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; border-top: 1px solid var(--border-color);\">\r\n                   <span class=\"lieu-ville\" style=\"color: var(--text-secondary); display: none;\">${lieu.ville}</span> <!-- Hidden as badge is on image -->\r\n                   <span class=\"lieu-prix ${prixClass}\" style=\"font-weight: 600;\">${lieu.prix}</span>\r\n                </div>\r\n            </div>\r\n        </article>\r\n    `;\r\n}\r\n/* ============================================\r\n   8. CAROUSEL SYSTEM (MODERN SPOT MEDIA)\r\n   ============================================ */\r\n\r\n/**\r\n * Cr√©e le HTML du carrousel d'images pour la modale\r\n * @param {string} heroImage - URL de l'image principale\r\n * @param {Array} gallery - Tableau d'objets {url, alt}\r\n * @returns {string} HTML du carrousel\r\n */\r\nwindow.createSpotMediaCarousel = function (heroImage, gallery = []) {\r\n    // Construire le tableau complet d'images\r\n    const allImages = [\r\n        { url: heroImage, alt: 'Image principale' },\r\n        ...gallery\r\n    ];\r\n\r\n    // Debug log\r\n    console.log('üé® Carrousel images:', allImages);\r\n    console.log('üé® Nombre d\\'images:', allImages.length);\r\n\r\n    const hasCarousel = allImages.length > 1;\r\n    const carouselId = 'carousel-' + Date.now();\r\n\r\n    let html = `<div class=\"hero-media modern-carousel\" id=\"${carouselId}\">`;\r\n\r\n    // Images (toutes rendues, premi√®re avec classe active)\r\n    allImages.forEach((img, index) => {\r\n        html += `\r\n            <img src=\"${img.url}\" \r\n                 alt=\"${img.alt || ''}\" \r\n                 class=\"hero-image ${index === 0 ? 'active' : ''}\" \r\n                 data-index=\"${index}\"\r\n                 onerror=\"this.onerror=null; this.src='images/placeholder.jpg';\">`;\r\n    });\r\n\r\n    // Navigation gauche (seulement si carousel)\r\n    if (hasCarousel) {\r\n        html += `\r\n            <button type=\"button\" \r\n                    class=\"hero-nav hero-nav-left\" \r\n                    onclick=\"window.carouselPrev('${carouselId}')\"\r\n                    aria-label=\"Image pr√©c√©dente\">\r\n                ‚Äπ\r\n            </button>`;\r\n    }\r\n\r\n    // Navigation droite (seulement si carousel)\r\n    if (hasCarousel) {\r\n        html += `\r\n            <button type=\"button\" \r\n                    class=\"hero-nav hero-nav-right\" \r\n                    onclick=\"window.carouselNext('${carouselId}')\"\r\n                    aria-label=\"Image suivante\">\r\n                ‚Ä∫\r\n            </button>`;\r\n    }\r\n\r\n    // Dots de pagination (seulement si carousel)\r\n    if (hasCarousel) {\r\n        html += `<div class=\"hero-dots\">`;\r\n        allImages.forEach((_, index) => {\r\n            html += `\r\n                <button type=\"button\" \r\n                        class=\"hero-dot ${index === 0 ? 'active' : ''}\" \r\n                        onclick=\"window.carouselGoTo('${carouselId}', ${index})\"\r\n                        aria-label=\"Image ${index + 1}\">\r\n                </button>`;\r\n        });\r\n        html += `</div>`;\r\n    }\r\n\r\n    html += `</div>`;\r\n\r\n    // Initialiser le state du carousel\r\n    if (hasCarousel) {\r\n        if (!window.carouselStates) window.carouselStates = {};\r\n        window.carouselStates[carouselId] = {\r\n            currentIndex: 0,\r\n            totalImages: allImages.length,\r\n            autoPlayInterval: null\r\n        };\r\n\r\n        // D√©marrer l'auto-play apr√®s un court d√©lai\r\n        setTimeout(() => {\r\n            const carousel = document.getElementById(carouselId);\r\n            if (carousel) {\r\n                // Forcer l'affichage de la premi√®re image\r\n                const firstImage = carousel.querySelector('.hero-image[data-index=\"0\"]');\r\n                if (firstImage) {\r\n                    console.log('üéØ Forcing first image visible');\r\n                    firstImage.classList.add('active');\r\n                    firstImage.style.opacity = '1';\r\n                    firstImage.style.transform = 'scale(1)';\r\n                }\r\n                window.initCarouselFeatures(carouselId);\r\n            }\r\n        }, 100);\r\n    } else {\r\n        // Si une seule image, forcer son affichage\r\n        setTimeout(() => {\r\n            const carousel = document.getElementById(carouselId);\r\n            if (carousel) {\r\n                const singleImage = carousel.querySelector('.hero-image');\r\n                if (singleImage) {\r\n                    console.log('üéØ Forcing single image visible');\r\n                    singleImage.classList.add('active');\r\n                    singleImage.style.opacity = '1';\r\n                    singleImage.style.transform = 'scale(1)';\r\n                }\r\n            }\r\n        }, 50);\r\n    }\r\n\r\n    return html;\r\n};\r\n\r\n/**\r\n * Navigation carousel - Previous\r\n */\r\nwindow.carouselPrev = function (carouselId) {\r\n    const state = window.carouselStates[carouselId];\r\n    if (!state) return;\r\n\r\n    const newIndex = (state.currentIndex - 1 + state.totalImages) % state.totalImages;\r\n    window.carouselGoTo(carouselId, newIndex);\r\n};\r\n\r\n/**\r\n * Navigation carousel - Next\r\n */\r\nwindow.carouselNext = function (carouselId) {\r\n    const state = window.carouselStates[carouselId];\r\n    if (!state) return;\r\n\r\n    const newIndex = (state.currentIndex + 1) % state.totalImages;\r\n    window.carouselGoTo(carouselId, newIndex);\r\n};\r\n\r\n/**\r\n * Navigation carousel - Go to specific index\r\n */\r\nwindow.carouselGoTo = function (carouselId, index) {\r\n    const carousel = document.getElementById(carouselId);\r\n    if (!carousel) return;\r\n\r\n    const state = window.carouselStates[carouselId];\r\n    if (!state) return;\r\n\r\n    // Update state\r\n    state.currentIndex = index;\r\n\r\n    // Remove active class from all images\r\n    const images = carousel.querySelectorAll('.hero-image');\r\n    images.forEach(img => img.classList.remove('active'));\r\n\r\n    // Add active class to current image\r\n    const currentImage = carousel.querySelector(`.hero-image[data-index=\"${index}\"]`);\r\n    if (currentImage) currentImage.classList.add('active');\r\n\r\n    // Update dots\r\n    const dots = carousel.querySelectorAll('.hero-dot');\r\n    dots.forEach((dot, i) => {\r\n        if (i === index) {\r\n            dot.classList.add('active');\r\n        } else {\r\n            dot.classList.remove('active');\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Initialisation des fonctionnalit√©s avanc√©es du carrousel\r\n * Auto-play, swipe tactile, navigation clavier\r\n */\r\nwindow.initCarouselFeatures = function (carouselId) {\r\n    const carousel = document.getElementById(carouselId);\r\n    if (!carousel) return;\r\n\r\n    const state = window.carouselStates[carouselId];\r\n    if (!state) return;\r\n\r\n    // ‚ú® AUTO-PLAY (5 secondes)\r\n    const startAutoPlay = () => {\r\n        stopAutoPlay();\r\n        state.autoPlayInterval = setInterval(() => {\r\n            window.carouselNext(carouselId);\r\n        }, 5000);\r\n    };\r\n\r\n    const stopAutoPlay = () => {\r\n        if (state.autoPlayInterval) {\r\n            clearInterval(state.autoPlayInterval);\r\n            state.autoPlayInterval = null;\r\n        }\r\n    };\r\n\r\n    // Pause on hover\r\n    carousel.addEventListener('mouseenter', stopAutoPlay);\r\n    carousel.addEventListener('mouseleave', startAutoPlay);\r\n\r\n    // üì± SWIPE TACTILE\r\n    let touchStartX = 0;\r\n    let touchEndX = 0;\r\n\r\n    carousel.addEventListener('touchstart', (e) => {\r\n        touchStartX = e.changedTouches[0].screenX;\r\n    }, { passive: true });\r\n\r\n    carousel.addEventListener('touchend', (e) => {\r\n        touchEndX = e.changedTouches[0].screenX;\r\n        const swipeThreshold = 50;\r\n        const diff = touchStartX - touchEndX;\r\n\r\n        if (Math.abs(diff) > swipeThreshold) {\r\n            if (diff > 0) {\r\n                window.carouselNext(carouselId);\r\n            } else {\r\n                window.carouselPrev(carouselId);\r\n            }\r\n        }\r\n    }, { passive: true });\r\n\r\n    // ‚å®Ô∏è NAVIGATION CLAVIER\r\n    const handleKeyboard = (e) => {\r\n        // V√©rifier que la modale est ouverte\r\n        const modal = carousel.closest('.modal-overlay');\r\n        if (!modal || !modal.classList.contains('active')) return;\r\n\r\n        if (e.key === 'ArrowLeft') {\r\n            e.preventDefault();\r\n            window.carouselPrev(carouselId);\r\n        } else if (e.key === 'ArrowRight') {\r\n            e.preventDefault();\r\n            window.carouselNext(carouselId);\r\n        }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyboard);\r\n\r\n    // Nettoyer l'event listener quand la modale se ferme\r\n    const modal = carousel.closest('.modal-overlay');\r\n    if (modal) {\r\n        const observer = new MutationObserver((mutations) => {\r\n            mutations.forEach((mutation) => {\r\n                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\r\n                    if (!modal.classList.contains('active')) {\r\n                        stopAutoPlay();\r\n                        document.removeEventListener('keydown', handleKeyboard);\r\n                        observer.disconnect();\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        observer.observe(modal, { attributes: true });\r\n    }\r\n\r\n    // D√©marrer l'auto-play\r\n    startAutoPlay();\r\n};\r\n\r\n/* ============================================\r\n   9. MODAL SYSTEM (CRASH FIX)\r\n   ============================================ */\r\n\r\nwindow.openLieuModal = function (lieu) {\r\n    if (!lieu) return;\r\n\r\n    console.log('Opening Modal for:', lieu.nom, lieu); // Debug data\r\n\r\n    // Remove existing if any\r\n    const existing = document.getElementById('lieu-modal-overlay');\r\n    if (existing) existing.remove();\r\n\r\n    const isFav = window.isFavorite(lieu.id);\r\n    const favIcon = isFav ? '<i class=\"fa-solid fa-bookmark\"></i>' : '<i class=\"fa-regular fa-bookmark\"></i>';\r\n    const activeClass = isFav ? 'active' : '';\r\n\r\n    // Data Prep\r\n    const categoriesPrioritaires = ['Explorer', 'Manger', 'Dormir', 'Sortir', 'Spots'];\r\n    let badgeType = (lieu.type || 'G√©n√©ral');\r\n    if (lieu.tags && lieu.tags.length) {\r\n        const catTag = lieu.tags.find(t => categoriesPrioritaires.includes(t));\r\n        if (catTag) badgeType = catTag;\r\n        else badgeType = lieu.tags[0];\r\n    }\r\n\r\n    // New Data Fields\r\n    const gallery = lieu.galerie_photos || [];\r\n    const hasGallery = gallery.length > 0;\r\n    const actions = lieu.actions_principales || {};\r\n    const infos = lieu.infos_pratiques || {};\r\n    const avis = lieu.avis || null;\r\n    const embeddedMap = lieu.carte_interactive || null;\r\n\r\n    // Grid Data\r\n    // Force specific display if available, else fallback\r\n    const priceDisplay = lieu.prix ? lieu.prix : (lieu.prixNum === 0 ? 'Gratuit' : (lieu.budgetNum ? 'Sur devis' : 'Variable'));\r\n    const noteDisplay = lieu.note ? `${lieu.note}/5` : '-';\r\n    const dureeDisplay = lieu.duree || 'Variable';\r\n    const villeDisplay = lieu.ville || 'Madagascar';\r\n\r\n    // Website Existence Check\r\n    const hasWebsite = lieu.siteWeb && lieu.siteWeb.trim() !== \"\";\r\n\r\n    // HTML Construction\r\n    let html = `\r\n    <div id=\"lieu-modal-overlay\" class=\"modal-overlay active\" style=\"z-index: 10001;\" onclick=\"if(event.target.id === 'lieu-modal-overlay') window.closeLieuModal();\">\r\n        <div class=\"modal-content fade-in-up\" style=\"position:relative; max-height: 90vh; overflow-y: auto; background: var(--bg-body); border-radius: 16px;\">\r\n            \r\n             <button class=\"btn-close-modal-overlay\" id=\"modal-close-btn\" onclick=\"window.closeLieuModal()\"\r\n                style=\"position: absolute; top: 15px; right: 15px; z-index: 100000; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-primary); pointer-events: auto;\">\r\n                <i class=\"fas fa-times\" style=\"font-size: 1.2rem;\"></i>\r\n            </button>\r\n\r\n            <!-- 1. CARROUSEL D'IMAGES (Moderne) -->\r\n            ${window.createSpotMediaCarousel(lieu.image, lieu.galerie_photos || [])}\r\n\r\n            <div style=\"padding: 0 20px;\">\r\n                <div class=\"modal-title-block\" style=\"padding: 10px 0 0; position: relative;\">\r\n                    <h2 class=\"modal-main-title\" style=\"font-size: 1.6rem; line-height: 1.2; margin-bottom: 8px; font-weight: 800; font-family: var(--font-display); color: var(--text-primary); padding-right: 40px;\">${lieu.nom}</h2>\r\n                    <span class=\"modal-category-badge\" style=\"background: var(--laterite); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;\">${lieu.ville || badgeType}</span>\r\n                     \r\n                     <!-- Fav Button (Moved to float nicely if needed, or stick to absolute) -->\r\n                     <!-- Kept absolute for consistency but updated style -->\r\n                </div>\r\n\r\n                <!-- 3. INFO GRID -->\r\n                <div class=\"modal-info-grid\" style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 25px 0; text-align: center; border-bottom: 1px solid var(--border-color);\">\r\n                    <div class=\"modal-info-box\">\r\n                        <div style=\"color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;\">Ville</div>\r\n                        <div style=\"font-weight:700; font-size:0.9rem; margin-top: 4px;\">${villeDisplay}</div>\r\n                    </div>\r\n                    <div class=\"modal-info-box\">\r\n                         <div style=\"color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;\">Prix</div>\r\n                        <div style=\"font-weight:700; font-size:0.9rem; margin-top: 4px;\">${priceDisplay}</div>\r\n                    </div>\r\n                    <div class=\"modal-info-box\">\r\n                         <div style=\"color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;\">Note</div>\r\n                        <div style=\"font-weight:700; font-size:0.9rem; margin-top: 4px; color: #f1c40f;\">‚≠ê ${noteDisplay}</div>\r\n                    </div>\r\n                    <div class=\"modal-info-box\">\r\n                         <div style=\"color:var(--text-secondary); font-size:0.75rem; text-transform: uppercase; letter-spacing: 0.5px;\">Dur√©e</div>\r\n                        <div style=\"font-weight:700; font-size:0.9rem; margin-top: 4px;\">${dureeDisplay}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- ACTIONS PRINCIPALES (New) -->\r\n                ${actions.cta_principal ? `\r\n                <div class=\"modal-actions-container\" style=\"padding: 20px 0; display: flex; gap: 12px;\">\r\n                    <a href=\"${actions.cta_principal.url}\" class=\"btn-action-primary\" style=\"flex: 2; background: var(--laterite); color: white; text-align: center; padding: 14px; border-radius: 12px; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 10px rgba(211, 84, 0, 0.3); transition: transform 0.2s;\">\r\n                        ${actions.cta_principal.icone || ''} ${actions.cta_principal.texte}\r\n                    </a>\r\n                    ${actions.cta_secondaire ? `\r\n                    <a href=\"${actions.cta_secondaire.url}\" target=\"_blank\" class=\"btn-action-secondary\" style=\"flex: 1; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); text-align: center; padding: 12px; border-radius: 12px; font-weight: 600; text-decoration: none; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;\">\r\n                        <i class=\"fab fa-whatsapp\" style=\"color:#25D366;\"></i>\r\n                    </a>` : ''}\r\n                </div>` : ''}\r\n\r\n                <!-- DESCRIPTION -->\r\n                ${(() => {\r\n            // Syst√®me \"Lire plus / Lire moins\" pour TOUTES les descriptions avec r√©sum√©\r\n            if (lieu.has_expandable_description && lieu.description_summary) {\r\n                const descData = { summary: lieu.description_summary, hasMore: true };\r\n\r\n                if (descData.hasMore) {\r\n                    return `\r\n                                <div class=\"modal-description-text\" style=\"font-size: 1rem; line-height: 1.7; color: var(--text-primary); margin-bottom: 25px;\">\r\n                                    <div id=\"description-short\" style=\"display: block;\">\r\n                                        ${descData.summary}\r\n                                    </div>\r\n                                    <div id=\"description-full\" style=\"display: none;\">\r\n                                        ${lieu.description}\r\n                                    </div>\r\n                                    <button onclick=\"window.toggleDescription()\" \r\n                                            id=\"toggle-description-btn\"\r\n                                            style=\"background: none; border: none; color: var(--laterite); font-weight: 600; cursor: pointer; padding: 8px 0; margin-top: 4px; font-size: 0.95rem; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;\">\r\n                                        <span id=\"toggle-text\">Lire plus</span>\r\n                                        <i id=\"toggle-icon\" class=\"fas fa-chevron-down\" style=\"font-size: 0.8rem;\"></i>\r\n                                    </button>\r\n                                </div>\r\n                            `;\r\n                } else {\r\n                    return `\r\n                                <div class=\"modal-description-text\" style=\"font-size: 1rem; line-height: 1.7; color: var(--text-primary); margin-bottom: 25px;\">\r\n                                    ${lieu.description}\r\n                                </div>\r\n                            `;\r\n                }\r\n            } else {\r\n                // Pour toutes les autres fiches, affichage normal\r\n                return `\r\n                            <div class=\"modal-description-text\" style=\"font-size: 1rem; line-height: 1.7; color: var(--text-primary); margin-bottom: 25px;\">\r\n                                ${lieu.description}\r\n                            </div>\r\n                        `;\r\n            }\r\n        })()}\r\n\r\n                 <!-- CONSEIL DU LOCAL -->\r\n                ${lieu.conseil ? `\r\n                <div class=\"modal-conseil-block\" style=\"margin-bottom: 25px; background: rgba(241, 196, 15, 0.1); color: #856404; padding: 16px; border-radius: 12px; border-left: 4px solid #f1c40f;\">\r\n                    <div style=\"font-weight: 700; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; color: #d35400;\"><i class=\"fas fa-lightbulb\"></i> Conseil du Local</div>\r\n                    <p style=\"margin: 0; font-size: 0.95rem; line-height: 1.5;\">${lieu.conseil}</p>\r\n                </div>` : ''}\r\n\r\n                <!-- INFOS PRATIQUES - ACCORD√âON 2026 -->\r\n                ${(infos.horaires || infos.meilleure_periode || infos.a_prevoir) ? `\r\n                    <div class=\"accordion-v3\" style=\"margin-bottom: 25px;\">\r\n                        <div class=\"accordion-item\">\r\n                            <button class=\"accordion-trigger\" \r\n                                    aria-expanded=\"false\" \r\n                                    onclick=\"window.toggleAccordionV3(this)\">\r\n                                <div class=\"accordion-header-content\">\r\n                                    <div class=\"icon-wrapper\">\r\n                                        <i class=\"fas fa-info-circle\"></i>\r\n                                    </div>\r\n                                    <div class=\"accordion-text\">\r\n                                        <div class=\"accordion-heading\">Infos Pratiques</div>\r\n                                        <div class=\"accordion-subtitle\">Horaires, conseils & √©quipement</div>\r\n                                    </div>\r\n                                </div>\r\n                                <i class=\"fas fa-chevron-down chevron\"></i>\r\n                            </button>\r\n                            <div class=\"accordion-body\" aria-hidden=\"true\">\r\n                                <div class=\"accordion-inner\">\r\n                                    ${infos.horaires ? `\r\n                                        <div style=\"margin-bottom: 18px;\">\r\n                                            <strong style=\"color: var(--laterite);\"><i class=\"far fa-clock\"></i> Horaires</strong>\r\n                                            <div style=\"margin-top: 6px;\">\r\n                                                ${infos.horaires.lundi_vendredi ? `<div>${infos.horaires.lundi_vendredi}</div>` : ''}\r\n                                                ${infos.horaires.weekend ? `<div>${infos.horaires.weekend}</div>` : ''}\r\n                                                ${infos.horaires.note ? `<div style=\"font-style: italic; margin-top: 4px; color: var(--laterite);\">${infos.horaires.note}</div>` : ''}\r\n                                            </div>\r\n                                        </div>\r\n                                    ` : ''}\r\n                                    \r\n                                    ${infos.meilleure_periode ? `\r\n                                        <div style=\"margin-bottom: 18px;\">\r\n                                            <strong style=\"color: var(--laterite);\"><i class=\"fas fa-sun\"></i> Meilleure P√©riode</strong>\r\n                                            <div style=\"margin-top: 6px;\">\r\n                                                ${infos.meilleure_periode.saison_ideale ? `<div>‚úÖ ${infos.meilleure_periode.saison_ideale}</div>` : ''}\r\n                                                ${infos.meilleure_periode.eviter || infos.meilleure_periode.a_eviter ? `<div style=\"margin-top: 4px;\">‚ö†Ô∏è ${infos.meilleure_periode.eviter || infos.meilleure_periode.a_eviter}</div>` : ''}\r\n                                            </div>\r\n                                        </div>\r\n                                    ` : ''}\r\n                                    \r\n                                    ${infos.a_prevoir ? `\r\n                                        <div>\r\n                                            <strong style=\"color: var(--laterite);\"><i class=\"fas fa-backpack\"></i> √Ä Pr√©voir</strong>\r\n                                            <div style=\"margin-top: 6px;\">\r\n                                                ${Array.isArray(infos.a_prevoir.equipement) ?\r\n                    infos.a_prevoir.equipement.map(item => `<div>‚Ä¢ ${item}</div>`).join('') :\r\n                    infos.a_prevoir.equipement}\r\n                                                ${infos.a_prevoir.conseils ? `<div style=\"margin-top: 8px; font-style: italic; color: var(--laterite);\">üí° ${infos.a_prevoir.conseils}</div>` : ''}\r\n                                            </div>\r\n                                        </div>\r\n                                    ` : ''}\r\n\r\n                                    ${lieu.humour_grok ? `\r\n                                    <div style=\"margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(220, 38, 38, 0.2);\">\r\n                                        <div style=\"display: flex; gap: 15px; align-items: flex-start;\">\r\n                                            <div style=\"width: 36px; height: 36px; background: rgba(220, 38, 38, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--laterite); flex-shrink: 0;\"><i class=\"fas fa-laugh-wink\"></i></div>\r\n                                            <div style=\"flex: 1;\">\r\n                                                <strong style=\"font-size: 0.95rem; display: block; margin-bottom: 6px; color: var(--text-primary);\">L'Avis Sans Filtre</strong>\r\n                                                <div style=\"font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; font-style: italic;\">\r\n                                                    \"${lieu.humour_grok}\"\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>` : ''}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- CARTE INTERACTIVE (Embedded) -->\r\n                ${embeddedMap ? `\r\n                <div style=\"margin-bottom: 25px;\">\r\n                    <h3 style=\"font-size: 1.1rem; margin-bottom: 12px; font-family: var(--font-display); color: var(--text-primary);\">Localisation</h3>\r\n                    <div id=\"modal-map-container\" style=\"height: 250px; border-radius: 12px; overflow: hidden; background: #eee; border: 1px solid var(--border-color);\"></div>\r\n                </div>` : ''}\r\n\r\n                <!-- AVIS -->\r\n                ${avis ? `\r\n                <div class=\"modal-reviews\" style=\"margin-bottom: 25px;\">\r\n                    <h3 style=\"font-size: 1.1rem; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; font-family: var(--font-display);\">\r\n                        Avis Voyageurs\r\n                        <span style=\"font-size: 0.85rem; color: var(--text-secondary); font-family: var(--font-body); font-weight: 400;\">(${avis.nombre_avis} avis)</span>\r\n                    </h3>\r\n                    \r\n                    <div style=\"margin-bottom: 20px; background: var(--bg-secondary); padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 20px;\">\r\n                        <div style=\"text-align: center;\">\r\n                             <div style=\"font-size: 2.5rem; font-weight: 800; color: var(--laterite); line-height: 1;\">${avis.note_globale}</div>\r\n                             <div style=\"color: #f1c40f; font-size: 0.8rem; margin-top: 5px;\">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>\r\n                        </div>\r\n                        <div style=\"flex: 1; border-left: 1px solid var(--border-color); padding-left: 20px;\">\r\n                            ${Object.entries(avis.detail_notes || {}).slice(0, 3).map(([key, val]) => `\r\n                                <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.85rem;\">\r\n                                    <span style=\"text-transform: capitalize; color: var(--text-secondary);\">${key.replace(/_/g, ' ')}</span>\r\n                                    <span style=\"font-weight: 600;\">${val}</span>\r\n                                </div>\r\n                            `).join('')}\r\n                        </div>\r\n                    </div>\r\n\r\n                    ${(avis.avis_recents || []).slice(0, 2).map(a => `\r\n                    <div style=\"margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);\">\r\n                        <div style=\"display: flex; justify-content: space-between; margin-bottom: 5px;\">\r\n                            <strong style=\"font-size: 0.95rem;\">${a.auteur}</strong>\r\n                            <span style=\"font-size: 0.8rem; color: var(--text-secondary);\">${a.date}</span>\r\n                        </div>\r\n                        <div style=\"color: #f1c40f; font-size: 0.8rem; margin-bottom: 8px;\">${'‚≠ê'.repeat(Math.round(a.note))}</div>\r\n                        <p style=\"font-size: 0.9rem; font-style: italic; color: var(--text-primary); line-height: 1.5;\">\"${a.commentaire}\"</p>\r\n                    </div>\r\n                    `).join('')}\r\n                </div>` : ''}\r\n\r\n                 <!-- STANDARD FOOTER ACTIONS (FIXED & SIMPLIFIED) -->\r\n                <div class=\"modal-footer-actions\" style=\"padding: 20px 0; display: flex; flex-direction: column; gap: 12px; border-top: 1px solid var(--border-color);\">\r\n                    <!-- 1. MAP ACTION: ALWAYS Internal Application Map -->\r\n                    <a href=\"/carte?lieu=${lieu.id}\" onclick=\"window.locateOnMap(${lieu.id}); return false;\" \r\n                       class=\"btn-action-2026 btn-action-2026-map\" \r\n                       style=\"width: 100%; padding: 16px; background: white; color: var(--text-primary); border: 2px solid var(--laterite); border-radius: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-decoration: none;\">\r\n                        <i class=\"fas fa-map-marked-alt\" style=\"color: var(--laterite); font-size: 1.2rem;\"></i> Voir sur la carte de l'app\r\n                    </a>\r\n                    \r\n                    <!-- 2. WEBSITE ACTION: Display if siteWeb exists -->\r\n                    ${hasWebsite ? `\r\n                    <a href=\"${lieu.siteWeb}\" target=\"_blank\" class=\"btn-action-2026 btn-action-2026-web\" \r\n                       style=\"width: 100%; padding: 16px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 12px; font-weight: 600; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;\">\r\n                        <i class=\"fas fa-globe\"></i> Visiter le site web\r\n                    </a>` : ''}\r\n                </div>\r\n\r\n                <div style=\"height: 50px;\"></div>\r\n            </div>\r\n            \r\n             <!-- Floating Fav (Fixed Position inside modal content) -->\r\n            <button onclick=\"toggleLieuFavorite(${lieu.id}, this, event)\" class=\"btn-favorite-modal ${activeClass}\" \r\n                   style=\"position:absolute; top: 15px; left: 15px; background:white; color:var(--laterite); width:40px; height:40px; border-radius:50%; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.2); font-size: 1.1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; z-index:100;\">\r\n               ${favIcon}\r\n           </button>\r\n\r\n        </div>\r\n    </div>`;\r\n\r\n    document.body.insertAdjacentHTML('beforeend', html);\r\n    document.body.style.overflow = 'hidden';\r\n\r\n    // Map Init\r\n    if (embeddedMap && typeof L !== 'undefined') {\r\n        setTimeout(() => {\r\n            const mapContainer = document.getElementById('modal-map-container');\r\n            if (mapContainer) {\r\n                const map = L.map('modal-map-container').setView([embeddedMap.latitude || lieu.lat, embeddedMap.longitude || lieu.lng], embeddedMap.zoom_defaut || 13);\r\n                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                    attribution: '¬© OSM'\r\n                }).addTo(map);\r\n                L.marker([embeddedMap.latitude || lieu.lat, embeddedMap.longitude || lieu.lng]).addTo(map)\r\n                    .bindPopup(lieu.nom)\r\n                    .openPopup();\r\n\r\n                // Disable scroll zoom\r\n                map.scrollWheelZoom.disable();\r\n            }\r\n        }, 600); // Wait for modal animation\r\n    }\r\n\r\n    // GSAP Animation\r\n    const modal = document.getElementById('lieu-modal-overlay');\r\n    if (modal && window.GasikaraAnimations) {\r\n        window.GasikaraAnimations.openModal(modal);\r\n    }\r\n};\r\n\r\nwindow.closeLieuModal = function () {\r\n    const modal = document.getElementById('lieu-modal-overlay');\r\n    if (modal) {\r\n        // GSAP Animation: Animate modal closing (with callback)\r\n        if (window.GasikaraAnimations) {\r\n            window.GasikaraAnimations.closeModal(modal, () => {\r\n                modal.remove();\r\n                document.body.style.overflow = '';\r\n            });\r\n        } else {\r\n            // Fallback without GSAP\r\n            modal.classList.remove('active');\r\n            setTimeout(() => {\r\n                modal.remove();\r\n                document.body.style.overflow = '';\r\n            }, 300);\r\n        }\r\n    } else {\r\n        document.body.style.overflow = '';\r\n    }\r\n};\r\n\r\nwindow.locateOnMap = async function (id) {\r\n    window.closeLieuModal();\r\n    await window.navigateToPage('carte');\r\n    setTimeout(() => {\r\n        if (window.openMapMarker) {\r\n            window.openMapMarker(id);\r\n        }\r\n    }, 500);\r\n};\r\n\r\nwindow.addToItineraryTemp = function (id) {\r\n    alert(\"Fonctionnalit√© 'Ajouter au circuit' bient√¥t disponible !\");\r\n};\r\n\r\n/**\r\n * ========================================\r\n * FONCTION ACCORD√âON 2026\r\n * ========================================\r\n */\r\n// DEPRECATED: Remplac√© par <details> HTML natif (Phase 1 PWA Mobile)\r\n/*\r\nwindow.toggleAccordion = function (button) {\r\n    const content = button.nextElementSibling;\r\n    const chevron = button.querySelector('.accordion-chevron');\r\n    const isOpen = content.style.maxHeight && content.style.maxHeight !== '0px';\r\n\r\n    if (isOpen) {\r\n        content.style.maxHeight = '0';\r\n        content.style.padding = '0 20px';\r\n        if (chevron) chevron.style.transform = 'rotate(0deg)';\r\n        button.style.background = 'linear-gradient(135deg, rgba(220, 38, 38, 0.05), rgba(220, 38, 38, 0.02))';\r\n    } else {\r\n        content.style.maxHeight = content.scrollHeight + 40 + 'px';\r\n        content.style.padding = '20px';\r\n        if (chevron) chevron.style.transform = 'rotate(180deg)';\r\n        button.style.background = 'linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05))';\r\n    }\r\n};\r\n*/\r\n\r\n/**\r\n * ========================================\r\n * ACCORD√âON PREMIUM V3 - Toggle avec ARIA\r\n * ========================================\r\n */\r\nwindow.toggleAccordionV3 = function (button) {\r\n    const body = button.nextElementSibling;\r\n    const chevron = button.querySelector('.chevron');\r\n    const isExpanded = button.getAttribute('aria-expanded') === 'true';\r\n\r\n    // Toggle √©tat ARIA (Accessibilit√©)\r\n    button.setAttribute('aria-expanded', !isExpanded);\r\n    body.setAttribute('aria-hidden', isExpanded);\r\n\r\n    // Animation hauteur dynamique (plus fluide que max-height fixe)\r\n    if (!isExpanded) {\r\n        body.style.maxHeight = body.scrollHeight + 40 + 'px'; // +40px marge s√©curit√©\r\n    } else {\r\n        body.style.maxHeight = '0';\r\n    }\r\n\r\n    // Haptic feedback mobile\r\n    if (navigator.vibrate) {\r\n        navigator.vibrate(10);\r\n    }\r\n};\r\n\r\n// Support navigation clavier (Tab + Enter/Espace)\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    document.addEventListener('keydown', function (e) {\r\n        if (e.target.classList.contains('accordion-trigger') &&\r\n            (e.key === 'Enter' || e.key === ' ')) {\r\n            e.preventDefault();\r\n            window.toggleAccordionV3(e.target);\r\n        }\r\n    });\r\n});\r\n\r\n\r\n/**\r\n * ========================================\r\n * R√âSUM√â DESCRIPTION\r\n * ========================================\r\n */\r\nwindow.createDescriptionSummary = function (fullDescription, maxChars = 400) {\r\n    if (!fullDescription || fullDescription.length <= maxChars) {\r\n        return { summary: fullDescription, hasMore: false };\r\n    }\r\n\r\n    let cutPoint = fullDescription.substring(0, maxChars).lastIndexOf('.');\r\n\r\n    if (cutPoint === -1) {\r\n        cutPoint = fullDescription.substring(0, maxChars).lastIndexOf(' ');\r\n    }\r\n\r\n    const summary = fullDescription.substring(0, cutPoint + 1);\r\n\r\n    return {\r\n        summary: summary.trim(),\r\n        hasMore: true\r\n    };\r\n};\r\n\r\n/**\r\n * ========================================\r\n * TOGGLE DESCRIPTION\r\n * ========================================\r\n */\r\nwindow.toggleDescription = function () {\r\n    const shortDiv = document.getElementById('description-short');\r\n    const fullDiv = document.getElementById('description-full');\r\n    const toggleText = document.getElementById('toggle-text');\r\n    const toggleIcon = document.getElementById('toggle-icon');\r\n\r\n    if (!shortDiv || !fullDiv) return;\r\n\r\n    if (shortDiv.style.display === 'none') {\r\n        shortDiv.style.display = 'block';\r\n        fullDiv.style.display = 'none';\r\n        toggleText.textContent = 'Lire plus';\r\n        toggleIcon.className = 'fas fa-chevron-down';\r\n    } else {\r\n        shortDiv.style.display = 'none';\r\n        fullDiv.style.display = 'block';\r\n        toggleText.textContent = 'Lire moins';\r\n        toggleIcon.className = 'fas fa-chevron-up';\r\n    }\r\n};\r\n\r\n/**\r\n * ========================================\r\n * FONCTION ACCORD√âON 2026\r\n * ========================================\r\n * G√®re l'ouverture/fermeture des accord√©ons avec animation fluide\r\n */\r\nwindow.toggleAccordion = function (button) {\r\n    const content = button.nextElementSibling;\r\n    const chevron = button.querySelector('.accordion-chevron');\r\n    const isOpen = content.style.maxHeight && content.style.maxHeight !== '0px';\r\n\r\n    if (isOpen) {\r\n        // Fermer\r\n        content.style.maxHeight = '0';\r\n        content.style.padding = '0 20px';\r\n        if (chevron) chevron.style.transform = 'rotate(0deg)';\r\n        button.style.background = 'linear-gradient(135deg, rgba(220, 38, 38, 0.05), rgba(220, 38, 38, 0.02))';\r\n    } else {\r\n        // Ouvrir\r\n        content.style.maxHeight = content.scrollHeight + 40 + 'px';\r\n        content.style.padding = '20px';\r\n        if (chevron) chevron.style.transform = 'rotate(180deg)';\r\n        button.style.background = 'linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(220, 38, 38, 0.05))';\r\n    }\r\n};\r\n\r\n\r\n// ... (Existing Province / Map logic can stay in Map-logic or here.\r\n// Re-adding the updatePremiumInfo stub for full robustness as page needs it)\r\n\r\nwindow.updatePremiumInfo = function (city, provinceKey) {\r\n    // Fix ID syntax: Remove spaces\r\n    const container = document.getElementById(`premium-container-${provinceKey}`);\r\n    if (!container) return;\r\n\r\n    const zoneData = (window.ZONES_DATA || {})[city];\r\n    if (!zoneData) { container.innerHTML = ''; return; }\r\n\r\n    // (Simplified Premium Info injection - robust fallback)\r\n    let html = '';\r\n\r\n    // Logistique\r\n    if (zoneData.logistique) {\r\n        const { route_etat, transport_conseil } = zoneData.logistique;\r\n        html += `\r\n    < div class=\"logistique-container\" >\r\n                 <div class=\"logistique-header\" onclick=\"this.nextElementSibling.classList.toggle('active')\">\r\n                    <h3><i class=\"fas fa-truck-monster\"></i> Infos Route (${city})</h3>\r\n                    <i class=\"fas fa-chevron-down\"></i>\r\n                </div>\r\n                <div class=\"logistique-content\">\r\n                    <div class=\"logistique-item\"><div>Route:</div><div>${route_etat}</div></div>\r\n                    <div class=\"logistique-item\"><div>Transport:</div><div>${transport_conseil}</div></div>\r\n                </div>\r\n            </div > `;\r\n    }\r\n    container.innerHTML = html;\r\n}\r\n\r\n\r\n\r\n/* ============================================\r\n   MAIN ENTRY\r\n   ============================================ */\r\n/* ============================================\r\n   MAIN ENTRY & OPTIMIZATION (PWA V2)\r\n   ============================================ */\r\n// OLD DOMContentLoaded Removed - See Final Block\r\n\r\n/* ============================================\r\n   9. FILTERS & UTILS (RESTORED MAP LOGIC)\r\n   ============================================ */\r\n\r\nwindow.initFilters = function () {\r\n    // Only needed if we want to attach listeners dynamically, \r\n    // but map-logic.js handles map listeners on checkboxes.\r\n    // This is for the City Page Chips.\r\n};\r\n\r\nwindow.getActiveFilters = function () {\r\n    const filters = {\r\n        provinces: [],\r\n        types: [],\r\n        prix: [],\r\n        favorites: false\r\n    };\r\n\r\n    // 1. Province/City Filters (Map Page)\r\n    document.querySelectorAll('.filter-checkbox[id^=\"filter-\"]:checked').forEach(cb => {\r\n        const type = cb.id.replace('filter-', '');\r\n        // Cities\r\n        if (['antananarivo', 'antsiranana', 'mahajanga', 'toamasina', 'toliara', 'fianarantsoa'].includes(type)) {\r\n            filters.provinces.push(type);\r\n        }\r\n        // Types\r\n        else if (['explorer', 'manger', 'dodo', 'sortir', 'spot'].includes(type)) {\r\n            filters.types.push(type);\r\n        }\r\n    });\r\n\r\n    // 2. Favorites\r\n    const favCb = document.getElementById('filter-favorites');\r\n    if (favCb && favCb.checked) filters.favorites = true;\r\n\r\n    return filters;\r\n};\r\n\r\nwindow.matchesFilters = function (lieu, filters) {\r\n    if (!lieu) return false;\r\n\r\n    // 1. Favorites\r\n    if (filters.favorites) {\r\n        if (!window.isFavorite(lieu.id)) return false;\r\n    }\r\n\r\n    // 2. City Filter (Map Page)\r\n    if (filters.provinces && filters.provinces.length > 0) {\r\n        const lieuCity = (lieu.ville || '').toLowerCase();\r\n\r\n        // Strict mapping for major hubs\r\n        const mapCityToFilter = {\r\n            'diego-suarez': 'antsiranana',\r\n            'antsiranana': 'antsiranana',\r\n            'nosy be': 'antsiranana',\r\n            'nosy-be': 'antsiranana',\r\n            'antananarivo': 'antananarivo', 'tana': 'antananarivo',\r\n            'mahajanga': 'mahajanga', 'majunga': 'mahajanga',\r\n            'toamasina': 'toamasina', 'tamatave': 'toamasina',\r\n            'toliara': 'toliara', 'tul√©ar': 'toliara',\r\n            'fianarantsoa': 'fianarantsoa'\r\n        };\r\n\r\n        const mappedLieu = mapCityToFilter[lieuCity] || lieuCity;\r\n        if (!filters.provinces.includes(mappedLieu)) return false;\r\n    }\r\n\r\n    // 3. Type Filter (Using Normalized 'categorie')\r\n    if (filters.types && filters.types.length > 0) {\r\n        // Normalize the filter types (e.g. 'dodo' -> 'Dormir') if they differ\r\n        // But usually filter buttons send 'manger', 'dormir', 'explorer', 'sortir', 'spot'\r\n        // And our data now has 'Manger', 'Dormir', 'Explorer', 'Sortir', 'Spot'\r\n        const normalizedLieuCat = (lieu.categorie || '').toLowerCase();\r\n\r\n        // Map filter keys to data keys (just in case)\r\n        const filterKeyMap = {\r\n            'dodo': 'dormir'\r\n        };\r\n\r\n        const match = filters.types.some(t => {\r\n            let ft = t.toLowerCase();\r\n            if (filterKeyMap[ft]) ft = filterKeyMap[ft];\r\n\r\n            return normalizedLieuCat === ft;\r\n        });\r\n\r\n        if (!match) return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n/* ============================================\r\n   8. THEME MANAGER (Dark/Light)\r\n   ============================================ */\r\n// Redundant initTheme removed.\r\n\r\n\r\n// ============================================\r\n// EMERGENCY FIX: FORCED UI LOGIC\r\n// ============================================\r\n// OLD EMERGENCY FIX Removed - See Final Block\r\n\r\n\r\n// --- PATCH FILTRES (TAGS) ---\r\n\r\n\r\n\r\n// --- FIX: SECURE CARD GENERATION ---\r\n\r\n\r\n\r\n// --- PATCH FINAL : FILTRES BUDGET & VILLES ---\r\n\r\n\r\n\r\n// --- MOTEUR D'AFFICHAGE UNIVERSEL (V4 - FIX DISPARITION) ---\r\n\r\n\r\n\r\n// --- MOTEUR RENDU V7 (DESIGN PREMIUM + LOGIQUE ROBUSTE) ---\r\n\r\n\r\n\r\n\r\n// ============================================\r\n// 9. MOTEUR DE VUE PREMIUM (V7 FINAL)\r\n// ============================================\r\n\r\n// A. Cr√©ation Carte Premium (S√©curis√©e)\r\n\r\n\r\n\r\n// B. Moteur de Filtre Centralis√© (Diego & Nosy Be & autres)\r\n\r\n\r\n\r\n// INITIALISATION AU CHARGEMENT DE LA PAGE\r\n// OLD INIT removed - See Final Block\r\n// ============================================================================\r\n// FORCED CARD REGENERATION - FIX FOR CACHE ISSUE\r\n// ============================================================================\r\n// OLD FORCED REGEN removed - See Final Block\r\n\r\n// ============================================================================\r\n// GLOBAL SEARCH LOGIC (PREMIUM 2026)\r\n// ============================================================================\r\n// ============================================================================\r\n// GLOBAL SEARCH LOGIC (OPTIMIZED PWA)\r\n// ============================================================================\r\nfunction initGlobalSearch() {\r\n    const searchInput = document.getElementById('globalSearchInput');\r\n    const resultsContainer = document.getElementById('searchResults');\r\n\r\n    if (!searchInput || !resultsContainer) return;\r\n\r\n    // Close on click outside\r\n    document.addEventListener('click', (e) => {\r\n        if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {\r\n            resultsContainer.classList.remove('active');\r\n            resultsContainer.style.display = 'none';\r\n        }\r\n    });\r\n\r\n    // Focus input -> show results if not empty\r\n    searchInput.addEventListener('focus', () => {\r\n        if (searchInput.value.trim().length >= 3) {\r\n            resultsContainer.style.display = 'block';\r\n            resultsContainer.classList.add('active');\r\n        }\r\n    });\r\n\r\n    // Input handler with DEBOUNCE\r\n    let debounceTimer;\r\n    searchInput.addEventListener('input', (e) => {\r\n        clearTimeout(debounceTimer);\r\n        const query = e.target.value.toLowerCase().trim();\r\n\r\n        debounceTimer = setTimeout(() => {\r\n            if (query.length < 3) { // Min 3 chars\r\n                resultsContainer.classList.remove('active');\r\n                resultsContainer.style.display = 'none';\r\n                return;\r\n            }\r\n\r\n            if (!window.LIEUX_DATA) return;\r\n\r\n            // Filter Logic\r\n            const matches = window.LIEUX_DATA.filter(item => {\r\n                const name = (item.nom || '').toLowerCase();\r\n                const city = (item.ville || '').toLowerCase();\r\n                const tags = (item.tags || []).join(' ').toLowerCase();\r\n                const type = (item.type || '').toLowerCase();\r\n\r\n                return name.includes(query) ||\r\n                    city.includes(query) ||\r\n                    tags.includes(query) ||\r\n                    type.includes(query);\r\n            }).slice(0, 20); // Limit to 20 results (Performance)\r\n\r\n            renderSearchResults(matches, resultsContainer);\r\n            resultsContainer.style.display = 'block';\r\n        }, 250); // 250ms Debounce\r\n    });\r\n}\r\n\r\nfunction renderSearchResults(results, container) {\r\n    if (results.length === 0) {\r\n        container.innerHTML = '<div class=\"search-no-results\">Aucun r√©sultat trouv√©</div>';\r\n        container.classList.add('active');\r\n        return;\r\n    }\r\n\r\n    const html = results.map(item => `\r\n        <div class=\"search-result-item\" onclick=\"openLieuFromSearch(${item.id})\">\r\n            <img src=\"${item.image}\" class=\"search-result-thumb\" onerror=\"this.src='images/placeholders/default.jpg'\">\r\n            <div class=\"search-result-info\">\r\n                <h4>${item.nom}</h4>\r\n                <p>${item.ville} ‚Ä¢ ${item.type}</p>\r\n            </div>\r\n        </div>\r\n    `).join('');\r\n\r\n    container.innerHTML = html;\r\n    container.classList.add('active');\r\n}\r\n\r\nwindow.openLieuFromSearch = function (id) {\r\n    const item = window.LIEUX_DATA.find(i => i.id === id);\r\n    if (item) {\r\n        showLieuModalDirectly(item);\r\n    }\r\n\r\n    // Close search\r\n    document.getElementById('searchResults').classList.remove('active');\r\n    document.getElementById('globalSearchInput').value = '';\r\n};\r\n\r\nwindow.showLieuModalDirectly = function (lieu) {\r\n    if (lieu) {\r\n        window.openLieuModal(lieu);\r\n    }\r\n};\r\n\r\n// Init when DOM is ready\r\n// 9. INITIALIZATION ENTRY POINT\r\n// Init when DOM is ready\r\n// 9. INITIALIZATION ENTRY POINT (CONSOLIDATED)\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    console.log(\"üöÄ PWA BOOTSTRAP: Starting Optimized Application...\");\r\n\r\n    // 1. Critical Init\r\n    initNavigation();\r\n\r\n    // 2. Data Init (Blocking but necessary for almost everything)\r\n    await window.initData();\r\n    console.log(\"‚úÖ Data Loaded.\");\r\n\r\n    // 3. Theme\r\n    initTheme();\r\n\r\n    // 4. Global Search (Optimized)\r\n    initGlobalSearch();\r\n\r\n    // 5. PWA Service Worker (Non-blocking)\r\n    if (typeof registerServiceWorker === 'function') {\r\n        if ('window.requestIdleCallback' in window) {\r\n            requestIdleCallback(() => registerServiceWorker());\r\n        } else {\r\n            setTimeout(registerServiceWorker, 1000); // Fallback\r\n        }\r\n    }\r\n\r\n    // 6. Install Prompt & Modals (Low Pri)\r\n    setTimeout(() => {\r\n        if (typeof initInstallPrompt === 'function') initInstallPrompt();\r\n        if (typeof initModal === 'function') initModal();\r\n        if (typeof initGeolocation === 'function') initGeolocation();\r\n    }, 500);\r\n\r\n    // 7. Event Listeners for Chips (Moved here from old multiple blocks)\r\n    // Map Buttons\r\n    document.querySelectorAll('.filter-chip-map').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n            const parent = btn.parentElement;\r\n            parent.querySelectorAll('.filter-chip-map').forEach(sib => sib.classList.remove('active'));\r\n            btn.classList.add('active');\r\n        });\r\n    });\r\n    // City Nav Pills\r\n    document.querySelectorAll('.nav-pill').forEach(btn => {\r\n        btn.addEventListener('click', function (e) {\r\n            const parent = this.parentElement;\r\n            parent.querySelectorAll('.nav-pill').forEach(sib => sib.classList.remove('active'));\r\n            this.classList.add('active');\r\n        });\r\n    });\r\n\r\n    console.log(\"üöÄ Application Ready (Lazy Mode).\");\r\n});\r\n\r\n// ============================================\r\n// 6. DYNAMIC ITINERARY MAP\r\n// ============================================\r\nwindow.initItineraryMap = function (steps) {\r\n    const container = document.getElementById('itinerary-dynamic-map');\r\n    if (!container) return;\r\n\r\n    // Cleanup previous map instance if exists\r\n    if (window.itinMap) {\r\n        window.itinMap.remove();\r\n        window.itinMap = null;\r\n    }\r\n\r\n    // Initialize Map\r\n    // Default center (Madagascar central)\r\n    const map = L.map('itinerary-dynamic-map', {\r\n        scrollWheelZoom: false // Prevent scrolling page intereference\r\n    }).setView([-18.8792, 47.5079], 6);\r\n\r\n    window.itinMap = map;\r\n\r\n    // Tile Layer (Voyager - Premium Clean Look)\r\n    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {\r\n        attribution: '&copy; OpenStreetMap & CARTO',\r\n        subdomains: 'abcd',\r\n        maxZoom: 20\r\n    }).addTo(map);\r\n\r\n    // Collect Data\r\n    const routeCoords = [];\r\n\r\n    if (steps && Array.isArray(steps)) {\r\n        steps.forEach((step, idx) => {\r\n            if (step.lieux_ids && step.lieux_ids.length > 0) {\r\n                const lieuId = step.lieux_ids[0];\r\n                const lieu = window.LIEUX_DATA ? window.LIEUX_DATA.find(l => l.id == lieuId) : null;\r\n\r\n                if (lieu && lieu.lat && lieu.lng) {\r\n                    const latLng = [lieu.lat, lieu.lng];\r\n                    routeCoords.push(latLng);\r\n\r\n                    // Add Marker (Numbered)\r\n                    const icon = L.divIcon({\r\n                        className: 'itin-marker',\r\n                        html: `<div style=\"background:var(--laterite); color:white; width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem; border:2px solid white; box-shadow:0 3px 6px rgba(0,0,0,0.3); z-index:100;\">${idx + 1}</div>`,\r\n                        iconSize: [28, 28],\r\n                        iconAnchor: [14, 14],\r\n                        popupAnchor: [0, -14]\r\n                    });\r\n\r\n                    const marker = L.marker(latLng, { icon: icon })\r\n                        .bindPopup(`\r\n                            <div style=\"font-family:var(--font-body); text-align:center;\">\r\n                                <strong style=\"color:var(--laterite);\">Jour ${step.jour || idx + 1}</strong><br>\r\n                                ${lieu.nom}\r\n                            </div>\r\n                        `);\r\n                    marker.addTo(map);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Draw Route Polyline\r\n    if (routeCoords.length > 1) {\r\n        // Create a curved-like visual with simple polyline for now\r\n        const polyline = L.polyline(routeCoords, {\r\n            color: '#b03030', // var(--laterite)\r\n            weight: 4,\r\n            opacity: 0.8,\r\n            lineJoin: 'round',\r\n            dashArray: '10, 10' // Slight dashed effect for \"Journey\" feel\r\n        }).addTo(map);\r\n\r\n        // Fit Bounds with padding\r\n        map.fitBounds(polyline.getBounds(), { padding: [50, 50] });\r\n    } else if (routeCoords.length === 1) {\r\n        map.setView(routeCoords[0], 10);\r\n    }\r\n};\r\n\r\nconsole.log('‚úÖ APP.JS FULLY PARSED');\r\n"],"mappings":"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","ignoreList":[]}